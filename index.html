<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rewarder - Monetized Talent Competition</title>
    <style>
    :root {
        --primary-color: #6c5ce7;
        --primary-dark: #5549c0;
        --secondary-color: #fd79a8;
        --text-color: #2d3436;
        --light-text: #636e72;
        --background-color: #f9f9f9;
        --white: #ffffff;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
        --border-color: #dfe6e9;
        --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
    }
    
    .container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .split-screen {
        display: flex;
        background-color: var(--white);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--box-shadow);
        width: 100%;
        max-width: 1200px;
        min-height: 600px;
    }
    
    /* Left side styling */
    .left {
        flex: 1;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--white);
        padding: 60px 40px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
    }
    
    .left::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .left::after {
        content: '';
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .logo h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        letter-spacing: 1px;
    }
    
    .tagline {
        margin-top: 60px;
        z-index: 1;
    }
    
    .tagline h2 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .tagline p {
        font-size: 1.1rem;
        opacity: 0.9;
    }
    
    .features {
        margin-top: 60px;
        z-index: 1;
    }
    
    .feature {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .feature i {
        font-size: 1.2rem;
        margin-right: 15px;
        background: rgba(255, 255, 255, 0.2);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .feature span {
        font-size: 1rem;
    }
    
    /* Right side styling */
    .right {
        flex: 1;
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .auth-container {
        width: 100%;
        max-width: 400px;
        transition: all 0.3s ease;
    }
    
    .auth-container.hidden {
        display: none;
    }
    
    .auth-container h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-color);
    }
    
    .auth-container > p {
        color: var(--light-text);
        margin-bottom: 30px;
    }
    
    .social-login {
        margin-bottom: 25px;
    }
    
    .social-btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background-color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .social-btn:hover {
        background-color: #f5f5f5;
    }
    
    .social-btn img {
        width: 20px;
        height: 20px;
        margin-right: 10px;
    }
    
    .divider {
        display: flex;
        align-items: center;
        margin: 25px 0;
    }
    
    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background-color: var(--border-color);
    }
    
    .divider span {
        padding: 0 15px;
        color: var(--light-text);
        font-size: 0.9rem;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        border-color: var(--primary-color);
        outline: none;
    }
    
    .password-input {
        position: relative;
    }
    
    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--light-text);
    }
    
    .password-strength {
        margin-top: 10px;
    }
    
    .strength-meter {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }
    
    .strength-segment {
        height: 4px;
        flex: 1;
        background-color: #ddd;
        border-radius: 2px;
    }
    
    .strength-segment.weak {
        background-color: var(--error-color);
    }
    
    .strength-segment.medium {
        background-color: #f39c12;
    }
    
    .strength-segment.strong {
        background-color: var(--success-color);
    }
    
    .strength-text {
        font-size: 0.8rem;
        color: var(--light-text);
    }
    
    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        font-size: 0.9rem;
    }
    
    .remember-me,
    .terms {
        display: flex;
        align-items: center;
    }
    
    .remember-me input,
    .terms input {
        margin-right: 8px;
    }
    
    .forgot-password,
    .terms a {
        color: var(--primary-color);
        text-decoration: none;
    }
    
    .forgot-password:hover,
    .terms a:hover {
        text-decoration: underline;
    }
    
    .auth-btn {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .auth-btn:hover {
        background-color: var(--primary-dark);
    }
    
    .auth-switch {
        text-align: center;
        margin-top: 25px;
        font-size: 0.9rem;
    }
    
    .auth-switch a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }
    
    .auth-switch a:hover {
        text-decoration: underline;
    }
    
    /* Error message styling */
    .error-message {
        color: var(--error-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .error-message.visible {
        display: block;
    }
    
    /* Success message styling */
    .success-message {
        color: var(--success-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .success-message.visible {
        display: block;
    }
    
    /* Loading indicator */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 0.8s linear infinite;
        margin-left: 10px;
    }
    
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
    
    .auth-btn.loading {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Toast notification */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: var(--white);
        font-size: 0.9rem;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
    }
    
    .toast.success {
        background-color: var(--success-color);
    }
    
    .toast.error {
        background-color: var(--error-color);
    }
    
    .toast.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* Responsive styles */
    @media (max-width: 992px) {
        .split-screen {
            flex-direction: column;
            max-width: 600px;
        }
        
        .left {
            padding: 40px 30px;
            min-height: 300px;
        }
        
        .tagline {
            margin-top: 30px;
        }
        
        .features {
            margin-top: 30px;
        }
        
        .right {
            padding: 30px;
        }
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        .split-screen {
            border-radius: 15px;
        }
        
        .left {
            padding: 30px 20px;
            min-height: 250px;
        }
        
        .logo h1 {
            font-size: 2rem;
        }
        
        .tagline h2 {
            font-size: 1.5rem;
        }
        
        .tagline p {
            font-size: 1rem;
        }
        
        .feature i {
            width: 35px;
            height: 35px;
            font-size: 1rem;
        }
        
        .feature span {
            font-size: 0.9rem;
        }
        
        .auth-container h2 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .split-screen {
            border-radius: 10px;
        }
        
        .left {
            padding: 25px 15px;
            min-height: 200px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .tagline {
            margin-top: 20px;
        }
        
        .tagline h2 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .tagline p {
            font-size: 0.9rem;
        }
        
        .features {
            margin-top: 20px;
        }
        
        .feature {
            margin-bottom: 15px;
        }
        
        .feature i {
            width: 30px;
            height: 30px;
            font-size: 0.9rem;
            margin-right: 10px;
        }
        
        .feature span {
            font-size: 0.85rem;
        }
        
        .right {
            padding: 25px 15px;
        }
        
        .auth-container h2 {
            font-size: 1.4rem;
        }
        
        .auth-container > p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            font-size: 0.85rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 10px 12px;
            font-size: 0.9rem;
        }
        
        .form-options {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .auth-btn {
            padding: 12px;
        }
        
        .social-btn span {
            font-size: 0.9rem;
        }
        
        .divider span {
            font-size: 0.8rem;
        }
    }
    
    /* iOS specific adjustments */
    @supports (-webkit-touch-callout: none) {
        input, select {
            font-size: 16px !important; /* Prevents zoom on focus in iOS */
        }
        
        .form-group input,
        .form-group select {
            -webkit-appearance: none; /* Removes default styling */
            border-radius: 8px;
        }
        
        .auth-btn {
            -webkit-appearance: none;
        }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --background-color: #1a1a2e;
            --text-color: #e6e6e6;
            --light-text: #a7a7a7;
            --white: #222236;
            --border-color: #393954;
        }
        
        .social-btn {
            background-color: #2a2a42;
            border-color: #393954;
        }
        
        .social-btn:hover {
            background-color: #33334d;
        }
        
        .strength-segment {
            background-color: #444;
        }
        
        .form-group input,
        .form-group select {
            background-color: #2a2a42;
            color: var(--text-color);
        }
        
        .form-group input::placeholder,
        .form-group select::placeholder {
            color: #777;
        }
    }
    
    /* Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .auth-container {
        animation: fadeIn 0.5s ease forwards;
    }
    
    /* Accessibility improvements */
    .auth-btn:focus,
    .social-btn:focus,
    input:focus,
    select:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    /* Dashboard Styles - Fixed for vertical overflow issues */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    position: relative;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
}

.dashboard-page {
    display: none;
    flex-direction: column;
    height: 100vh; /* Use viewport height instead of min-height */
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    position: fixed; /* Fix the position to prevent page movement */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--background-color);
}

.dashboard-page.active {
    display: flex;
}

/* Top Navigation Bar */
.dashboard-nav {
    background-color: var(--white);
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: relative; /* Changed from sticky to relative */
    width: 100%;
    z-index: 100;
    flex-shrink: 0; /* Prevent shrinking */
    height: 56px; /* Fixed height */
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.profile-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--primary-color);
    flex-shrink: 0;
}

.profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.username {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100px;
}

.trophy-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--primary-color);
    color: var(--white);
    padding: 6px 15px;
    border-radius: 50px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(108, 92, 231, 0.2);
    font-size: 0.9rem;
    white-space: nowrap;
}

.trophy-btn:hover {
    background-color: var(--primary-dark);
}

.trophy-btn i {
    font-size: 0.9rem;
}

.hamburger-menu {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.hamburger-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.hamburger-menu i {
    font-size: 1.2rem;
    color: var(--text-color);
}

/* Main Dashboard Container */
.dashboard-container {
    flex: 1;
    padding: 15px;
    width: 100%;
    overflow-y: auto; /* Allow vertical scrolling within container */
    -webkit-overflow-scrolling: touch;
}

/* Action Buttons - Single Row */
.action-buttons-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    padding-bottom: 5px;
    flex-shrink: 0; /* Prevent shrinking */
}

.action-buttons-row::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

.action-btn {
    background-color: var(--white);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
}

.action-btn:active {
    transform: scale(0.95);
}

.action-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

/* Spinning animation for spin icon */
.spin-icon {
    position: relative;
    overflow: hidden;
}

.spin-icon i {
    animation: spin 5s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.spin-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    border: 2px dashed var(--success-color);
    animation: spin-reverse 10s linear infinite;
}

@keyframes spin-reverse {
    0% {
        transform: rotate(360deg);
    }
    100% {
        transform: rotate(0deg);
    }
}

.wallet-btn .action-icon {
    background-color: rgba(108, 92, 231, 0.1);
    color: var(--primary-color);
}

.creator-btn .action-icon {
    background-color: rgba(253, 121, 168, 0.1);
    color: var(--secondary-color);
}

.spin-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: var(--success-color);
}

.notification-btn .action-icon {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
}

.action-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: var(--text-color);
    text-align: center;
    white-space: nowrap;
}

/* Fix for page transition */
.container {
    position: relative;
}

.split-screen.hidden {
    display: none;
}

/* Responsive Styles for Dashboard */
@media (max-width: 360px) {
    .dashboard-nav {
        padding: 8px 10px;
        height: 50px;
    }
    
    .profile-circle {
        width: 32px;
        height: 32px;
    }
    
    .username {
        font-size: 0.85rem;
        max-width: 80px;
    }
    
    .trophy-btn {
        padding: 5px 10px;
        font-size: 0.8rem;
    }
    
    .trophy-btn i {
        font-size: 0.8rem;
    }
    
    .hamburger-menu {
        width: 32px;
        height: 32px;
    }
    
    .hamburger-menu i {
        font-size: 1.1rem;
    }
    
    .action-buttons-row {
        gap: 8px;
    }
    
    .action-btn {
        min-width: 60px;
        padding: 8px;
    }
    
    .action-icon {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
    
    .action-btn span {
        font-size: 0.75rem;
    }
}

/* iPhone X and newer notch fixes */
@supports (padding: max(0px)) {
    .dashboard-nav {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-top: max(10px, env(safe-area-inset-top));
    }
    
    .dashboard-container {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-bottom: max(15px, env(safe-area-inset-bottom));
    }
}

/* Fix for very small screens */
@media (max-width: 320px) {
    .action-buttons-row {
        justify-content: flex-start;
    }
    
    .action-btn {
        min-width: 55px;
    }
    
    .action-icon {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
    }
    
    .action-btn span {
        font-size: 0.7rem;
    }
    
    .trophy-btn span {
        display: none;
    }
    
    .trophy-btn {
        width: 32px;
        height: 32px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .trophy-btn i {
        margin: 0;
    }
}


/* Profile Modal Responsive Styles */

/* Base modal styles */
.profile-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
}

.profile-modal.active {
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.profile-modal-content {
    background-color: #fff;
    width: 90%;
    max-width: 500px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    animation: modalFadeIn 0.3s ease;
    padding: 0;
    position: relative;
}

/* Modal header */
.profile-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #eee;
    background-color: #f8f9fa;
}

.profile-modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: #333;
    font-weight: 600;
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 0;
    line-height: 1;
}

/* Emoji Avatar Section */
.emoji-avatar-wrapper {
    position: relative;
    cursor: pointer;
    width: 90px;
    height: 90px;
    margin: 20px auto;
}

.current-emoji-avatar {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 45px;
    background-color: #f0f0f0;
    border-radius: 50%;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.current-emoji-avatar:hover, .current-emoji-avatar:active {
    background-color: #e0e0e0;
    transform: scale(1.05);
}

.emoji-selector {
    position: absolute;
    top: 110%;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    padding: 12px;
    display: none;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    z-index: 10;
    width: 200px;
    max-width: 90vw;
}

.emoji-selector.active {
    display: grid;
    animation: fadeIn 0.2s ease-in-out;
}

.emoji-option {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.2s ease;
    background-color: #f8f8f8;
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.emoji-option:hover, .emoji-option:active {
    background-color: #f0f0f0;
    transform: scale(1.1);
}

/* Form styles */
#profileForm, #changePasswordForm {
    padding: 0 20px 20px;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #0c0000;
    font-size: 0.9rem;
}

.form-group input, 
.form-group select, 
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px; /* Prevent zoom on iOS */
    background-color: #f7f4f4;
    transition: border-color 0.3s;
    box-sizing: border-box;
    -webkit-appearance: none; /* Remove default styling on iOS */
    appearance: none;
    color: #0c0000;
   
}

.form-group input:focus, 
.form-group select:focus, 
.form-group textarea:focus {
    border-color: #6c5ce7;
    outline: none;
    background-color: #fff;
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

/* Password input styling */
.password-input {
    position: relative;
}

.password-input input {
    padding-right: 40px;
}

.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #777;
}

/* Password strength meter */
.password-strength {
    margin-top: 8px;
}

.strength-meter {
    display: flex;
    gap: 4px;
    margin-bottom: 4px;
}

.strength-segment {
    height: 4px;
    flex: 1;
    background-color: #ddd;
    border-radius: 2px;
}

.strength-segment.weak {
    background-color: #ff4757;
}

.strength-segment.medium {
    background-color: #ffa502;
}

.strength-segment.strong {
    background-color: #2ed573;
}

.strength-text {
    font-size: 0.75rem;
    color: #777;
}

/* Action buttons */
.profile-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.primary-btn, .secondary-btn {
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
    border: none;
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.primary-btn {
    background-color: #6c5ce7;
    color: white;
}

.primary-btn:hover, .primary-btn:active {
    background-color: #5649c0;
}

.secondary-btn {
    background-color: #f0f0f0;
    color: #333;
}

.secondary-btn:hover, .secondary-btn:active {
    background-color: #e0e0e0;
}

/* Change password section */
.change-password-section {
    padding: 0 20px 20px;
    border-top: 1px solid #eee;
    margin-top: 10px;
}

.change-password-section h3 {
    margin: 16px 0;
    font-size: 1.1rem;
    color: #333;
}

.hidden {
    display: none;
}

/* Animation keyframes */
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* Media queries for better responsiveness */
@media (max-width: 480px) {
    .profile-modal-content {
        width: 95%;
        margin: 10px auto;
    }
    
    .emoji-avatar-wrapper {
        width: 80px;
        height: 80px;
    }
    
    .current-emoji-avatar {
        font-size: 40px;
    }
    
    .emoji-selector {
        width: 180px;
        padding: 8px;
        gap: 8px;
    }
    
    .emoji-option {
        width: 36px;
        height: 36px;
        font-size: 20px;
    }
    
    .profile-actions {
        flex-direction: column-reverse;
        gap: 8px;
    }
    
    .primary-btn, .secondary-btn {
        width: 100%;
        padding: 12px 16px;
    }
    
    .form-group input, 
    .form-group select, 
    .form-group textarea {
        padding: 14px 12px;
    }
}

/* Fix for iOS input zoom */
@media screen and (-webkit-min-device-pixel-ratio: 0) { 
    select,
    textarea,
    input {
        font-size: 16px;
    }
}

/* Fix for notched iPhones */
@supports (padding: max(0px)) {
    .profile-modal {
        padding-top: max(20px, env(safe-area-inset-top));
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}


/* Sidebar Menu */
.sidebar-menu {
    position: fixed;
    top: 0;
    left: -300px;
    width: 280px;
    height: 100%;
    background-color: var(--sidebar-bg);
    z-index: 1000;
    transition: left 0.3s ease;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.sidebar-menu.active {
    left: 0;
}

/* Sidebar Header */
.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid var(--sidebar-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-user-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.user-details {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--sidebar-text);
}

.user-email {
    font-size: 12px;
    color: var(--sidebar-text);
    opacity: 0.8;
}

.close-sidebar {
    background: none;
    border: none;
    color: var(--sidebar-text);
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
}

/* Sidebar Content */
.sidebar-content {
    flex: 1;
    padding: 20px 0;
}

.sidebar-menu-items {
    list-style: none;
    padding: 0;
    margin: 0;
}

.menu-item {
    margin-bottom: 5px;
}

.menu-item a {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: var(--sidebar-text);
    text-decoration: none;
    transition: all 0.2s ease;
}

.menu-item a:hover {
    background-color: var(--sidebar-hover);
}

.menu-item a i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

.logout-btn {
    color: #ff6b6b !important;
}

/* Theme Toggle */
.theme-toggle {
    padding: 12px 20px;
}

.theme-switch-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: var(--sidebar-text);
}

.theme-switch-wrapper span {
    display: flex;
    align-items: center;
}

.theme-switch-wrapper span i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

.theme-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--toggle-bg);
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: var(--toggle-ball);
    transition: .4s;
}

input:checked + .slider {
    background-color: var(--toggle-active);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

/* Sidebar Footer */
.sidebar-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--sidebar-border);
    text-align: center;
}

.app-version {
    font-size: 12px;
    color: var(--sidebar-text);
    opacity: 0.7;
}

/* Overlay */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--overlay-bg);
    z-index: 999;
    display: none;
}

.sidebar-overlay.active {
    display: block;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--overlay-bg);
    z-index: 1001;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.modal.active {
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.modal-content {
    background-color: var(--modal-bg);
    width: 90%;
    max-width: 600px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    animation: modalFadeIn 0.3s ease;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--modal-border);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--modal-text);
    font-weight: 600;
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--modal-text);
    padding: 0;
    line-height: 1;
}

.modal-body {
    padding: 20px;
    color: var(--modal-text);
    max-height: 70vh;
    overflow-y: auto;
}

.terms-content h3, .privacy-content h3 {
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.1rem;
    color: var(--modal-text);
}

.terms-content p, .privacy-content p {
    margin-bottom: 15px;
    line-height: 1.5;
    font-size: 0.95rem;
}

/* Animation keyframes */
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Media queries for better responsiveness */
@media (max-width: 480px) {
    .sidebar-menu {
        width: 260px;
    }
    
    .hamburger-menu {
        top: 15px;
        left: 15px;
        width: 36px;
        height: 36px;
    }
    
    .modal-content {
        width: 95%;
        margin: 10px auto;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}

/* Fix for notched iPhones */
@supports (padding: max(0px)) {
    .sidebar-menu {
        padding-top: max(0px, env(safe-area-inset-top));
        padding-bottom: max(0px, env(safe-area-inset-bottom));
    }
    
    .modal {
        padding-top: max(20px, env(safe-area-inset-top));
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}


/* Wallet Feature Styles */
:root {
    --primary-color: #6c5ce7;
    --primary-light: #a29bfe;
    --primary-dark: #5641e5;
    --secondary-color: #00b894;
    --secondary-light: #55efc4;
    --secondary-dark: #00a785;
    --danger-color: #e74c3c;
    --warning-color: #f39c12;
    --success-color: #2ecc71;
    --info-color: #3498db;
    --text-color: #333;
    --text-light: #666;
    --text-lighter: #999;
    --bg-color: #fff;
    --bg-light: #f8f9fa;
    --bg-dark: #eee;
    --border-color: #ddd;
    --border-radius: 10px;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

/* Modal Base Styles */
.wallet-modal,
.feature-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.wallet-modal.active,
.feature-modal.active {
    display: flex;
}

.wallet-container,
.feature-modal-content {
    background-color: var(--bg-color);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    width: 90%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    z-index: 1001;
    animation: modalFadeIn 0.3s ease;
}

.wallet-header,
.feature-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
}

.wallet-header h2,
.feature-modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--text-color);
    font-weight: 600;
}

.close-wallet,
.close-feature-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-light);
    padding: 0;
    line-height: 1;
}

.wallet-screen,
.feature-modal-body {
    padding: 20px;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
}

.modal-overlay.active {
    display: block;
}

/* PIN Setup/Entry Styles */
.pin-setup,
.pin-entry {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.pin-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background-color: var(--primary-light);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    margin-bottom: 20px;
}

.pin-setup h3,
.pin-entry h3 {
    margin: 0 0 10px;
    font-size: 1.2rem;
    color: var(--text-color);
}

.pin-setup p,
.pin-entry p {
    margin: 0 0 20px;
    color: var(--text-light);
    font-size: 0.95rem;
}

.pin-input-container,
.otp-input-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
}

.pin-digit,
.pin-confirm-digit,
.pin-login-digit,
.withdraw-pin-digit,
.current-pin-digit,
.new-pin-digit,
.confirm-new-pin-digit,
.transfer-pin-digit,
.otp-digit {
    width: 45px;
    height: 45px;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    text-align: center;
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--text-color);
    background-color: var(--bg-light);
    transition: var(--transition);
}

.pin-digit:focus,
.pin-confirm-digit:focus,
.pin-login-digit:focus,
.withdraw-pin-digit:focus,
.current-pin-digit:focus,
.new-pin-digit:focus,
.confirm-new-pin-digit:focus,
.transfer-pin-digit:focus,
.otp-digit:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
}

.otp-input-container {
    gap: 8px;
}

.otp-digit {
    width: 40px;
    height: 40px;
}

/* Button Styles */
.wallet-btn {
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    font-size: 0.95rem;
    display: inline-block;
    text-align: center;
    margin-top: 10px;
}

.primary-btn {
    background-color: var(--primary-color);
    color: white;
}

.primary-btn:hover {
    background-color: var(--primary-dark);
}

.secondary-btn {
    background-color: var(--bg-dark);
    color: var(--text-color);
}

.secondary-btn:hover {
    background-color: var(--border-color);
}

.text-btn {
    background: none;
    color: var(--primary-color);
    padding: 8px 16px;
}

.text-btn:hover {
    text-decoration: underline;
}

/* Wallet Dashboard Styles */
.wallet-info {
    margin-bottom: 20px;
}

.wallet-id-container {
    display: flex;
    align-items: center;
    background-color: var(--bg-light);
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.wallet-id-label {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-right: 8px;
}

.wallet-id {
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.95rem;
    flex-grow: 1;
}

.copy-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    cursor: pointer;
    padding: 5px;
    font-size: 0.9rem;
}

.balance-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.balance-card {
    background-color: var(--bg-light);
    border-radius: var(--border-radius);
    padding: 15px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}
d.talent-coin {
    background-color: var(--primary-light);
    color: white;
}

.balance-card.commission {
    background-color: var(--secondary-light);
    color: white;
}

.balance-icon {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.balance-details h3 {
    margin: 0 0 8px;
    font-size: 0.9rem;
    font-weight: 500;
    opacity: 0.9;
}

.balance-amount {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 5px;
}

.balance-equivalent {
    font-size: 0.85rem;
    opacity: 0.8;
}

.wallet-actions {
    margin-bottom: 25px;
}

.action-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

.wallet-action-btn {
    background-color: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
}

.wallet-action-btn:hover {
    background-color: var(--bg-dark);
    transform: translateY(-2px);
}

.wallet-action-btn .action-icon {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.wallet-action-btn span {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color);
}

/* Transaction History Styles */
.transaction-history {
    border-top: 1px solid var(--border-color);
    padding-top: 20px;
}

.transaction-history h3 {
    margin: 0 0 15px;
    font-size: 1.1rem;
    color: var(--text-color);
}

.transaction-list {
    max-height: 300px;
    overflow-y: auto;
}

.empty-transactions {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 30px 0;
    color: var(--text-lighter);
}

.empty-transactions i {
    font-size: 2rem;
    margin-bottom: 10px;
}

.transaction-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.transaction-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--bg-light);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    color: var(--primary-color);
}

.transaction-details {
    flex-grow: 1;
}

.transaction-title {
    font-weight: 500;
    color: var(--text-color);
    font-size: 0.95rem;
    margin-bottom: 4px;
}

.transaction-date {
    font-size: 0.8rem;
    color: var(--text-lighter);
}

.transaction-amount {
    text-align: right;
    display: flex;
    flex-direction: column;
}

.amount-value {
    font-weight: 600;
    color: var(--text-color);
    font-size: 0.95rem;
}

.amount-value.credit {
    color: var(--success-color);
}

.amount-value.debit {
    color: var(--danger-color);
}

.amount-status {
    font-size: 0.75rem;
    color: var(--text-lighter);
    text-transform: uppercase;
}

.amount-status.pending {
    color: var(--warning-color);
}

.amount-status.completed {
    color: var(--success-color);
}

.amount-status.failed {
    color: var(--danger-color);
}

/* Feature Modal Specific Styles */
.tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 20px;
}

.tab {
    padding: 12px 20px;
    cursor: pointer;
    font-weight: 500;
    color: var(--text-light);
    position: relative;
    transition: var(--transition);
}

.tab.active {
    color: var(--primary-color);
}

.tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 100%;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 3px 3px 0 0;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-color);
    font-size: 0.95rem;
}

.input-group input,
.input-group select {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    color: var(--text-color);
    background-color: var(--bg-light);
    transition: var(--transition);
}

.input-group input:focus,
.input-group select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
}

.input-group input:disabled {
    background-color: var(--bg-dark);
    cursor: not-allowed;
}

.input-note {
    font-size: 0.8rem;
    color: var(--text-lighter);
    margin-top: 5px;
}

.naira-equivalent {
    background-color: var(--bg-light);
    padding: 12px 15px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.naira-equivalent .amount {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.1rem;
}

.account-details {
    background-color: var(--bg-light);
    border-radius: var(--border-radius);
    padding: 15px;
    margin-bottom: 20px;
}

.account-details h3 {
    margin: 0 0 10px;
    font-size: 1rem;
    color: var(--text-color);
}

.account-info {
    margin-bottom: 15px;
}

.account-row {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.account-row .label {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-right: 8px;
    min-width: 120px;
}

.account-row .value {
    font-weight: 500;
    color: var(--text-color);
    flex-grow: 1;
}

.instructions {
    font-size: 0.9rem;
    color: var(--text-light);
}

.instructions p {
    margin: 8px 0;
}

.file-upload {
    position: relative;
    margin-top: 10px;
}

.file-upload input[type="file"] {
    position: absolute;
    width: 0.1px;
    height: 0.1px;
    opacity: 0;
    overflow: hidden;
    z-index: -1;
}

.file-upload-btn {
    display: inline-block;
    padding: 10px 15px;
    background-color: var(--bg-dark);
    color: var(--text-color);
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition);
}

.file-upload-btn:hover {
    background-color: var(--border-color);
}

.file-name {
    margin-top: 8px;
    font-size: 0.85rem;
    color: var(--text-light);
    word-break: break-all;
}

.verification-options {
    margin-bottom: 20px;
}

.verification-options h3 {
    margin: 0 0 15px;
    font-size: 1.1rem;
    color: var(--text-color);
}

.option-buttons {
    display: flex;
    gap: 10px;
}

.option-btn {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background-color: var(--bg-light);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
}

.option-btn.active {
    border-color: var(--primary-color);
    background-color: rgba(108, 92, 231, 0.1);
}

.option-btn i {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 8px;
}

.option-btn span {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-color);
}

.verification-section {
    margin-bottom: 20px;
}

.resend-otp {
    text-align: center;
    margin: 10px 0;
    font-size: 0.85rem;
    color: var(--text-light);
}

.fee-calculation {
    background-color: var(--bg-light);
    border-radius: var(--border-radius);
    padding: 15px;
    margin: 20px 0;
}

.fee-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 0.95rem;
    color: var(--text-color);
}

.fee-row.total {
    font-weight: 600;
    font-size: 1.05rem;
    color: var(--primary-color);
}

.fee-divider {
    height: 1px;
    background-color: var(--border-color);
    margin: 10px 0;
}

.fee-note {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    color: var(--text-light);
    margin-bottom: 20px;
}

.fee-note i {
    margin-right: 8px;
    color: var(--info-color);
}

/* Utility Classes */
.hidden {
    display: none !important;
}

/* Animation */
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Media Queries */
@media (max-width: 480px) {
    .balance-cards {
        grid-template-columns: 1fr;
    }
    
    .action-row {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .option-buttons {
        flex-direction: column;
    }
    
    .pin-digit,
    .pin-confirm-digit,
    .pin-login-digit,
    .withdraw-pin-digit,
    .current-pin-digit,
    .new-pin-digit,
    .confirm-new-pin-digit,
    .transfer-pin-digit {
        width: 40px;
        height: 40px;
    }
    
    .otp-digit {
        width: 35px;
        height: 35px;
    }
}

/* Fix for notched iPhones */
@supports (padding: max(0px)) {
    .wallet-container,
    .feature-modal-content {
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }

    :root {
    --primary-color: #4285f4;
    --secondary-color: #34a853;
    --accent-color: #fbbc05;
    --danger-color: #ea4335;
    --dark-color: #202124;
    --text-color: #3c4043;
    --light-color: #f8f9fa;
    --border-color: #dadce0;
    --card-bg: #ffffff;
    --shadow-color: rgba(0, 0, 0, 0.1);
    --header-height: 64px;
    --border-radius: 8px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Roboto', sans-serif;
}

body {
    background-color: var(--light-color);
    color: var(--text-color);
    line-height: 1.5;
} .app-logo {
    font-size: 36px;
    color: var(--primary-color);
    margin-bottom: 15px;
}


.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-color);
}

.form-group input {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-group input:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
}


/* Dashboard */
.dashboard {
   
    flex-direction: column;
  width:100%;
   overflow-x: hidden;
   position: fixed;
   top: 0;
   left: 0;
   right: 0;
   bottom: -50px;
   background-color: #f8f9fa;
   z-index: 1000;
    min-height: 100vh;
    padding-top: var(--header-height);
}

.dashboard-content {
    padding: 20px;
    max-width: 1400px;
    margin: 0 auto;
}

.app-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: var(--header-height);
    background-color: var(--card-bg);
    box-shadow: 0 2px 5px var(--shadow-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    z-index: 100;
}

.header-left {
    display: flex;
    align-items: center;
}

.app-logo {
    font-size: 24px;
    color: var(--primary-color);
    margin-right: 15px;
}

.app-header h1 {
    font-size: 20px;
    font-weight: 500;
    color: var(--dark-color);
}

.header-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.moderator-info {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.moderator-name {
    font-weight: 500;
    font-size: 14px;
}

.status-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

.status-badge.online {
    background-color: rgba(52, 168, 83, 0.1);
    color: var(--secondary-color);
}

.status-badge.pending {
    background-color: rgba(251, 188, 5, 0.1);
    color: var(--accent-color);
}

.status-badge.completed, .status-badge.successful {
    background-color: rgba(52, 168, 83, 0.1);
    color: var(--secondary-color);
}

.status-badge.rejected, .status-badge.failed {
    background-color: rgba(234, 67, 53, 0.1);
    color: var(--danger-color);
}

.icon-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: transparent;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
}

.icon-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.icon-btn i {
    font-size: 18px;
    color: var(--text-color);
}

/* Activity Summary */
.activity-summary {
    margin-bottom: 30px;
}

.activity-summary h2 {
    font-size: 20px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 15px;
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
}

.summary-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 20px;
    text-align: center;
}

.summary-value {
    font-size: 28px;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.summary-label {
    font-size: 14px;
    color: #70757a;
}

/* Recent Activity */
.recent-activity {
    margin-bottom: 30px;
}

.recent-activity h2 {
    font-size: 20px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 15px;
}

.activity-list {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 15px;
    max-height: 400px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(66, 133, 244, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
}

.activity-icon i {
    color: var(--primary-color);
    font-size: 16px;
}

.activity-details {
    flex: 1;
}

.activity-title {
    font-weight: 500;
    margin-bottom: 3px;
}

.activity-time {
    font-size: 12px;
    color: #70757a;
}

/* Feature Sections */
.feature-section {
    margin-bottom: 40px;
    padding: 20px;
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
}

.section-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.back-btn {
    display: none; /* Hide back buttons since we're using a scrollable approach */
}

.section-header h2 {
    font-size: 20px;
    font-weight: 500;
    color: var(--dark-color);
    flex: 1;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 15px;
}

.filter-dropdown {
    position: relative;
}

.filter-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--light-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 8px 15px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.filter-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background-color: var(--card-bg);
    border-radius: 4px;
    box-shadow: 0 2px 10px var(--shadow-color);
    min-width: 180px;
    z-index: 10;
    display: none;
}

.dropdown-menu.active {
    display: block;
}

.dropdown-menu a {
    display: block;
    padding: 10px 15px;
    text-decoration: none;
    color: var(--text-color);
    transition: background-color 0.2s;
}

.dropdown-menu a:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.dropdown-menu a.active {
    background-color: rgba(66, 133, 244, 0.1);
    color: var(--primary-color);
}

.search-box {
    position: relative;
    width: 250px;
}

.search-box input {
    width: 100%;
    padding: 8px 15px;
    padding-right: 40px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    outline: none;
}

.search-box i {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #70757a;
}

/* Request Cards */
.request-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.request-card {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 15px;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
}

.request-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px var(--shadow-color);
}

.request-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.user-info .username {
    font-weight: 500;
    font-size: 16px;
    margin-bottom: 3px;
}

.user-info .request-id {
    font-size: 12px;
    color: #70757a;
}

.request-details {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.detail-label {
    font-size: 13px;
    color: #70757a;
}

.detail-value {
    font-weight: 500;
    font-size: 13px;
}

/* Transfer Support */
.transfer-tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 20px;
    overflow-x: auto;
}

.tab {
    padding: 12px 20px;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-color);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: color 0.2s, border-bottom-color 0.2s;
    white-space: nowrap;
}

.tab.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.transfer-list, .report-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.transfer-item, .report-item {
    background-color: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 15px;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
}

.transfer-item:hover, .report-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px var(--shadow-color);
}

.transfer-header, .report-header {
    display: flex;
    .transfer-header, .report-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.transfer-info .transfer-title, .report-info .report-title {
    font-weight: 500;
    font-size: 16px;
    margin-bottom: 3px;
}

.transfer-info .transfer-id, .report-info .report-id {
    font-size: 12px;
    color: #70757a;
}

.transfer-details, .report-details {
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    margin-bottom: 15px;
}

.report-message {
    font-size: 14px;
    color: var(--text-color);
    background-color: var(--light-color);
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
}

.report-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.text-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    padding: 5px;
}

.text-btn:hover {
    text-decoration: underline;
}

/* Talent Coin Dispenser */
.dispenser-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.dispenser-form {
    background-color: var(--light-color);
    border-radius: var(--border-radius);
    padding: 20px;
}

.input-group {
    margin-bottom: 20px;
}

.input-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.input-group input, .input-group select, .input-group textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    outline: none;
}

.input-group input:focus, .input-group select:focus, .input-group textarea:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
}

.radio-group {
    display: flex;
    gap: 20px;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.primary-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.primary-btn:hover {
    background-color: #3367d6;
}

.user-info-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.user-info-header h3 {
    font-size: 18px;
    font-weight: 500;
    color: var(--dark-color);
}

.refresh-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: var(--light-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
}

.refresh-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.refresh-btn i {
    color: var(--text-color);
    font-size: 14px;
}

.user-info-content {
    background-color: var(--light-color);
    border-radius: var(--border-radius);
    padding: 20px;
    margin-bottom: 20px;
}

.user-info-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.info-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.info-label {
    font-size: 13px;
    color: #70757a;
}

.info-value {
    font-weight: 500;
    font-size: 15px;
}

.recent-transactions {
    background-color: var(--light-color);
    border-radius: var(--border-radius);
    padding: 20px;
}

.recent-transactions h3 {
    font-size: 18px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 15px;
}

.transaction-list {
    max-height: 300px;
    overflow-y: auto;
}

.transaction-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-color);
}

.transaction-item:last-child {
    border-bottom: none;
}

.transaction-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(66, 133, 244, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
}

.transaction-icon i {
    color: var(--primary-color);
    font-size: 16px;
}

.transaction-details {
    flex: 1;
}

.transaction-title {
    font-weight: 500;
    margin-bottom: 3px;
}

.transaction-time {
    font-size: 12px;
    color: #70757a;
}

.transaction-amount {
    font-weight: 500;
}

.transaction-amount.credit {
    color: var(--secondary-color);
}

.transaction-amount.debit {
    color: var(--danger-color);
}

/* Fees Reporter */
.fee-summary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.fee-summary .summary-card {
    position: relative;
    padding-right: 50px;
    text-align: left;
}

.fee-summary .summary-card.total {
    background-color: rgba(66, 133, 244, 0.1);
}

.fee-summary .summary-card.today {
    background-color: rgba(52, 168, 83, 0.1);
}

.fee-summary .summary-card.week {
    background-color: rgba(251, 188, 5, 0.1);
}

.fee-summary .summary-card.month {
    background-color: rgba(234, 67, 53, 0.1);
}

.fee-summary .summary-card h3 {
    font-size: 16px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 10px;
}

.fee-summary .summary-card .amount {
    font-size: 24px;
    font-weight: 700;
}

.fee-summary .summary-card .card-icon {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 24px;
    opacity: 0.3;
}

.fee-summary .summary-card.total .card-icon {
    color: var(--primary-color);
}

.fee-summary .summary-card.today .card-icon {
    color: var(--secondary-color);
}

.fee-summary .summary-card.week .card-icon {
    color: var(--accent-color);
}

.fee-summary .summary-card.month .card-icon {
    color: var(--danger-color);
}

.charts-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.chart-card {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 20px;
}

.chart-card h3 {
    font-size: 16px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 15px;
}

.transactions-section {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 2px 5px var(--shadow-color);
    padding: 20px;
}

.transactions-section .section-header {
    margin-bottom: 20px;
}

.transactions-section .actions {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
}

.search-container {
    position: relative;
    width: 250px;
}

.search-container input {
    width: 100%;
    padding: 8px 15px;
    padding-right: 40px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    outline: none;
}

.search-container i {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #70757a;
}

.filter-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

.filter-container select {
    padding: 8px 15px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    outline: none;
    background-color: var(--card-bg);
}

.custom-date-range {
    display: flex;
    align-items: center;
    gap: 10px;
}

.custom-date-range input[type="date"] {
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 14px;
    outline: none;
}

.export-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--light-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 8px 15px;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.export-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.table-container {
    overflow-x: auto;
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table th, table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid var(--border-color);
}

table th {
    font-weight: 500;
    color: #70757a;
    position: relative;
    cursor: pointer;
}

table th i {
    font-size: 12px;
    margin-left: 5px;
}

table tbody tr {
    transition: background-color 0.2s;
}

table tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

.pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.pagination button {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: var(--light-color);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
}

.pagination button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination button:hover:not(:disabled) {
    background-color: rgba(0, 0, 0, 0.05);
}

.pagination #pageNumbers {
    display: flex;
    gap: 5px;
}

.pagination .page-number {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s;
}

.pagination .page-number.active {
    background-color: var(--primary-color);
    color: white;
}

.pagination .page-number:hover:not(.active) {
    background-color: rgba(0, 0, 0, 0.05);
}

/* Modals */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
}

.modal.active {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: modalSlideIn 0.3s forwards;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h3 {
    font-size: 18px;
    font-weight: 500;
    color: var(--dark-color);
}
.close-modal, .close-btn {
    background: none;
    border: none;
    font-size: 20px;
    color: #70757a;
    cursor: pointer;
    transition: color 0.2s;
}

.close-modal:hover, .close-btn:hover {
    color: var(--danger-color);
}

.modal-body {
    padding: 20px;
}

.modal-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.secondary-btn {
    background-color: var(--light-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.secondary-btn:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.confirmation-message {
    text-align: center;
    padding: 20px 0;
    font-size: 16px;
}

/* Request Details */
.request-details-container {
    padding: 10px;
}

.user-profile {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}

.user-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: rgba(66, 133, 244, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
}

.user-avatar i {
    font-size: 24px;
    color: var(--primary-color);
}

.user-info .username {
    font-size: 18px;
    font-weight: 500;
    margin-bottom: 5px;
}

.user-info .wallet-id {
    font-size: 14px;
    color: #70757a;
}

.details-section {
    margin-bottom: 25px;
}

.details-section h4 {
    font-size: 16px;
    font-weight: 500;
    color: var(--dark-color);
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color);
}

.details-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.detail-row {
    display: flex;
    align-items: center;
}

.detail-label {
    width: 150px;
    font-size: 14px;
    color: #70757a;
}

.detail-value {
    font-size: 14px;
    font-weight: 500;
}

.screenshot-container {
    text-align: center;
}

.screenshot-container img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 4px;
    border: 1px solid var(--border-color);
}

.action-notes {
    margin-bottom: 20px;
}

.action-notes label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.action-notes textarea {
    width: 100%;
    height: 100px;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    resize: vertical;
}

.transfer-confirmation {
    margin-bottom: 20px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.copy-wallet-section {
    background-color: var(--light-color);
    border-radius: 4px;
    padding: 15px;
}

.wallet-copy-field {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 5px;
}

.wallet-copy-field span {
    font-family: monospace;
    font-size: 16px;
    font-weight: 500;
}

.copy-btn {
    background: none;
    border: none;
    color: var(--primary-color);
    cursor: pointer;
}

.copy-message {
    font-size: 12px;
    color: #70757a;
}

/* Empty States */
.empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    text-align: center;
}

.empty-state i {
    font-size: 48px;
    color: #dadce0;
    margin-bottom: 15px;
}

.empty-state p {
    font-size: 16px;
    color: #70757a;
}

/* Responsive Styles */
@media (max-width: 1200px) {
    .summary-cards, .fee-summary {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .charts-container {
        grid-template-columns: 1fr;
    }
    
    .dispenser-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .app-header h1 {
        font-size: 18px;
    }
    
    .moderator-name {
        display: none;
    }
    
    .summary-cards, .fee-summary {
        grid-template-columns: 1fr;
    }
    
    .request-cards, .transfer-list, .report-list {
        grid-template-columns: 1fr;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .header-actions {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-box {
        width: 100%;
    }
    
    .user-info-details {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        width: 95%;
    }
}

/* Utility Classes */
.hidden {
    display: none !important;
}

/* Make all feature sections visible by default in the scrollable dashboard */
.feature-section {
    display: block !important;
}

/* Add section dividers for better visual separation */
.feature-section {
    position: relative;
    margin-top: 40px;
    padding-top: 40px;
}

.feature-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, var(--border-color), transparent);
}

/* Add section navigation */
.section-navigation {
    position: sticky;
    top: var(--header-height);
    background-color: var(--card-bg);
    padding: 10px 20px;
    margin: 0 -20px 20px;
    display: flex;
    overflow-x: auto;
    z-index: 90;
    box-shadow: 0 2px 5px var(--shadow-color);
}

.section-navigation a {
    padding: 10px 15px;
    white-space: nowrap;
    color: var(--text-color);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s;
}

.section-navigation a:hover {
    color: var(--primary-color);
}

.section-navigation a.active {
    color: var(--primary-color);
    border-bottom: 2px solid var(--primary-color);
}



</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    
    <div class="container">
        
        <div class="split-screen">
            <div class="left">
                <div class="logo">
                    <h1>Rewarder</h1>
                </div>
                <div class="tagline">
                    <h2>Discover Talent. Vote. Win.</h2>
                    <p>Join the platform where talent gets rewarded and voters earn too!</p>
                </div>
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-trophy"></i>
                        <span>Compete in exciting talent categories</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-vote-yea"></i>
                        <span>Vote for your favorites and earn rewards</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-coins"></i>
                        <span>Win cash prizes and recognition</span>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="auth-container" id="loginForm">
                    <h2>Welcome Back</h2>
                    <p>Sign in to continue your journey</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google">
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign in with email</span>
                    </div>
                    
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        <div class="form-options">
                            <div class="remember-me">
                                <input type="checkbox" id="remember">
                                <label for="remember">Remember me</label>
                            </div>
                            <a href="#" class="forgot-password">Forgot password?</a>
                        </div>
                        <button type="submit" class="auth-btn">Sign In</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
                    </div>
                </div>
                
                <div class="auth-container hidden" id="signupForm">
                    <h2>Create Account</h2>
                    <p>Join the talent revolution</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google">
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign up with email</span>
                    </div>
                    
                    <form id="signupFormElement">
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="signupPassword" placeholder="Create a password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                            <div class="password-strength">
                                <div class="strength-meter">
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                </div>
                                <span class="strength-text">Password strength</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="userType">I want to join as</label>
                            <select id="userType" required>
                                <option value="" disabled selected>Select your role</option>
                                <option value="contestant">Contestant</option>
                                <option value="voter">Voter</option>
                                <option value="both">Both</option>
                            </select>
                        </div>
                        <div class="form-options">
                            <div class="terms">
                                <input type="checkbox" id="terms" required>
                                <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                            </div>
                        </div>
                        <button type="submit" class="auth-btn">Create Account</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Already have an account? <a href="#" id="showLogin">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

            
           <!-- Main Dashboard -->
  <div class="dashboard hidden" id="dashboard">
        <main class="dashboard-content">
            <header class="app-header">
                <div class="header-left">
                    <div class="app-logo">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h1>Support Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <div class="moderator-info">
                        <span class="moderator-name">Moderator</span>
                        <span class="status-badge online">Online</span>
                    </div>
                    <button class="icon-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </header>
            
            <!-- Section Navigation -->
            <div class="section-navigation">
                <a href="#overview" class="active">Overview</a>
                <a href="#buyCoinSupport">Buy Coin Support</a>
                <a href="#withdrawSupport">Withdraw Support</a>
                <a href="#transferSupport">Transfer Support</a>
                <a href="#talentCoinDispenser">Talent Coin Dispenser</a>
                <a href="#feesReporter">Fees Reporter</a>
            </div>
            
            <!-- Overview Section -->
            <div class="feature-section" id="overview">
                <div class="activity-summary">
                    <h2>Today's Activity</h2>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-value" id="todayBuyRequests">0</div>
                            <div class="summary-label">Buy Requests</div>
                        </div>
                        
                        <div class="summary-card">
                            <div class="summary-value" id="todayWithdrawals">0</div>
                  
              <div class="summary-label">Withdrawals</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-value" id="todayTransfers">0</div>
                        <div class="summary-label">Transfers</div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-value" id="todayIssues">0</div>
                        <div class="summary-label">Issues</div>
                    </div>
                </div>
            </div>
            
            <div class="recent-activity">
                <h2>Recent Activity</h2>
                <div class="activity-list" id="recentActivityList">
                    <!-- Activity items will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No recent activity</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Buy Coin Support Section -->
        <div class="feature-section" id="buyCoinSupport">
            <header class="section-header">
                <h2>Buy Coin Support</h2>
                <div class="header-actions">
                    <div class="filter-dropdown">
                        <button class="filter-btn">
                            <i class="fas fa-filter"></i>
                            <span>Filter</span>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" data-filter="all" class="active">All Requests</a>
                            <a href="#" data-filter="pending">Pending</a>
                            <a href="#" data-filter="completed">Completed</a>
                            <a href="#" data-filter="rejected">Rejected</a>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" placeholder="Search by username or wallet ID">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </header>
            
            <div class="request-cards" id="buyRequestCards">
                <!-- Request cards will be loaded here -->
                <div class="empty-state">
                    <i class="fas fa-coins"></i>
                    <p>No buy requests available</p>
                </div>
            </div>
        </div>
        
        <!-- Withdraw Support Section -->
        <div class="feature-section" id="withdrawSupport">
            <header class="section-header">
                <h2>Withdraw Support</h2>
                <div class="header-actions">
                    <div class="filter-dropdown">
                        <button class="filter-btn">
                            <i class="fas fa-filter"></i>
                            <span>Filter</span>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" data-filter="all" class="active">All Requests</a>
                            <a href="#" data-filter="pending">Pending</a>
                            <a href="#" data-filter="completed">Completed</a>
                            <a href="#" data-filter="rejected">Rejected</a>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" placeholder="Search by username or wallet ID">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </header>
            
            <div class="request-cards" id="withdrawRequestCards">
                <!-- Request cards will be loaded here -->
                <div class="empty-state">
                    <i class="fas fa-money-bill-wave"></i>
                    <p>No withdrawal requests available</p>
                </div>
            </div>
        </div>
        
        <!-- Transfer Support Section -->
        <div class="feature-section" id="transferSupport">
            <header class="section-header">
                <h2>Transfer Support</h2>
                <div class="header-actions">
                    <div class="filter-dropdown">
                        <button class="filter-btn">
                            <i class="fas fa-filter"></i>
                            <span>Filter</span>
                        </button>
                        <div class="dropdown-menu">
                            <a href="#" data-filter="all" class="active">All Transfers</a>
                            <a href="#" data-filter="successful">Successful</a>
                            <a href="#" data-filter="failed">Failed</a>
                            <a href="#" data-filter="pending">Pending</a>
                        </div>
                    </div>
                    <div class="search-box">
                        <input type="text" placeholder="Search by username or wallet ID">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </header>
            
            <div class="transfer-tabs">
                <div class="tab active" data-tab="allTransfers">All Transfers</div>
                <div class="tab" data-tab="successfulTransfers">Successful</div>
                <div class="tab" data-tab="failedTransfers">Failed</div>
                <div class="tab" data-tab="pendingTransfers">Pending</div>
                <div class="tab" data-tab="reportedTransfers">Reported</div>
            </div>
            
            <div class="tab-content active" id="allTransfers">
                <div class="transfer-list" id="allTransfersList">
                    <!-- Transfer items will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-exchange-alt"></i>
                        <p>No transfers available</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="successfulTransfers">
                <div class="transfer-list" id="successfulTransfersList">
                    <!-- Successful transfers will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>No successful transfers available</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="failedTransfers">
                <div class="transfer-list" id="failedTransfersList">
                    <!-- Failed transfers will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-times-circle"></i>
                        <p>No failed transfers available</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="pendingTransfers">
                <div class="transfer-list" id="pendingTransfersList">
                    <!-- Pending transfers will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <p>No pending transfers available</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="reportedTransfers">
                <div class="report-list" id="reportedTransfersList">
                    <!-- Reported transfers will be loaded here -->
                    <div class="empty-state">
                        <i class="fas fa-flag"></i>
                        <p>No reported transfers available</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Talent Coin Dispenser Section -->
        <div class="feature-section" id="talentCoinDispenser">
            <header class="section-header">
                <h2>Talent Coin Dispenser</h2>
            </header>
            
            <div class="dispenser-container">
                <div class="dispenser-form">
                    <div class="input-group">
                        <label for="walletId">Wallet ID</label>
                        <input type="text" id="walletId" placeholder="Enter wallet ID">
                    </div>
                    
                    <div class="input-group">
                        <label for="coinAmount">Amount</label>
                        <input type="number" id="coinAmount" placeholder="Enter amount">
                    </div>
                    
                    <div class="input-group">
                        <label>Transaction Type</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="transactionType" value="credit" checked>
                                <span>Credit</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="transactionType" value="debit">
                                <span>Debit</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="transactionReason">Reason</label>
                        <select id="transactionReason">
                            <option value="">Select reason</option>
                            <option value="bonus">Bonus</option>
                            <option value="refund">Refund</option>
                            <option value="correction">Correction</option>
                            <option value="promotion">Promotion</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="input-group" id="otherReasonGroup" style="display: none;">
                        <label for="otherReason">Specify Reason</label>
                        <input type="text" id="otherReason" placeholder="Enter reason">
                    </div>
                    
                    <div class="input-group">
                        <label for="transactionNotes">Notes</label>
                        <textarea id="transactionNotes" placeholder="Enter additional notes"></textarea>
                    </div>
                    
                    <button class="primary-btn" id="dispenseBtn">Process Transaction</button>
                </div>
                
                <div class="user-info">
                    <div class="user-info-header">
                        <h3>User Information</h3>
                        <div class="refresh-btn" id="refreshUserInfo">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                    </div>
                    
                    <div class="user-info-content" id="userInfoContent">
                        <div class="user-info-details">
                            <div class="info-group">
                                <div class="info-label">Username</div>
                                <div class="info-value" id="userInfoUsername">-</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Wallet ID</div>
                                <div class="info-value" id="userInfoWalletId">-</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Current Balance</div>
                                <div class="info-value" id="userInfoBalance">-</div>
                            </div>
                            <div class="info-group">
                                <div class="info-label">Account Status</div>
                                <div class="info-value" id="userInfoStatus">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-transactions">
                        <h3>Recent Transactions</h3>
                        <div class="transaction-list" id="userTransactionsList">
                            <!-- User transactions will be loaded here -->
                            <div class="empty-state">
                                <i class="fas fa-exchange-alt"></i>
                                <p>No transactions available</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Fees Reporter Section -->
        <div class="feature-section" id="feesReporter">
            <header class="section-header">
                <h2>Fees Reporter</h2>
            </header>
            
            <div class="fee-summary">
                <div class="summary-card total">
                    <h3>Total Fees</h3>
                    <div class="amount" id="totalFees">$0.00</div>
                    <i class="fas fa-dollar-sign card-icon"></i>
                </div>
                
                <div class="summary-card today">
                    <h3>Today</h3>
                    <div class="amount" id="todayFees">$0.00</div>
                    <i class="fas fa-calendar-day card-icon"></i>
                </div>
                
                <div class="summary-card week">
                    <h3>This Week</h3>
                    <div class="amount" id="weekFees">$0.00</div>
                    <i class="fas fa-calendar-week card-icon"></i>
                </div>
                
                <div class="summary-card month">
                    <h3>This Month</h3>
                    <div class="amount" id="monthFees">$0.00</div>
                    <i class="fas fa-calendar-alt card-icon"></i>
                </div>
            </div>
            
            <div class="charts-container">
                <div class="chart-card">
                    <h3>Fee Trends</h3>
                    <canvas id="feeTrendsChart"></canvas>
                </div>
                
                <div class="chart-card">
                    <h3>Fee Distribution</h3>
                    <canvas id="feeDistributionChart"></canvas>
                </div>
            </div>
            
            <div class="transactions-section">
                <div class="section-header">
                    <h3>Fee Transactions</h3>
                </div>
                
                <div class="actions">
                    <div class="search-container">
                        <input type="text" placeholder="Search transactions">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div class="filter-container">
                        <select id="feeTypeFilter">
                            <option value="all">All Fee Types</option>
                            <option value="transfer">Transfer Fees</option>
                            <option value="withdrawal">Withdrawal Fees</option>
                            <option value="other">Other Fees</option>
                        </select>
                        
                        <select id="dateRangeFilter">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                        
                        <div class="custom-date-range" id="customDateRange" style="display: none;">
                            <input type="date" id="startDate">
                            <span>to</span>
                            <input type="date" id="endDate">
                        </div>
                    </div>
                    
                    <button class="export-btn" id="exportFeesBtn">
                        <i class="fas fa-download"></i>
                        <span>Export</span>
                    </button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Transaction ID <i class="fas fa-sort"></i></th>
                                <th>Date <i class="fas fa-sort"></i></th>
                                <th>User <i class="fas fa-sort"></i></th>
                                <th>Type <i class="fas fa-sort"></i></th>
                                <th>Amount <i class="fas fa-sort"></i></th>
                            </tr>
                        </thead>
                        <tbody id="feeTransactionsTable">
                            <!-- Fee transactions will be loaded here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button id="prevPage" disabled><i class="fas fa-chevron-left"></i></button>
                    <div id="pageNumbers"></div>
                    <button id="nextPage"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </main>
</div>








        
               

    <!-- Dashboard Page -->
<div class="dashboard-page" id="dashboardPage">
    <!-- Top Navigation Bar -->
    <div class="dashboard-nav">
        <div class="user-info">
            <div class="profile-circle">
          <!-- User profile circle in header/navbar -->
<div class="user-profile-image emoji-avatar" id="profileCircle"></div>

            </div>
            <span class="username" id="usernameDisplay">Username</span>
        </div>
        
        <div class="trophy-btn">
            <i class="fas fa-trophy"></i>
            <span>Trophy</span>
        </div>
        
        <div class="hamburger-menu">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        <!-- Action Buttons Container - Single Row -->
        <div class="action-buttons-row">
            <div class="action-btn wallet-btn">
                <div class="action-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <span>Wallet</span>
            </div>
            
            <div class="action-btn creator-btn">
                <div class="action-icon">
                    <i class="fas fa-video"></i>
                </div>
                <span>Creator</span>
            </div>
            
            <div class="action-btn spin-btn">
                <div class="action-icon spin-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <span>Spin</span>
            </div>
            
            <div class="action-btn notification-btn">
                <div class="action-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <span>Alerts</span>
            </div>
        </div>
    </div>
</div>


<!-- Profile Modal -->
<div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
        <div class="profile-modal-header">
            <h2>My Profile</h2>
            <button class="close-modal">&times;</button>
        </div>
        
       
      <!-- Emoji Avatar Section (replaces the profile image section) -->
      <div class="emoji-avatar-wrapper" id="emojiAvatarWrapper">
        <div class="current-emoji-avatar" id="currentEmojiAvatar"></div>
        <div class="emoji-selector" id="emojiSelector">
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
          <div class="emoji-option" data-emoji=""></div>
        </div>
      </div>
      
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileFullName">Full Name</label>
                    <input type="text" id="profileFullName" placeholder="Your full name">
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" readonly>
                </div>
                
                <div class="form-group">
                    <label for="profileUserType">Account Type</label>
                    <select id="profileUserType">
                        <option value="contestant">Contestant</option>
                        <option value="voter">Voter</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                </div>
                
                <div class="profile-actions">
                    <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                    <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                </div>
            </form>
            
            <!-- Change Password Section (Hidden by default) -->
            <div id="changePasswordSection" class="change-password-section hidden">
                <h3>Change Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <div class="password-input">
                            <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <div class="password-input">
                            <input type="password" id="newPassword" placeholder="Enter new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                            </div>
                            <span class="strength-text">Password strength</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="password-input">
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                        <button type="submit" class="primary-btn">Update Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar Menu -->
<div class="sidebar-menu" id="sidebarMenu">
    <div class="sidebar-header">
        <div class="sidebar-user-info">
            <div class="user-avatar emoji-avatar" id="sidebarUserAvatar"></div>
            <div class="user-details">
                <div class="user-name" id="sidebarUserName">User Name</div>
                <div class="user-email" id="sidebarUserEmail">user@example.com</div>
            </div>
        </div>
        <button class="close-sidebar" id="closeSidebarBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="sidebar-content">
        <ul class="sidebar-menu-items">
            <li class="menu-item">
                <a href="#" id="profileMenuBtn">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </li>
            
            <li class="menu-item theme-toggle">
                <div class="theme-switch-wrapper">
                    <span>
                        <i class="fas fa-sun"></i>
                        <span>Theme</span>
                    </span>
                    <label class="theme-switch" for="themeCheckbox">
                        <input type="checkbox" id="themeCheckbox">
                        <div class="slider round"></div>
                    </label>
                </div>
            </li>
            
            <li class="menu-item">
                <a href="#" id="termsBtn">
                    <i class="fas fa-file-contract"></i>
                    <span>Terms & Conditions</span>
                </a>
            </li>
            
            <li class="menu-item">
                <a href="#" id="privacyBtn">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacy Policy</span>
                </a>
            </li>
            
            <li class="menu-item">
                <a href="#" id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>
    
    <div class="sidebar-footer">
        <div class="app-version">Version 1.0.0</div>
    </div>
</div>

<!-- Overlay for closing sidebar when clicking outside -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Terms & Conditions Modal -->
<div class="modal" id="termsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Terms & Conditions</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="terms-content">
                <h3>1. Acceptance of Terms</h3>
                <p>By accessing and using this application, you accept and agree to be bound by the terms and provisions of this agreement.</p>
                
                <h3>2. User Account</h3>
                <p>To use certain features of the application, you must register for an account. You agree to provide accurate information and keep your account secure.</p>
                
                <h3>3. User Conduct</h3>
                <p>You agree not to use the application for any illegal purposes or to conduct activities that may damage, disable, or impair the application's functionality.</p>
                
                <h3>4. Intellectual Property</h3>
                <p>All content, features, and functionality of the application are owned by us and are protected by international copyright, trademark, and other intellectual property laws.</p>
                
                <h3>5. Termination</h3>
                <p>We may terminate or suspend your account and access to the application at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users or us.</p>
                
                <h3>6. Changes to Terms</h3>
                <p>We reserve the right to modify these terms at any time. Your continued use of the application after such changes constitutes your acceptance of the new terms.</p>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal" id="privacyModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Privacy Policy</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="privacy-content">
                <h3>1. Information We Collect</h3>
                <p>We collect information you provide directly to us when you register for an account, create or modify your profile, and use the features of our application.</p>
                
                <h3>2. How We Use Information</h3>
                <p>We use the information we collect to provide, maintain, and improve our services, to develop new ones, and to protect our application and users.</p>
                
                <h3>3. Information Sharing</h3>
                <p>We do not share your personal information with companies, organizations, or individuals outside of our organization except in the following cases: with your consent, for legal reasons, or to protect rights and safety.</p>
                
                <h3>4. Data Security</h3>
                <p>We work hard to protect our users from unauthorized access to or unauthorized alteration, disclosure, or destruction of information we hold.</p>
                
                <h3>5. Data Retention</h3>
                <p>We retain your information for as long as your account is active or as needed to provide you services.</p>
                
                <h3>6. Changes to This Policy</h3>
                <p>We may change this privacy policy from time to time. We will notify you of any changes by posting the new privacy policy on this page.</p>
            </div>
        </div>
    </div>
</div>


<!-- Wallet Modal -->
<div class="wallet-modal" id="walletModal">
    <div class="wallet-container">
        <!-- PIN Setup/Entry Screen (shown first if no PIN exists) -->
        <div class="wallet-screen" id="pinScreen">
            <div class="wallet-header">
                <h2>Wallet Access</h2>
                <button class="close-wallet" id="closeWalletBtn">&times;</button>
            </div>
            
            <div class="pin-setup" id="pinSetupSection">
                <div class="pin-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Create Your Wallet PIN</h3>
                <p>Set a 4-digit PIN to secure your wallet and transactions.</p>
                
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-digit" data-index="0">
                    <input type="password" maxlength="1" class="pin-digit" data-index="1">
                    <input type="password" maxlength="1" class="pin-digit" data-index="2">
                    <input type="password" maxlength="1" class="pin-digit" data-index="3">
                </div>
                
                <div class="pin-confirm-container hidden" id="pinConfirmContainer">
                    <p>Confirm your PIN</p>
                    <div class="pin-input-container">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="0">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="1">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="2">
                        <input type="password" maxlength="1" class="pin-confirm-digit" data-index="3">
                    </div>
                </div>
                
                <button class="wallet-btn primary-btn" id="createPinBtn">Create PIN</button>
            </div>
            
            <div class="pin-entry hidden" id="pinEntrySection">
                <div class="pin-icon">
                    <i class="fas fa-unlock-alt"></i>
                </div>
                <h3>Enter Your Wallet PIN</h3>
                <p>Enter your 4-digit PIN to access your wallet.</p>
                
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="0">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="1">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="2">
                    <input type="password" maxlength="1" class="pin-login-digit" data-index="3">
                </div>
                
                <button class="wallet-btn primary-btn" id="loginPinBtn">Access Wallet</button>
                <button class="wallet-btn text-btn" id="forgotPinBtn">Forgot PIN?</button>
            </div>
        </div>
        
        <!-- Main Wallet Dashboard (shown after PIN verification) -->
        <div class="wallet-screen hidden" id="walletDashboard">
            <div class="wallet-header">
                <h2>My Wallet</h2>
                <button class="close-wallet" id="closeWalletDashboardBtn">&times;</button>
            </div>
            
            <div class="wallet-info">
                <div class="wallet-id-container">
                    <span class="wallet-id-label">Wallet ID:</span>
                    <span class="wallet-id" id="walletIdDisplay">WL123456789</span>
                    <button class="copy-btn" id="copyWalletIdBtn">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                
                <div class="balance-cards">
                    <div class="balance-card talent-coin">
                        <div class="balance-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="balance-details">
                            <h3>Talent Coin Balance</h3>
                            <div class="balance-amount" id="talentCoinBalance">0</div>
                            <div class="balance-equivalent"> <span id="nairaEquivalent">0</span></div>
                        </div>
                    </div>
                    
                    <div class="balance-card commission">
                        <div class="balance-icon">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="balance-details">
                            <h3>Commission Balance</h3>
                            <div class="balance-amount" id="commissionBalance">0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="wallet-actions">
                <div class="action-row">
                    <button class="wallet-action-btn" id="buyCoinsBtn">
                        <div class="action-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <span>Buy Talent Coin</span>
                    </button>
                    
                    <button class="wallet-action-btn" id="withdrawBtn">
                        <div class="action-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <span>Withdraw</span>
                    </button>
                </div>
                
                    
                    <button class="wallet-action-btn" id="transferBtn">
                        <div class="action-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <span>Transfer</span>
                    </button>

                    <button class="wallet-action-btn" id="historyBtn">
                                    <div class="action-icon">
                                      <i class="fas fa-paper-plane"></i>
                                    </div>
                                    <span>Transaction history</span>
                                  </button>
                    <div class="action-row">
                        <button class="wallet-action-btn" id="changePinBtn">
                            <div class="action-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <span>Change PIN</span>
                        </button>
                </div>
            </div>
            
            <div class="transaction-history">
                <h3>Transaction History</h3>
                <div class="transaction-list" id="transactionList">
                    <!-- Transactions will be loaded here -->
                    <div class="empty-transactions">
                        <i class="fas fa-history"></i>
                        <p>No transactions yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Buy Talent Coin Modal -->
<div class="feature-modal" id="buyCoinsModal">
    <div class="feature-modal-content">
        <div class="feature-modal-header">
            <h2>Buy Talent Coin</h2>
            <button class="close-feature-modal">&times;</button>
        </div>
        
        <div class="feature-modal-body">
            <div class="tabs">
                <div class="tab active" data-tab="payment">Payment Details</div>
                <div class="tab" data-tab="confirmation">Confirm Transfer</div>
            </div>
            
            <div class="tab-content active" id="paymentTab">
                <div class="input-group">
                    <label for="coinAmount">Amount of Talent Coins</label>
                    <input type="number" id="coinAmount" placeholder="Enter amount">
                    <div class="input-note">1 Talent Coin = 10</div>
                </div>
                
                <div class="naira-equivalent">
                    <span>You'll pay:</span>
                    <span class="amount"><span id="paymentAmount">0</span></span>
                </div>
                
                <div class="account-details">
                    <h3>Transfer to:</h3>
                    <div class="account-info">
                        <div class="account-row">
                            <span class="label">Account Name:</span>
                            <span class="value">Rewarder Quest</span>
                        </div>
                        <div class="account-row">
                            <span class="label">Account Number (Opay):</span>
                            <span class="value">9078139367</span>
                            <button class="copy-btn" id="copyAccountBtn">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="instructions">
                        <p>1. Transfer the exact amount to the account above</p>
                        <p>2. After payment, click "Next" to confirm your transfer</p>
                        <p>3. Your coins will be credited within 1-30 minutes after verification</p>
                    </div>
                </div>
                
                <button class="wallet-btn primary-btn next-tab-btn">Next</button>
            </div>
            
            <div class="tab-content" id="confirmationTab">
                <div class="input-group">
                    <label for="transferReference">Transfer Reference/ID</label>
                    <input type="text" id="transferReference" placeholder="Enter transfer reference">
                </div>
                
                <div class="input-group">
                    <label for="transferDate">Date of Transfer</label>
                    <input type="date" id="transferDate">
                </div>
                
                <div class="input-group">
                    <label for="transferAmount">Amount Transferred ()</label>
                    <input type="number" id="transferAmount" placeholder="Enter amount">
                </div>
                
                <div class="input-group">
                    <label for="transferScreenshot">Screenshot of Transfer (Optional)</label>
                    <div class="file-upload">
                        <input type="file" id="transferScreenshot" accept="image">
                        <label for="transferScreenshot" class="file-upload-btn">
                            <i class="fas fa-upload"></i> Upload Screenshot
                        </label>
                        <div class="file-name" id="fileName"></div>
                    </div>
                </div>
                
                <button class="wallet-btn primary-btn" id="confirmTransferBtn">Confirm Transfer</button>
                <button class="wallet-btn secondary-btn prev-tab-btn">Back</button>
            </div>
        </div>
    </div>
</div>

<!-- Withdraw Modal -->
<div class="feature-modal" id="withdrawModal">
    <div class="feature-modal-content">
        <div class="feature-modal-header">
            <h2>Withdraw Funds</h2>
            <button class="close-feature-modal">&times;</button>
        </div>
        
        <div class="feature-modal-body">
            <div class="pin-verification" id="withdrawPinVerification">
                <h3>Enter your PIN to continue</h3>
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="withdraw-pin-digit" data-index="0">
                    <input type="password" maxlength="1" class="withdraw-pin-digit" data-index="1">
                    <input type="password" maxlength="1" class="withdraw-pin-digit" data-index="2">
                    <input type="password" maxlength="1" class="withdraw-pin-digit" data-index="3">
                </div>
                <button class="wallet-btn primary-btn" id="verifyWithdrawPinBtn">Verify</button>
            </div>
            
            <div class="withdraw-form hidden" id="withdrawForm">
                <div class="input-group">
                    <label for="withdrawAmount">Amount (Talent Coins)</label>
                    <input type="number" id="withdrawAmount" placeholder="Enter amount">
                    <div class="input-note">1 Talent Coin = 10</div>
                </div>
                
                <div class="naira-equivalent">
                    <span>You'll receive:</span>
                    <span class="amount"><span id="withdrawNairaAmount">0</span></span>
                </div>
                
                <div class="input-group">
                    <label for="bankName">Bank Name</label>
                    <select id="bankName">
                        <option value="">Select Bank</option>
                        <option value="access">Access Bank</option>
                        <option value="gtb">Guaranty Trust Bank</option>
                        <option value="firstbank">First Bank</option>
                        <option value="uba">UBA</option>
                        <option value="zenith">Zenith Bank</option>
                        <option value="opay">OPay</option>
                        <option value="palmpay">PalmPay</option>
                        <option value="kuda">Kuda Bank</option>
                        <!-- Add more banks as needed -->
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="accountNumber">Account Number</label>
                    <input type="text" id="accountNumber" placeholder="Enter account number" maxlength="10">
                </div>
                
                <div class="input-group">
                    <label for="accountName">Account Name</label>
                    <input type="text" id="accountName" placeholder="Enter account name">
                </div>
                
                <div class="instructions">
                    <p>Note: Withdrawal will be processed within 1-30 minutes after confirmation.</p>
                </div>
                
                <button class="wallet-btn primary-btn" id="confirmWithdrawBtn">Withdraw Funds</button>
            </div>
        </div>
    </div>
</div>
<!-- History Modal -->
<div class="feature-modal" id="historyModal">
    <div class="feature-modal-content">
        <div class="feature-modal-header">
            <h2>History</h2>
            <button class="close-feature-modal" id="closeHistoryModal">&times;</button>
        </div>
        
        <div class="feature-modal-body">
            <div class="tabs">
                <div class="tab active" data-tab="inbox">
                    <i class="fas fa-inbox"></i> Inbox
                    <span class="notification-badge" id="unreadCount">0</span>
                </div>
                <div class="tab" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i> Transactions
                </div>
            </div>
            
            <!-- Inbox Tab -->
            <div class="tab-content active" id="inboxTab">
                <div class="inbox-container" id="inboxContainer">
                    <div class="loading-spinner"></div>
                </div>
                <div class="empty-state" id="emptyInbox">
                    <i class="fas fa-inbox fa-3x"></i>
                    <p>Your inbox is empty</p>
                </div>
            </div>
            
            <!-- Transactions Tab -->
            <div class="tab-content" id="transactionsTab">
                <div class="filter-controls">
                    <select id="transactionTypeFilter">
                        <option value="all">All Transactions</option>
                        <option value="buy">Buy Coins</option>
                        <option value="send">Send Coins</option>
                        <option value="receive">Receive Coins</option>
                        <option value="reward">Rewards</option>
                    </select>
                    <div class="date-filter">
                        <input type="date" id="startDate" placeholder="Start Date">
                        <input type="date" id="endDate" placeholder="End Date">
                        <button id="applyDateFilter" class="filter-btn">Apply</button>
                    </div>
                </div>
                
                <div class="transactions-container" id="transactionsContainer">
                    <div class="loading-spinner"></div>
                </div>
                
                <div class="empty-state" id="emptyTransactions">
                    <i class="fas fa-exchange-alt fa-3x"></i>
                    <p>No transactions found</p>
                </div>
                
                <div class="pagination-controls" id="transactionPagination">
                    <button id="prevPage" class="pagination-btn"><i class="fas fa-chevron-left"></i></button>
                    <span id="pageIndicator">Page 1 of 1</span>
                    <button id="nextPage" class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- Change PIN Modal -->
<div class="feature-modal" id="changePinModal">
    <div class="feature-modal-content">
        <div class="feature-modal-header">
            <h2>Change PIN</h2>
            <button class="close-feature-modal">&times;</button>
        </div>
        
        <div class="feature-modal-body">
            <div class="verification-options">
                <h3>Verify your identity</h3>
                <div class="option-buttons">
                    <button class="option-btn active" data-option="pin">
                        <i class="fas fa-key"></i>
                        <span>Use Current PIN</span>
                    </button>
                    <button class="option-btn" data-option="otp">
                        <i class="fas fa-envelope"></i>
                        <span>Use OTP</span>
                    </button>
                </div>
            </div>
            
            <div class="verification-section" id="pinVerificationSection">
                <div class="input-group">
                    <label>Enter Current PIN</label>
                    <div class="pin-input-container">
                        <input type="password" maxlength="1" class="current
                        -pin-digit" data-index="0">
                        <input type="password" maxlength="1" class="current-pin-digit" data-index="1">
                        <input type="password" maxlength="1" class="current-pin-digit" data-index="2">
                        <input type="password" maxlength="1" class="current-pin-digit" data-index="3">
                    </div>
                </div>
                <button class="wallet-btn primary-btn" id="verifyCurrentPinBtn">Verify</button>
            </div>
            
            <div class="verification-section hidden" id="otpVerificationSection">
                <div class="input-group">
                    <label for="emailForOtp">Email Address</label>
                    <input type="email" id="emailForOtp" placeholder="Enter your registered email" disabled>
                </div>
                <button class="wallet-btn primary-btn" id="sendOtpBtn">Send OTP</button>
                
                <div class="otp-input-section hidden" id="otpInputSection">
                    <div class="input-group">
                        <label>Enter OTP sent to your email</label>
                        <div class="otp-input-container">
                            <input type="text" maxlength="1" class="otp-digit" data-index="0">
                            <input type="text" maxlength="1" class="otp-digit" data-index="1">
                            <input type="text" maxlength="1" class="otp-digit" data-index="2">
                            <input type="text" maxlength="1" class="otp-digit" data-index="3">
                            <input type="text" maxlength="1" class="otp-digit" data-index="4">
                            <input type="text" maxlength="1" class="otp-digit" data-index="5">
                        </div>
                    </div>
                    <div class="resend-otp">
                        <span id="otpTimer">Resend in 60s</span>
                        <button class="text-btn hidden" id="resendOtpBtn">Resend OTP</button>
                    </div>
                    <button class="wallet-btn primary-btn" id="verifyOtpBtn">Verify OTP</button>
                </div>
            </div>
            
            <div class="new-pin-section hidden" id="newPinSection">
                <h3>Set New PIN</h3>
                <div class="input-group">
                    <label>Enter New PIN</label>
                    <div class="pin-input-container">
                        <input type="password" maxlength="1" class="new-pin-digit" data-index="0">
                        <input type="password" maxlength="1" class="new-pin-digit" data-index="1">
                        <input type="password" maxlength="1" class="new-pin-digit" data-index="2">
                        <input type="password" maxlength="1" class="new-pin-digit" data-index="3">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Confirm New PIN</label>
                    <div class="pin-input-container">
                        <input type="password" maxlength="1" class="confirm-new-pin-digit" data-index="0">
                        <input type="password" maxlength="1" class="confirm-new-pin-digit" data-index="1">
                        <input type="password" maxlength="1" class="confirm-new-pin-digit" data-index="2">
                        <input type="password" maxlength="1" class="confirm-new-pin-digit" data-index="3">
                    </div>
                </div>
                
                <button class="wallet-btn primary-btn" id="updatePinBtn">Update PIN</button>
            </div>
        </div>
    </div>
</div>

<!-- Transfer Modal -->
<div class="feature-modal" id="transferModal">
    <div class="feature-modal-content">
        <div class="feature-modal-header">
            <h2>Transfer Talent Coins</h2>
            <button class="close-feature-modal">&times;</button>
        </div>
        
        <div class="feature-modal-body">
            <div class="input-group">
                <label for="recipientWalletId">Recipient's Wallet ID</label>
                <input type="text" id="recipientWalletId" placeholder="Enter wallet ID">
            </div>
            
            <div class="input-group">
                <label for="transferCoinAmount">Amount (Talent Coins)</label>
                <input type="number" id="transferCoinAmount" placeholder="Enter amount">
            </div>
            
            <div class="fee-calculation">
                <div class="fee-row">
                    <span>Transfer Amount:</span>
                    <span><span id="transferAmount">0</span> Talent Coins</span>
                </div>
                <div class="fee-row">
                    <span>Transfer Fee:</span>
                    <span><span id="transferFee">0</span> Talent Coins</span>
                </div>
                <div class="fee-divider"></div>
                <div class="fee-row total">
                    <span>Total:</span>
                    <span><span id="transferTotal">0</span> Talent Coins</span>
                </div>
            </div>
            
            <div class="fee-note">
                <i class="fas fa-info-circle"></i>
                <span>Transfer fee: 1 Talent Coin for every 15 Talent Coins sent</span>
            </div>
            
            <div class="pin-verification" id="transferPinVerification">
                <h3>Enter your PIN to confirm transfer</h3>
                <div class="pin-input-container">
                    <input type="password" maxlength="1" class="transfer-pin-digit" data-index="0">
                    <input type="password" maxlength="1" class="transfer-pin-digit" data-index="1">
                    <input type="password" maxlength="1" class="transfer-pin-digit" data-index="2">
                    <input type="password" maxlength="1" class="transfer-pin-digit" data-index="3">
                </div>
            </div>
            
            <button class="wallet-btn primary-btn" id="confirmTransferCoinsBtn">Confirm Transfer</button>
        </div>
    </div>
</div>

<!-- Transaction Item Template (for JavaScript use) -->
<template id="transactionTemplate">
    <div class="transaction-item">
        <div class="transaction-icon">
            <i class="fas fa-exchange-alt"></i>
        </div>
        <div class="transaction-details">
            <div class="transaction-title">Transaction Title</div>
            <div class="transaction-date">Date</div>
        </div>
        <div class="transaction-amount">
            <span class="amount-value">0</span>
            <span class="amount-status">pending</span>
        </div>
    </div>
</template>

<!-- Overlay for modals -->
<div class="modal-overlay" id="modalOverlay"></div>
  


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
   // Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAGJ6EoBub9uL-R7q8N-_r85-VhuSiSlFo",
  authDomain: "billsandmal.firebaseapp.com",
  projectId: "billsandmal",
  storageBucket: "billsandmal.firebasestorage.app",
  messagingSenderId: "663259820123",
  appId: "1:663259820123:web:078be226314c5a74444f7e",
  measurementId: "G-DSJ2FS4VRV"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const analytics = firebase.analytics();


// Constants
const ADMIN_EMAIL = 'admin@talentcoin.com';
const ADMIN_PASSWORD = 'BISA19';


// DOM Elements
const splitScreen = document.querySelector('.split-screen');
const loginForm = document.getElementById('loginForm');
const signupForm = document.getElementById('signupForm');
const googleBtns = document.querySelectorAll('.google-btn');
const dashboardPage = document.getElementById('dashboardPage');
const passwordFields = document.querySelectorAll('.password-field');

// Initialize UI
document.addEventListener('DOMContentLoaded', function() {
  // Setup password visibility toggle
  setupPasswordToggle();
  
  // Setup password strength meter
  setupPasswordStrength();
  
  // Setup form switching
  setupFormSwitching();
});

// Setup form switching
function setupFormSwitching() {
  const loginLink = document.querySelector('.login-link');
  const signupLink = document.querySelector('.signup-link');
  const loginPanel = document.querySelector('.login');
  const signupPanel = document.querySelector('.signup');
  
  if (loginLink && signupLink && loginPanel && signupPanel) {
    loginLink.addEventListener('click', function(e) {
      e.preventDefault();
      loginPanel.classList.add('active');
      signupPanel.classList.remove('active');
    });
    
    signupLink.addEventListener('click', function(e) {
      e.preventDefault();
      signupPanel.classList.add('active');
      loginPanel.classList.remove('active');
    });
  }
}

// Show toast notification
function showToast(message, type = 'success') {
  const toast = document.getElementById('toast') || createToastElement();
  
  // Set toast type
  toast.className = 'toast';
  toast.classList.add(type);
  
  // Set message
  toast.querySelector('.toast-message').textContent = message;
  
  // Set icon
  const iconElement = toast.querySelector('.toast-icon i');
  if (iconElement) {
    iconElement.className = type === 'success' 
      ? 'fas fa-check-circle' 
      : 'fas fa-exclamation-circle';
  }
  
  // Show toast
  toast.classList.add('show');
  
  // Hide after 3 seconds
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Create toast element if it doesn't exist
function createToastElement() {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <div class="toast-message"></div>
  `;
  document.body.appendChild(toast);
  return toast;
}

// Setup password visibility toggle
function setupPasswordToggle() {
  passwordFields.forEach(field => {
    const toggleBtn = field.querySelector('.password-toggle');
    const input = field.querySelector('input');
    
    if (toggleBtn && input) {
      toggleBtn.addEventListener('click', function() {
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
        
        // Toggle icon
        const icon = toggleBtn.querySelector('i');
        if (icon) {
          icon.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        }
      });
    }
  });
}

// Setup password strength meter
function setupPasswordStrength() {
  const passwordInput = document.getElementById('signupPassword');
  const strengthMeter = document.querySelector('.password-strength-meter');
  
  if (passwordInput && strengthMeter) {
    const strengthSegments = strengthMeter.querySelectorAll('.strength-segment');
    const strengthText = strengthMeter.querySelector('.strength-text');
    
    passwordInput.addEventListener('input', function() {
      updatePasswordStrength(this.value, strengthSegments, strengthText);
    });
    
    // Clear strength meter when input is empty
    passwordInput.addEventListener('blur', function() {
      if (!this.value) {
        strengthSegments.forEach(segment => {
          segment.className = 'strength-segment';
        });
        strengthText.textContent = '';
      }
    });
  }
}

// Update password strength meter
function updatePasswordStrength(password, strengthSegments, strengthText) {
  // Reset strength segments
  strengthSegments.forEach(segment => {
    segment.className = 'strength-segment';
  });
  
  if (password) {
    const hasLower = /[a-z]/.test(password);
    const hasUpper = /[A-Z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecial = /[^A-Za-z0-9]/.test(password);
    const length = password.length;
    
    let strength = 0;
    if (length >= 8) strength++;
    if (hasLower && hasUpper) strength++;
    if (hasNumber) strength++;
    if (hasSpecial) strength++;
    
    // Update UI based on strength
    for (let i = 0; i < strength; i++) {
      if (strengthSegments[i]) {
        if (strength === 1) {
          strengthSegments[i].classList.add('weak');
        } else if (strength === 2) {
          strengthSegments[i].classList.add('medium');
        } else {
          strengthSegments[i].classList.add('strong');
        }
      }
    }
    
    // Update text
    if (strength === 0) strengthText.textContent = 'Very weak';
    else if (strength === 1) strengthText.textContent = 'Weak';
    else if (strength === 2) strengthText.textContent = 'Medium';
    else if (strength === 3) strengthText.textContent = 'Strong';
    else strengthText.textContent = 'Very strong';
  }
}

// Show loading state on button
function setButtonLoading(button, isLoading) {
  if (isLoading) {
    button.classList.add('loading');
    const originalText = button.textContent;
    button.setAttribute('data-original-text', originalText);
    button.innerHTML = 'Processing... <span class="loading-spinner"></span>';
    button.disabled = true;
  } else {
    button.classList.remove('loading');
    const originalText = button.getAttribute('data-original-text');
    button.textContent = originalText;
    button.disabled = false;
  }
}

// Check if user is admin
function isAdmin(email) {
  return email === ADMIN_EMAIL;
}

// Navigate to dashboard
function navigateToDashboard(user, isAdminUser = false) {
  // Store admin status in localStorage for persistence
  if (isAdminUser) {
    localStorage.setItem('isAdmin', 'true');
  } else {
    localStorage.removeItem('isAdmin');
  }

  // Hide authentication container
  if (splitScreen) {
    splitScreen.style.display = 'none';
  }
  
  // If admin, show admin dashboard instead of regular dashboard
  if (isAdminUser) {
    console.log('Showing admin dashboard for:', user.email);
    
    // Hide regular dashboard if it exists
    if (dashboardPage) {
      dashboardPage.classList.remove('active');
    }
    
    // Show admin dashboard
    const adminDashboard = document.getElementById('dashboard');
    if (adminDashboard) {
      adminDashboard.classList.remove('hidden');
      
      // Set moderator name if available
      const moderatorName = document.querySelector('.moderator-name');
      if (moderatorName) {
        moderatorName.textContent = user.displayName || 'Administrator';
      }
      
      // Initialize admin dashboard functionality
      initializeAdminDashboard();
      
      showToast('Admin mode activated', 'success');
    } else {
      console.error('Admin dashboard element not found');
      showToast('Error loading admin dashboard', 'error');
    }
  } else {
    // Show regular dashboard
    if (dashboardPage) {
      dashboardPage.classList.add('active');
      
      // Set username
      const displayName = user.displayName || user.email.split('@')[0];
      const usernameDisplay = document.getElementById('usernameDisplay');
      if (usernameDisplay) {
        usernameDisplay.textContent = displayName;
      }
      
      // Set profile image if available
      const userProfileImage = document.getElementById('userProfileImage');
      if (userProfileImage && user.photoURL) {
        userProfileImage.src = user.photoURL;
      }
    }
  }
  
  // Prevent body scrolling
  document.body.style.overflow = 'hidden';
  
  // Log analytics event
  if (typeof analytics !== 'undefined') {
    analytics.logEvent('login', {
      method: user.providerData[0].providerId,
      isAdmin: isAdminUser
    });
  }
}

// Initialize admin dashboard
function initializeAdminDashboard() {
  console.log('Initializing admin dashboard');
  
  // Set up logout button
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', logout);
  }
  
  // Set up action card buttons
  const buyCoinSupportBtn = document.getElementById('buyCoinSupportBtn');
  const withdrawSupportBtn = document.getElementById('withdrawSupportBtn');
  const transferSupportBtn = document.getElementById('transferSupportBtn');
  const talentCoinDispenserBtn = document.getElementById('talentCoinDispenserBtn');
  
  // Dashboard sections
  const dashboard = document.getElementById('dashboard');
  const buyCoinSupport = document.getElementById('buyCoinSupport');
  const withdrawSupport = document.getElementById('withdrawSupport');
  const transferSupport = document.getElementById('transferSupport');
  const talentCoinDispenser = document.getElementById('talentCoinDispenser');
  
  // Function to show a specific section and hide others
  function showSection(sectionToShow) {
    // Hide all sections
    [buyCoinSupport, withdrawSupport, transferSupport, talentCoinDispenser].forEach(section => {
      if (section) section.classList.add('hidden');
    });
    
    // Show the selected section
    if (sectionToShow) {
      sectionToShow.classList.remove('hidden');
    }
  }
  
  // Set up action card click handlers
  if (buyCoinSupportBtn) {
    buyCoinSupportBtn.addEventListener('click', () => showSection(buyCoinSupport));
  }
  
  if (withdrawSupportBtn) {
    withdrawSupportBtn.addEventListener('click', () => showSection(withdrawSupport));
  }
  
  if (transferSupportBtn) {
    transferSupportBtn.addEventListener('click', () => showSection(transferSupport));
  }
  
  if (talentCoinDispenserBtn) {
    talentCoinDispenserBtn.addEventListener('click', () => showSection(talentCoinDispenser));
  }
  
  // Set up back buttons
  const backButtons = document.querySelectorAll('.back-btn');
  backButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.getAttribute('data-target');
      if (target === 'dashboard') {
        showSection(null); // Hide all feature sections
      }
    });
  });
  
  // Load initial data for the dashboard
  loadDashboardData();
}

// Load dashboard data
function loadDashboardData() {
  // This would normally fetch data from Firestore
  // For now, we'll just set some placeholder values
  
  // Set badge counts
  const buyRequestsBadge = document.getElementById('buyRequestsBadge');
  const withdrawRequestsBadge = document.getElementById('withdrawRequestsBadge');
  const transferIssuesBadge = document.getElementById('transferIssuesBadge');
  
  if (buyRequestsBadge) buyRequestsBadge.textContent = '5';
  if (withdrawRequestsBadge) withdrawRequestsBadge.textContent = '3';
  if (transferIssuesBadge) transferIssuesBadge.textContent = '2';
  
  // Set today's activity summary
  const todayBuyRequests = document.getElementById('todayBuyRequests');
  const todayWithdrawals = document.getElementById('todayWithdrawals');
  const todayTransfers = document.getElementById('todayTransfers');
  const todayIssues = document.getElementById('todayIssues');
  
  if (todayBuyRequests) todayBuyRequests.textContent = '8';
  if (todayWithdrawals) todayWithdrawals.textContent = '6';
  if (todayTransfers) todayTransfers.textContent = '15';
  if (todayIssues) todayIssues.textContent = '2';
  
  // Load recent activity (placeholder)
  const recentActivityList = document.getElementById('recentActivityList');
  if (recentActivityList) {
    // Clear empty state if it exists
    const emptyState = recentActivityList.querySelector('.empty-state');
    if (emptyState) {
      emptyState.remove();
    }
    
    // Add some sample activity items
    const activityTemplate = document.getElementById('activityItemTemplate');
    if (activityTemplate) {
      const activities = [
        { title: 'New buy request from user123', time: '5 minutes ago', icon: 'fa-coins' },
        { title: 'Withdrawal approved for user456', time: '15 minutes ago', icon: 'fa-money-bill-wave' },
        { title: 'Transfer issue reported by user789', time: '30 minutes ago', icon: 'fa-exclamation-circle' },
        { title: 'New user registered', time: '1 hour ago', icon: 'fa-user-plus' }
      ];
      
      activities.forEach(activity => {
        const activityItem = activityTemplate.content.cloneNode(true);
        const activityIcon = activityItem.querySelector('.activity-icon i');
        const activityTitle = activityItem.querySelector('.activity-title');
        const activityTime = activityItem.querySelector('.activity-time');
        
        if (activityIcon) activityIcon.className = `fas ${activity.icon}`;
        if (activityTitle) activityTitle.textContent = activity.title;
        if (activityTime) activityTime.textContent = activity.time;
        
        recentActivityList.appendChild(activityItem);
      });
    }
  }
}

// Google Sign In
googleBtns.forEach(btn => {
  btn.addEventListener('click', function() {
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.addScope('profile');
    provider.addScope('email');
    
    auth.signInWithPopup(provider)
      .then((result) => {
        // Save user data to Firestore
        const user = result.user;
        saveUserData(user);
        
        // Show success message
        showToast('Successfully signed in with Google!');
        
        // Check if admin
        const isAdminUser = isAdmin(user.email);
        
        // Navigate to dashboard
        navigateToDashboard(user, isAdminUser);
      })
      .catch((error) => {
        console.error('Google sign in error:', error);
        showToast(error.message, 'error');
      });
  });
});

// Email/Password Sign In
if (loginForm) {
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const rememberMe = document.getElementById('remember') ? document.getElementById('remember').checked : false;
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    // Check for admin login
    const isAdminLogin = email === ADMIN_EMAIL && password === ADMIN_PASSWORD;
    
    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Update last login timestamp
        db.collection('users').doc(user.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(err => console.log('Error updating user data:', err));
        
        // Set persistence based on remember me
        const persistence = rememberMe ? 
          firebase.auth.Auth.Persistence.LOCAL : 
          firebase.auth.Auth.Persistence.SESSION;
        
        return auth.setPersistence(persistence)
          .then(() => {
            showToast('Successfully signed in!');
            navigateToDashboard(user, isAdminLogin);
            return user;
          });
      })
      .catch((error) => {
        console.error('Sign in error:', error);
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Email/Password Sign Up
if (signupForm) {
  signupForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const termsAccepted = document.getElementById('termsCheckbox').checked;
    
    // Validate form
    if (password !== confirmPassword) {
      showToast('Passwords do not match', 'error');
      return;
    }
    
    if (!termsAccepted) {
      showToast('Please accept the terms and conditions', 'error');
      return;
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Save user data to Firestore
        saveUserData(user);
        
        // Send email verification
        return user.sendEmailVerification()
          .then(() => {
            showToast('Account created! Please verify your email.');
            navigateToDashboard(user);
            return user;
          });
      })
      .catch((error) => {
        console.error('Sign up error:', error);
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Save user data to Firestore
function saveUserData(user) {
  const userData = {
    uid: user.uid,
    email: user.email,
    displayName: user.displayName || user.email.split('@')[0],
    photoURL: user.photoURL || null,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
    isAdmin: isAdmin(user.email)
  };
  
  // Create wallet data
  const walletData = {
    uid: user.uid,
    balance: 0,
    commissionBalance: 0,
    walletId: generateWalletId(),
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    transactions: []
  };
  
  // Save user data
  db.collection('users').doc(user.uid).set(userData, { merge: true })
    .then(() => {
      console.log('User data saved successfully');
      
      // Save wallet data
      return db.collection('wallets').doc(user.uid).set(walletData, { merge: true });
    })
    .then(() => {
      console.log('Wallet data saved successfully');
    })
    .catch(error => {
      console.error('Error saving user data:', error);
    });
}

// Generate wallet ID
function generateWalletId() {
  const prefix = 'WL';
  const randomDigits = Math.floor(100000 + Math.random() * 900000); // 6 digits
  return `${prefix}${randomDigits}`;
}

// Logout function
function logout() {
  auth.signOut()
    .then(() => {
      // Clear admin status
      localStorage.removeItem('isAdmin');
      
      // Hide dashboards
      if (dashboardPage) {
        dashboardPage.classList.remove('active');
      }
      
      const adminDashboard = document.getElementById('dashboard');
      if (adminDashboard) {
        adminDashboard.classList.add('hidden');
      }
      
      // Hide all feature sections
      const featureSections = document.querySelectorAll('.feature-section');
      featureSections.forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show login screen
      if (splitScreen) {
        splitScreen.style.display = 'flex';
      }
      
      // Allow body scrolling
      document.body.style.overflow = 'auto';
      
      showToast('Successfully logged out');
    })
    .catch((error) => {
      console.error('Logout error:', error);
      showToast('Error logging out: ' + error.message, 'error');
    });
}

// Auth state change handler
auth.onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in
    console.log('User is signed in:', user.email);
    
    // Check if admin from localStorage or email
    const isAdminUser = localStorage.getItem('isAdmin') === 'true' || isAdmin(user.email);
    
    // If we're on the login page, navigate to appropriate dashboard
    if (splitScreen && splitScreen.style.display !== 'none') {
      navigateToDashboard(user, isAdminUser);
    }
  } else {
    // User is signed out
    console.log('User is signed out');
    
    // Show login screen
    if (splitScreen) {
      splitScreen.style.display = 'flex';
    }
    
    // Hide dashboards
    if (dashboardPage) {
      dashboardPage.classList.remove('active');
    }
    
    const adminDashboard = document.getElementById('dashboard');
    if (adminDashboard) {
      adminDashboard.classList.add('hidden');
    }
    
    // Allow body scrolling
    document.body.style.overflow = 'auto';
  }
});

// Password reset functionality
const forgotPasswordLink = document.querySelector('.forgot-password');
if (forgotPasswordLink) {
  forgotPasswordLink.addEventListener('click', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    if (!email) {
      showToast('Please enter your email address first', 'error');
      return;
    }
    
    auth.sendPasswordResetEmail(email)
      .then(() => {
        showToast('Password reset email sent. Check your inbox.');
      })
      .catch((error) => {
        console.error('Password reset error:', error);
        showToast(error.message, 'error');
      });
  });
}

// Initialize logout buttons
const logoutBtns = document.querySelectorAll('.logout-btn');
logoutBtns.forEach(btn => {
  btn.addEventListener('click', logout);
});




// Logout functionality
function logout() {
  auth.signOut()
    .then(() => {
      // Show login screen again
      splitScreen.style.display = 'flex';
      dashboardPage.classList.remove('active');
      
      // Reset body overflow
      document.body.style.overflow = 'auto';
      
      // Show success message
      showToast('Successfully logged out!');
    })
    .catch((error) => {
      console.error('Logout error:', error);
      showToast(error.message, 'error');
    });
}

// Add logout function to window object so it can be called from HTML
window.logout = logout;











// Add additional CSS for dashboard
const dashboardStyles = document.createElement('style');
dashboardStyles.textContent = `
  /* Dashboard Styles */
  .dashboard-page {
    display: none;
    flex-direction: column;
    height: 100vh;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #f8f9fa;
    z-index: 1000;
  }

  .dashboard-page.active {
    display: flex;
  }

  /* Top Navigation Bar */
  .dashboard-nav {
    background-color: white;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: relative;
    width: 100%;
    z-index: 100;
    flex-shrink: 0;
    height: 56px;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .profile-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #6c5ce7;
    flex-shrink: 0;
  }

  .profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .username {
    font-weight: 600;
    font-size: 0.95rem;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100px;
  }

  .trophy-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: #6c5ce7;
    color: white;
    padding: 6px 15px;
    border-radius: 50px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(108, 92, 231, 0.2);
    font-size: 0.9rem;
    white-space: nowrap;
  }

  .trophy-btn:hover {
    background-color: #5b4bc4;
  }

  .trophy-btn i {
    font-size: 0.9rem;
  }

  .hamburger-menu {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  .hamburger-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  .hamburger-menu i {
    font-size: 1.2rem;
    color: #333;
  }

  /* Main Dashboard Container */
  .dashboard-container {
    flex: 1;
    padding: 15px;
    width: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Action Buttons - Single Row */
  .action-buttons-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: 5px;
    flex-shrink: 0;
  }

  .action-buttons-row::-webkit-scrollbar {
    display: none;
  }

  .action-btn {
    background-color: white;
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
  }

  .action-btn:active {
    transform: scale(0.95);
  }

  .action-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
  }

  /* Spinning animation for spin icon */
  .spin-icon {
    position: relative;
    overflow: hidden;
  }

  .spin-icon i {
    animation: spin 5s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .spin-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    border: 2px dashed #2ecc71;
    animation: spin-reverse 10s linear infinite;
  }

  @keyframes spin-reverse {
    0% { transform: rotate(360deg); }
    100% { transform: rotate(0deg); }
  }

  .wallet-btn .action-icon {
    background-color: rgba(108, 92, 231, 0.1);
    color: #6c5ce7;
  }

  .creator-btn .action-icon {
    background-color: rgba(253, 121, 168, 0.1);
    color: #fd79a8;
  }

  .spin-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
  }

  .notification-btn .action-icon {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
  }

  .action-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: #333;
    text-align: center;
    white-space: nowrap;
  }
`;
document.head.appendChild(dashboardStyles);

// Initialize the app
console.log('Firebase Auth initialized');


// Profile functionality
document.addEventListener('DOMContentLoaded', function() {
    // Check if Firebase is initialized
    if (typeof firebase === 'undefined') {
        console.error('Firebase SDK is not loaded. Profile functionality will not work.');
        return;
    }

    // Ensure we have the storage SDK
    if (!firebase.storage) {
        // Load Firebase Storage SDK if not already loaded
        const storageScript = document.createElement('script');
        storageScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js';
        storageScript.onload = function() {
            console.log('Firebase Storage SDK loaded');
            initProfileModal();
        };
        document.head.appendChild(storageScript);
    } else {
        initProfileModal();
    }
});

function initProfileModal() {
    // Create and append the profile modal HTML to the body
    const profileModalHTML = `
    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2>My Profile</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="profile-modal-body">
                <div class="profile-image-container">
                    <div class="profile-image-wrapper">
                        <img src="https://via.placeholder.com/150" alt="Profile" id="profileModalImage">
                        <div class="profile-image-overlay">
                            <i class="fas fa-camera"></i>
                            <span>Change</span>
                        </div>
                    </div>
                    <input type="file" id="profileImageUpload" accept="image/*" hidden>
                </div>
                
                <form id="profileForm">
                    <div class="form-group">
                        <label for="profileFullName">Full Name</label>
                        <input type="text" id="profileFullName" placeholder="Your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileUserType">Account Type</label>
                        <select id="profileUserType">
                            <option value="contestant">Contestant</option>
                            <option value="voter">Voter</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileBio">Bio</label>
                        <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                        <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                    </div>
                </form>
                
                <!-- Change Password Section (Hidden by default) -->
                <div id="changePasswordSection" class="change-password-section hidden">
                    <h3>Change Password</h3>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <div class="password-input">
                                <input type="password" id="currentPassword" placeholder="Enter current password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <div class="password-input">
                                <input type="password" id="newPassword" placeholder="Enter new password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                            <div class="password-strength">
                                <div class="strength-meter">
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                </div>
                                <span class="strength-text">Password strength</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <div class="password-input">
                                <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                            <button type="submit" class="primary-btn">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    `;

    // Add the profile modal CSS
    const profileStyles = document.createElement('style');
    profileStyles.textContent = `
    /* Profile Modal Styles */
    .profile-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    .profile-modal.active {
        display: block;
    }

    .profile-modal-content {
        background-color: white;
        margin: 20px auto;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        animation: slideUp 0.4s ease;
    }

    .profile-modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .profile-modal-header h2 {
        margin: 0;
        font-size: 1.3rem;
        color: #333;
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #777;
        transition: color 0.3s ease;
    }

    .close-modal:hover {
        color: #333;
    }

    .profile-modal-body {
        padding: 20px;
    }

    .profile-image-container {
        display: flex;
        justify-content: center;
        margin-bottom: 25px;
    }

    .profile-image-wrapper {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border: 3px solid #6c5ce7;
    }

    .profile-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-image-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 8px 0;
        text-align: center;
        font-size: 0.8rem;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .profile-image-wrapper:hover .profile-image-overlay {
        transform: translateY(0);
    }

    .profile-image-overlay i {
        font-size: 1rem;
        margin-bottom: 2px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-size: 0.9rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        border-color: #6c5ce7;
        outline: none;
    }

    .form-group input[readonly] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }

    .profile-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    .primary-btn,
    .secondary-btn {
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 0.95rem;
    }

    .primary-btn {
        background-color: #6c5ce7;
        color: white;
    }

    .primary-btn:hover {
        background-color: #5b4bc4;
    }

    .secondary-btn {
        background-color: #f1f3f5;
        color: #333;
    }

    .secondary-btn:hover {
        background-color: #e9ecef;
    }

    /* Change Password Section */
    .change-password-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }

    .change-password-section h3 {
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.1rem;
        color: #333;
    }

    .hidden {
        display: none;
    }

    .password-input {
        position: relative;
    }

    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #777;
    }

    /* Password Strength Meter */
    .password-strength {
        margin-top: 8px;
    }

    .strength-meter {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }

    .strength-segment {
        height: 4px;
        flex: 1;
        background-color: #ddd;
        border-radius: 2px;
        transition: background-color 0.3s ease;
    }

    .strength-segment.weak {
        background-color: #e74c3c;
    }

    .strength-segment.medium {
        background-color: #f39c12;
    }

    .strength-segment.strong {
        background-color: #2ecc71;
    }

    .strength-text {
        font-size: 0.8rem;
        color: #777;
    }

    /* Loading Spinner */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
        margin-left: 8px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    /* Button Loading State */
    .primary-btn.loading,
    .secondary-btn.loading {
        position: relative;
        color: transparent !important;
        pointer-events: none;
    }

    .primary-btn.loading .loading-spinner,
    .secondary-btn.loading .loading-spinner {
        position: absolute;
        top: calc(50% - 10px);
        left: calc(50% - 10px);
    }

    .secondary-btn.loading .loading-spinner {
        border-top-color: #333;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
        .profile-modal-content {
            width: 95%;
            margin: 10px auto;
        }
        
        .profile-actions {
            flex-direction: column;
            gap: 10px;
        }
        
        .primary-btn,
        .secondary-btn {
            width: 100%;
        }
    }
    `;








    // Append the CSS and HTML to the document
    document.head.appendChild(profileStyles);
    document.body.insertAdjacentHTML('beforeend', profileModalHTML);

    // Initialize the profile functionality
    initializeProfileFunctionality();
}

function initializeProfileFunctionality() {
    // Get Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // DOM Elements
    const profileCircle = document.querySelector('.profile-circle');
    const profileModal = document.getElementById('profileModal');
    const closeModalBtn = document.querySelector('.close-modal');
    const profileForm = document.getElementById('profileForm');
    const profileImageWrapper = document.querySelector('.profile-image-wrapper');
    const profileImageUpload = document.getElementById('profileImageUpload');
    const profileModalImage = document.getElementById('profileModalImage');
    const userProfileImage = document.getElementById('userProfileImage');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordSection = document.getElementById('changePasswordSection');
    const cancelPasswordChange = document.getElementById('cancelPasswordChange');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const togglePasswordBtns = document.querySelectorAll('.toggle-password');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthSegments = document.querySelectorAll('.strength-meter .strength-segment');
    const strengthText = document.querySelector('.strength-text');

    // Check if elements exist
    if (!profileCircle || !profileModal) {
        console.error('Required DOM elements not found');
        return;
    }

    // Open profile modal when clicking on profile circle
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    
    // Don't reset the image when opening the modal
    // Just load the user data from Firestore
    loadUserProfileData();
});

    // Close modal when clicking the close button
    closeModalBtn.addEventListener('click', function() {
        profileModal.classList.remove('active');
    });

    // Close modal when clicking outside the modal content
    profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            profileModal.classList.remove('active');
        }
    });

    // Trigger file upload when clicking on profile image
    profileImageWrapper.addEventListener('click', function() {
        profileImageUpload.click();
    });


// Function to initialize the emoji avatar selector
function initEmojiAvatarSelector() {
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    const emojiSelector = document.getElementById('emojiSelector');
    const emojiOptions = document.querySelectorAll('.emoji-option');
    
    if (!currentEmojiAvatar || !emojiSelector) return;
    
    // Add click handler to show/hide emoji selector
    currentEmojiAvatar.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiSelector.classList.toggle('active');
    });
    
    // Close emoji selector when clicking outside
    document.addEventListener('click', () => {
        emojiSelector.classList.remove('active');
    });
    
    // Prevent closing when clicking inside the selector
    emojiSelector.addEventListener('click', (e) => {
        e.stopPropagation();
    });
    
    // Add click handlers for each emoji option
    emojiOptions.forEach(option => {
        option.addEventListener('click', () => {
            const emoji = option.getAttribute('data-emoji');
            selectEmojiAvatar(emoji);
        });
    });
    
    // Add styles for emoji avatar
    const emojiStyles = document.createElement('style');
    emojiStyles.textContent = `
        .emoji-avatar-wrapper {
            position: relative;
            cursor: pointer;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
        }
        
        .current-emoji-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            background-color: #f0f0f0;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .current-emoji-avatar:hover {
            background-color: #e0e0e0;
        }
        
        .emoji-selector {
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 10px;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            z-index: 10;
        }
        
        .emoji-selector.active {
            display: grid;
        }
        
        .emoji-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .emoji-option:hover {
            background-color: #f0f0f0;
            transform: scale(1.1);
        }
        
        .user-profile-image {
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
    `;
    document.head.appendChild(emojiStyles);
    
    // Also update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        // Remove any existing img tag
        userProfileImage.innerHTML = '';
        userProfileImage.classList.add('emoji-avatar');
    }
}

// Function to select and save an emoji avatar
function selectEmojiAvatar(emoji) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to change your avatar', 'error');
        return;
    }
    
    // Update the current avatar display
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    if (currentEmojiAvatar) {
        currentEmojiAvatar.textContent = emoji;
    }
    
    // Update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        userProfileImage.textContent = emoji;
    }
    
    // Close the emoji selector
    const emojiSelector = document.getElementById('emojiSelector');
    if (emojiSelector) {
        emojiSelector.classList.remove('active');
    }
    
    // Save the selected emoji to Firebase
    db.collection('users').doc(user.uid).update({
        emojiAvatar: emoji,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        console.log('Emoji avatar updated successfully');
        showToast('Avatar updated successfully');
    })
    .catch(error => {
        console.error('Error updating emoji avatar:', error);
        showToast('Error updating avatar: ' + error.message, 'error');
    });
}

// Function to load the user's emoji avatar
function loadUserEmojiAvatar() {
    const user = auth.currentUser;
    if (!user) return;
    
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Get the emoji avatar or use default
                const emojiAvatar = userData.emojiAvatar || '';
                
                // Update the current avatar display
                const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
                if (currentEmojiAvatar) {
                    currentEmojiAvatar.textContent = emojiAvatar;
                }
                
                // Update the small profile image in the header
                const userProfileImage = document.querySelector('.user-profile-image');
                if (userProfileImage) {
                    userProfileImage.textContent = emojiAvatar;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user emoji avatar:', error);
        });
}

// Modified auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Load emoji avatar
        loadUserEmojiAvatar();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        emojiAvatar: '', // Default emoji avatar
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else if (!doc.data().emojiAvatar) {
                    // If document exists but is missing emojiAvatar, add default
                    console.log('Adding default emoji avatar to user document');
                    return db.collection('users').doc(user.uid).update({
                        emojiAvatar: ''
                    });
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Initialize emoji avatar selector when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    initEmojiAvatarSelector();
    
    // Also initialize the profile circle click handler
    const profileCircle = document.querySelector('.user-profile-image');
    if (profileCircle) {
        profileCircle.addEventListener('click', function() {
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                profileModal.classList.add('active');
                loadUserEmojiAvatar(); // Load emoji avatar when opening modal
                loadUserProfileData();
            }
        });
    }
});

    
    // Toggle password visibility
    togglePasswordBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const passwordInput = this.previousElementSibling;
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    });

    // Show/hide change password section
    changePasswordBtn.addEventListener('click', function() {
        profileForm.classList.add('hidden');
        changePasswordSection.classList.remove('hidden');
    });

    cancelPasswordChange.addEventListener('click', function() {
        changePasswordSection.classList.add('hidden');
        profileForm.classList.remove('hidden');
        changePasswordForm.reset();
    });

    // Password strength meter
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            updatePasswordStrength(this.value);
        });
    }

    // Save profile changes
    profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const saveBtn = document.getElementById('saveProfileBtn');
        setButtonLoading(saveBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to update your profile', 'error');
            setButtonLoading(saveBtn, false);
            return;
        }
        
        const fullName = document.getElementById('profileFullName').value.trim();
        const userType = document.getElementById('profileUserType').value;
        const bio = document.getElementById('profileBio').value.trim();
        
        // Update display name in Auth
        user.updateProfile({
            displayName: fullName
        }).then(() => {
            // Update user data in Firestore
            return db.collection('users').doc(user.uid).update({
                displayName: fullName,
                userType: userType,
                bio: bio,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }).then(() => {
            // Update username display in the dashboard
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = fullName;
            }
            
            showToast('Profile updated successfully');
            setButtonLoading(saveBtn, false);
        }).catch(error => {
            console.error('Error updating profile:', error);
            showToast('Error updating profile: ' + error.message, 'error');
            setButtonLoading(saveBtn, false);
        });
    });

    // Change password
    changePasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('button[type="submit"]');
        setButtonLoading(submitBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to change your password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Check if passwords match
        if (newPassword !== confirmPassword) {
            showToast('New passwords do not match', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Check password strength
        if (getPasswordStrength(newPassword) < 2) {
            showToast('Please choose a stronger password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Reauthenticate user
        const credential = firebase.auth.EmailAuthProvider.credential(
            user.email, 
            currentPassword
        );
        
        user.reauthenticateWithCredential(credential)
            .then(() => {
                // Change password
                return user.updatePassword(newPassword);
            })
            .then(() => {
                showToast('Password updated successfully');
                changePasswordSection.classList.add('hidden');
                profileForm.classList.remove('hidden');
                changePasswordForm.reset();
                setButtonLoading(submitBtn, false);
            })
            .catch(error => {
                console.error('Error changing password:', error);
                let errorMessage = error.message;
                
                // Provide more user-friendly error messages
                if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Current password is incorrect';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'New password is too weak';
                }
                
                showToast('Error: ' + errorMessage, 'error');
                setButtonLoading(submitBtn, false);
            });
    });

    // Load user profile data
    function loadUserProfile() {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to view your profile', 'error');
            profileModal.classList.remove('active');
            return;
        }
        
        // Set email (from Auth)
        const profileEmail = document.getElementById('profileEmail');
        if (profileEmail) {
            profileEmail.value = user.email;
        }
        
        // Set name (from Auth)
        const profileFullName = document.getElementById('profileFullName');
        if (profileFullName) {
            profileFullName.value = user.displayName || '';
        }
        
        // Set profile image (from Auth)
        if (user.photoURL) {
            profileModalImage.src = user.photoURL;
            userProfileImage.src = user.photoURL;
        } else {
            // Set default image
            profileModalImage.src = 'https://via.placeholder.com/150';
            userProfileImage.src = 'https://via.placeholder.com/40';
        }
        
        // Get additional user data from Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Set user type
                    const profileUserType = document.getElementById('profileUserType');
                    if (profileUserType && userData.userType) {
                        profileUserType.value = userData.userType;
                    }
                    
                    // Set bio
                    const profileBio = document.getElementById('profileBio');
                    if (profileBio && userData.bio) {
                        profileBio.value = userData.bio;
                    }
                }
            })
            .catch(error => {
                console.error('Error loading user data:', error);
                showToast('Error loading profile data', 'error');
            });
    }

    // Upload profile image to Firebase Storage
    function uploadProfileImage(file) {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to upload a profile image', 'error');
            return;
        }
        
        // Create a storage reference
        const storageRef = storage.ref();
        const profileImageRef = storageRef.child(`profile_images/${user.uid}`);
        
        // Show loading state
        profileImageWrapper.classList.add('uploading');
        
        // Upload file
        const uploadTask = profileImageRef.put(file);
        
        // Monitor upload progress
        uploadTask.on('state_changed', 
            (snapshot) => {
                // Progress function
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
            }, 
            (error) => {
                // Error function
                console.error('Error uploading image:', error);
                showToast('Error uploading image: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            }, 
            () => {
                // Complete function
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    
                    // Update profile in Auth
                    user.updateProfile({
                        photoURL: downloadURL
                    }).then(() => {
                        // Update profile in Firestore
                        return db.collection('users').doc(user.uid).update({
                            photoURL: downloadURL,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }).then(() => {
                        showToast('Profile image updated successfully');
                        profileImageWrapper.classList.remove('uploading');
                    }).catch(error => {
                        console.error('Error updating profile with new image:', error);
                        showToast('Error updating profile with new image', 'error');
                        profileImageWrapper.classList.remove('uploading');
                    });
                });
            }
        );
    }

    // Password strength checker
    function getPasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 1;
        
        // Contains lowercase
        if (/[a-z]/.test(password)) strength += 1;
        
        // Contains uppercase
        if (/[A-Z]/.test(password)) strength += 1;
        
        // Contains number
        if (/[0-9]/.test(password)) strength += 1;
        
        // Contains special character
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        return Math.min(strength, 4);
    }

    // Update password strength meter
    function updatePasswordStrength(password) {
        const strength = getPasswordStrength(password);
        
        // Reset all segments
        strengthSegments.forEach(segment => {
            segment.className = 'strength-segment';
        });
        
        // Update strength text
        let strengthLabel = 'Weak';
        let strengthClass = 'weak';
        
        if (strength >= 4) {
            strengthLabel = 'Strong';
            strengthClass = 'strong';
        } else if (strength >= 2) {
            strengthLabel = 'Medium';
            strengthClass = 'medium';
        }
        
        strengthText.textContent = strengthLabel;
        
        // Update segments
        for (let i = 0; i < strength; i++) {
            strengthSegments[i].classList.add(strengthClass);
        }
    }

    // Set button loading state
    function setButtonLoading(button, isLoading) {
        if (!button) return;
        
        if (isLoading) {
            button.classList.add('loading');
            button.disabled = true;
            
            // Add spinner
            const spinner = document.createElement('span');
            spinner.className = 'loading-spinner';
            button.appendChild(spinner);
        } else {
            button.classList.remove('loading');
            button.disabled = false;
            
            // Remove spinner
            const spinner = button.querySelector('.loading-spinner');
            if (spinner) {
                button.removeChild(spinner);
            }
        }
    }

    // Initialize profile data when auth state changes
    auth.onAuthStateChanged(function(user) {
        if (user) {
            // Update profile circle image
            if (user.photoURL) {
                userProfileImage.src = user.photoURL;
            }
            
            // Update username display
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = user.displayName || user.email;
            }
        }
    });

    // Initialize dropdown menu for the hamburger button
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const dropdownMenu = document.getElementById('dropdownMenu');
    
    if (hamburgerMenu && dropdownMenu) {
        hamburgerMenu.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            if (dropdownMenu.classList.contains('active')) {
                dropdownMenu.classList.remove('active');
            }
        });
        
        // Prevent dropdown from closing when clicking inside it
        dropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }

    console.log('Profile functionality initialized');
}

// Add this CSS for the dropdown menu
const dropdownStyles = document.createElement('style');
dropdownStyles.textContent = `
.dropdown-menu {
    position: absolute;
    top: 56px;
    right: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    width: 180px;
    z-index: 100;
    overflow: hidden;
    display: none;
    animation: fadeIn 0.2s ease;
}

.dropdown-menu.active {
    display: block;
}

.dropdown-item {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item i {
    font-size: 1rem;
    color: #6c5ce7;
}

.dropdown-item span {
    font-size: 0.9rem;
    color: #333;
}

.logout-btn {
    border-top: 1px solid #eee;
}

.logout-btn i {
    color: #e74c3c;
}

.profile-image-wrapper.uploading {
    opacity: 0.7;
}

.profile-image-wrapper.uploading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3
.org/2000/svg" width="38" height="38" viewBox="0 0 38 38">
    <defs>
        <linearGradient x1="8.042%" y1="0%" x2="65.682%" y2="23.865%" id="a">
            <stop stop-color="#fff" stop-opacity="0" offset="0%"/>
            <stop stop-color="#fff" stop-opacity=".631" offset="63.146%"/>
            <stop stop-color="#fff" offset="100%"/>
        </linearGradient>
    </defs>
    <g fill="none" fill-rule="evenodd">
        <g transform="translate(1 1)">
            <path d="M36 18c0-9.94-8.06-18-18-18" stroke="url(#a)" stroke-width="2">
                <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"/>
            </path>
        </g>
    </g>
</svg>') center no-repeat;
}
`;
document.head.appendChild(dropdownStyles);

// Helper function for showing toast notifications
function showToast(message, type = 'success') {
    // Create toast container if it doesn't exist
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
        <div class="toast-progress"></div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Show and hide toast with animation
    setTimeout(() => toast.classList.add('visible'), 10);
    
    // Remove toast after animation
    setTimeout(() => {
        toast.classList.remove('visible');
        setTimeout(() => toastContainer.removeChild(toast), 300);
    }, 3000);
}

// Add toast styles if they don't exist
if (!document.querySelector('style[data-toast-styles]')) {
    const toastStyles = document.createElement('style');
    toastStyles.setAttribute('data-toast-styles', 'true');
    toastStyles.textContent = `
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    .toast {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        overflow: hidden;
        width: 300px;
        max-width: 100%;
        transform: translateX(120%);
        transition: transform 0.3s ease;
    }
    
    .toast.visible {
        transform: translateX(0);
    }
    
    .toast-content {
        display: flex;
        align-items: center;
        padding: 15px;
    }
    
    .toast-content i {
        font-size: 1.5rem;
        margin-right: 12px;
    }
    
    .toast.success i {
        color: #2ecc71;
    }
    
    .toast.error i {
        color: #e74c3c;
    }
    
    .toast-content span {
        flex: 1;
        font-size: 0.9rem;
        color: #333;
    }
    
    .toast-progress {
        height: 3px;
        background-color: #6c5ce7;
        width: 100%;
        animation: progress 3s linear;
    }
    
    .toast.error .toast-progress {
        background-color: #e74c3c;
    }
    
    @keyframes progress {
        from { width: 100%; }
        to { width: 0%; }
    }
    `;
    document.head.appendChild(toastStyles);
}

// Logout function
function logout() {
    firebase.auth().signOut().then(() => {
        // Redirect to login page or show login form
        window.location.href = 'index.html'; // Adjust as needed
    }).catch((error) => {
        console.error('Error signing out:', error);
        showToast('Error signing out: ' + error.message, 'error');
    });
}

// Check if we need to load Font Awesome
if (!document.querySelector('link[href*="font-awesome"]')) {
    const fontAwesome = document.createElement('link');
    fontAwesome.rel = 'stylesheet';
    fontAwesome.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';
    document.head.appendChild(fontAwesome);
}

// Initialize the profile functionality when the document is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProfileModal);
} else {
    initProfileModal();
}

 // Enhanced function to update profile images from Firebase
function updateProfileImages() {
    const user = auth.currentUser;
    if (!user) return;
    
    console.log('Updating profile images for user:', user.uid);
    
    // First check if user has photoURL in Auth
    if (user.photoURL) {
        console.log('Using photoURL from Auth:', user.photoURL);
        setProfileImages(user.photoURL);
    } else {
        // If not in Auth, check Firestore
        console.log('No photoURL in Auth, checking Firestore');
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists && doc.data().photoURL) {
                    const photoURL = doc.data().photoURL;
                    console.log('Found photoURL in Firestore:', photoURL);
                    
                    // Update Auth with the Firestore photoURL
                    user.updateProfile({
                        photoURL: photoURL
                    }).then(() => {
                        console.log('Updated Auth with Firestore photoURL');
                        setProfileImages(photoURL);
                    }).catch(error => {
                        console.error('Error updating Auth with Firestore photoURL:', error);
                        // Still set the images even if Auth update fails
                        setProfileImages(photoURL);
                    });
                } else {
                    console.log('No photoURL found in Firestore, using default');
                    setProfileImages(null);
                }
            })
            .catch(error => {
                console.error('Error fetching user data from Firestore:', error);
                setProfileImages(null);
            });
    }
}

// Helper function to set profile images with a given URL
function setProfileImages(imageUrl) {
    // Set the images with the determined URL or fallback to placeholder
    if (profileModalImage) {
        profileModalImage.src = imageUrl || 'https://via.placeholder.com/150';
        profileModalImage.onerror = function() {
            console.log('Error loading profile modal image, using placeholder');
            this.src = 'https://via.placeholder.com/150';
        };
    }
    
    if (userProfileImage) {
        userProfileImage.src = imageUrl || 'https://via.placeholder.com/40';
        userProfileImage.onerror = function() {
            console.log('Error loading user profile image, using placeholder');
            this.src = 'https://via.placeholder.com/40';
        };
    }
    
    console.log('Profile images updated with URL:', imageUrl || 'placeholder');
}

// Enhanced auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Update profile images
        updateProfileImages();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        photoURL: user.photoURL || '',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // If document exists but is missing photoURL, update it
                    const userData = doc.data();
                    if (user.photoURL && !userData.photoURL) {
                        console.log('Updating Firestore with Auth photoURL');
                        return db.collection('users').doc(user.uid).update({
                            photoURL: user.photoURL
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Modified upload function to ensure images stay consistent
function uploadProfileImage(file) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to upload a profile image', 'error');
        return;
    }
    
    // Show loading state
    profileImageWrapper.classList.add('uploading');
    showToast('Uploading image...', 'info');
    
    // Create a storage reference
    const storageRef = firebase.storage().ref();
    const profileImageRef = storageRef.child(`profile_images/${user.uid}_${Date.now()}`);
    
    console.log('Starting upload to:', profileImageRef.fullPath);
    
    // Upload file
    const uploadTask = profileImageRef.put(file);
    
    // Monitor upload progress
    uploadTask.on('state_changed', 
        (snapshot) => {
            // Progress function
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
        }, 
        (error) => {
            // Error function
            console.error('Error uploading image:', error);
            showToast('Error uploading image: ' + error.message, 'error');
            profileImageWrapper.classList.remove('uploading');
        }, 
        () => {
            // Complete function - Get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                console.log('File available at', downloadURL);
                
                // Create a transaction to update both Auth and Firestore
                Promise.all([
                    // Update Auth profile
                    user.updateProfile({
                        photoURL: downloadURL
                    }),
                    
                    // Update Firestore document
                    db.collection('users').doc(user.uid).update({
                        photoURL: downloadURL,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                ])
                .then(() => {
                    console.log('Profile updated with new photo URL in both Auth and Firestore');
                    showToast('Profile image updated successfully');
                    
                    // Update both images with the new URL
                    setProfileImages(downloadURL);
                    
                    profileImageWrapper.classList.remove('uploading');
                })
                .catch(error => {
                    console.error('Error updating profile with new image:', error);
                    showToast('Error updating profile with new image: ' + error.message, 'error');
                    profileImageWrapper.classList.remove('uploading');
                });
            }).catch(error => {
                console.error('Error getting download URL:', error);
                showToast('Error getting download URL: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            });
        }
    );
}

// Call updateProfileImages when the page loads to ensure images are displayed
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(updateProfileImages, 1000); // Slight delay to ensure auth is initialized
});

// Also update images when the profile modal is opened
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    updateProfileImages(); // Refresh images when opening modal
    loadUserProfileData();
});

// Modified function to load user profile data without changing the current images
function loadUserProfileData() {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to view your profile', 'error');
        profileModal.classList.remove('active');
        return;
    }
    
    // Set email (from Auth)
    const profileEmail = document.getElementById('profileEmail');
    if (profileEmail) {
        profileEmail.value = user.email;
    }
    
    // Set name (from Auth)
    const profileFullName = document.getElementById('profileFullName');
    if (profileFullName) {
        profileFullName.value = user.displayName || '';
    }
    
    // Get additional user data from Firestore
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Set user type
                const profileUserType = document.getElementById('profileUserType');
                if (profileUserType && userData.userType) {
                    profileUserType.value = userData.userType;
                }
                
                // Set bio
                const profileBio = document.getElementById('profileBio');
                if (profileBio && userData.bio) {
                    profileBio.value = userData.bio;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user data:', error);
            showToast('Error loading profile data', 'error');
        });
}
   
// Hamburger Menu & Sidebar Functionality
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements - Main Navigation
    const hamburgerBtn = document.querySelector('.hamburger-menu');
    const sidebarMenu = document.getElementById('sidebarMenu');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    // DOM Elements - Sidebar Menu Items
    const logoutBtn = document.getElementById('logoutBtn');
    const themeCheckbox = document.getElementById('themeCheckbox');
    const termsBtn = document.getElementById('termsBtn');
    const privacyBtn = document.getElementById('privacyBtn');
    const profileMenuBtn = document.getElementById('profileMenuBtn');
    
    // DOM Elements - Modals
    const termsModal = document.getElementById('termsModal');
    const privacyModal = document.getElementById('privacyModal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    
    // DOM Elements - User Info
    const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
    const sidebarUserName = document.getElementById('sidebarUserName');
    const sidebarUserEmail = document.getElementById('sidebarUserEmail');
    
    // Function to open sidebar
    function openSidebar() {
        sidebarMenu.classList.add('active');
        sidebarOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
        
        // If Firebase is available, log the event
        if (typeof firebase !== 'undefined' && firebase.analytics) {
            firebase.analytics().logEvent('sidebar_opened');
        }
    }
    
    // Function to close sidebar
    function closeSidebar() {
        sidebarMenu.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to open modal
    function openModal(modal) {
        if (!modal) return;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
    
    // Function to close modal
    function closeModal(modal) {
        if (!modal) return;
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to toggle theme
    function toggleTheme(isDark) {
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'dark'
                });
            }
        } else {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'light'
                });
            }
        }
    }
    
    // Function to handle logout
    function handleLogout() {
        // If Firebase is available, log the event and sign out
        if (typeof firebase !== 'undefined' && firebase.auth) {
            if (firebase.analytics) {
                firebase.analytics().logEvent('user_logout');
            }
            
            firebase.auth().signOut()
                .then(() => {
                    window.location.href = 'login.html';
                })
                .catch((error) => {
                    console.error('Error signing out:', error);
                    showToast('Error signing out. Please try again.', 'error');
                });
        } else {
            // Fallback for when Firebase is not available
            console.log('Logout clicked - Firebase not available');
            // Redirect to login page
            window.location.href = 'login.html';
        }
    }
    
    // Function to show toast notification
    function showToast(message, type = 'success') {
        // Check if toast container exists, if not create it
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.classList.add('hide');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
    
    // Function to update user info in sidebar
    function updateUserInfo() {
        // If Firebase is available, get user info
        if (typeof firebase !== 'undefined' && firebase.auth) {
            const user = firebase.auth().currentUser;
            
            if (user) {
                // Set user email
                sidebarUserEmail.textContent = user.email;
                
                // Set user name (display name or email)
                sidebarUserName.textContent = user.displayName || user.email.split('@')[0];
                
                // If Firestore is available, get emoji avatar
                if (firebase.firestore) {
                    firebase.firestore().collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists && doc.data().emojiAvatar) {
                                sidebarUserAvatar.textContent = doc.data().emojiAvatar;
                            }
                        })
                        .catch(error => {
                            console.error('Error getting user data:', error);
                        });
                }
            }
        } else {
            // Fallback for when Firebase is not available
            // You can set default values or get from localStorage
            const savedName = localStorage.getItem('userName') || 'User Name';
            const savedEmail = localStorage.getItem('userEmail') || 'user@example.com';
            const savedEmoji = localStorage.getItem('userEmoji') || '';
            
            sidebarUserName.textContent = savedName;
            sidebarUserEmail.textContent = savedEmail;
            sidebarUserAvatar.textContent = savedEmoji;
        }
    }
    
    // Initialize theme based on localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme === 'dark') {
            themeCheckbox.checked = true;
            toggleTheme(true);
        } else if (savedTheme === 'light') {
            themeCheckbox.checked = false;
            toggleTheme(false);
        } else {
            // If no saved preference, check system preference
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            themeCheckbox.checked = prefersDark;
            toggleTheme(prefersDark);
        }
    }
    
    // Add CSS for toast notifications
    function addToastStyles() {
        const styleExists = document.getElementById('toastStyles');
        if (styleExists) return;
        
        const toastStyles = document.createElement('style');
        toastStyles.id = 'toastStyles';
        toastStyles.textContent = `
            .toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999;
            }
            
            .toast {
                padding: 12px 20px;
                margin-bottom: 10px;
                border-radius: 8px;
                color: white;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }
            
            .toast.success {
                background-color: #2ecc71;
            }
            
            .toast.error {
                background-color: #e74c3c;
            }
            
            .toast.info {
                background-color: #3498db;
            }
            
            .toast.hide {
                opacity: 0;
                transform: translateY(20px);
            }
            
            @supports (padding: max(0px)) {
                .toast-container {
                    padding-bottom: max(20px, env(safe-area-inset-bottom));
                    padding-right: max(20px, env(safe-area-inset-right));
                }
            }
        `;
        document.head.appendChild(toastStyles);
    }
    
    // Event Listeners - Only add if elements exist
    if (hamburgerBtn) {
        hamburgerBtn.addEventListener('click', openSidebar);
    }
    
    if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener('click', closeSidebar);
    }
    
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebar);
    }
    
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            handleLogout();
        });
    }
    
    if (termsBtn) {
        termsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(termsModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('terms_viewed');
            }
        });
    }
    
    if (privacyBtn) {
        privacyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(privacyModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('privacy_viewed');
            }
        });
    }
    
    if (profileMenuBtn) {
        profileMenuBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            
            // Open profile modal if it exists
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                openModal(profileModal);
                
                // If Firebase is available, log the event
                if (typeof firebase !== 'undefined' && firebase.analytics) {
                    firebase.analytics().logEvent('profile_viewed');
                }
            }
        });
    }
    
    // Close modals with close button
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = this.closest('.modal');
            closeModal(modal);
        });
    });
    
    // Close modals when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal(this);
            }
        });
    });
    
    // Theme toggle functionality
    if (themeCheckbox) {
        themeCheckbox.addEventListener('change', function() {
            toggleTheme(this.checked);
        });
    }
    
    // Initialize
    initTheme();
    updateUserInfo();
    addToastStyles();
    
    // Listen for Firebase auth state changes if available
    if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                updateUserInfo();
                
                // If Firestore is available, update user data
                if (firebase.firestore) {
                    const userRef = firebase.firestore().collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists) {
                            // Update last login time
                            userRef.update({
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            // Create user document if it doesn't exist
                            userRef.set({
                                email: user.email,
                                displayName: user.displayName || '',
                                emojiAvatar: '', // Default emoji
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    });
                }
            }
        });
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const walletBtn = document.querySelector('.wallet-btn');
    const walletModal = document.getElementById('walletModal');
    const closeWalletBtn = document.getElementById('closeWalletBtn');
    const closeWalletDashboardBtn = document.getElementById('closeWalletDashboardBtn');
    
    // PIN Setup Elements
    const pinScreen = document.getElementById('pinScreen');
    const pinSetupSection = document.getElementById('pinSetupSection');
    const pinEntrySection = document.getElementById('pinEntrySection');
    const pinConfirmContainer = document.getElementById('pinConfirmContainer');
    const createPinBtn = document.getElementById('createPinBtn');
    const loginPinBtn = document.getElementById('loginPinBtn');
    const forgotPinBtn = document.getElementById('forgotPinBtn');
    
    // Wallet Dashboard Elements
    const walletDashboard = document.getElementById('walletDashboard');
    const walletIdDisplay = document.getElementById('walletIdDisplay');
    const copyWalletIdBtn = document.getElementById('copyWalletIdBtn');
    const talentCoinBalance = document.getElementById('talentCoinBalance');
    const nairaEquivalent = document.getElementById('nairaEquivalent');
    const commissionBalance = document.getElementById('commissionBalance');
    
    // PIN Input Elements
    const pinDigits = document.querySelectorAll('.pin-digit');
    const pinConfirmDigits = document.querySelectorAll('.pin-confirm-digit');
    const pinLoginDigits = document.querySelectorAll('.pin-login-digit');
    
    // Constants
    const TALENT_COIN_RATE = 100; // 1 Talent Coin = 100 (example rate)
    
    // Create backup email elements dynamically
    createBackupEmailSection();
    const backupEmailSection = document.getElementById('backupEmailSection');
    const backupEmailInput = document.getElementById('backupEmail');
    const backupPasswordInput = document.getElementById('backupPassword');
    const saveBackupBtn = document.getElementById('saveBackupBtn');
    
    // Initialize wallet functionality
    initWallet();
    
    // Event Listeners
    if (walletBtn) {
        walletBtn.addEventListener('click', openWallet);
    }
    
    if (closeWalletBtn) {
        closeWalletBtn.addEventListener('click', closeWallet);
    }
    
    if (closeWalletDashboardBtn) {
        closeWalletDashboardBtn.addEventListener('click', closeWallet);
    }
    
    if (createPinBtn) {
        createPinBtn.addEventListener('click', handlePinCreation);
    }
    
    if (loginPinBtn) {
        loginPinBtn.addEventListener('click', handlePinLogin);
    }
    
    if (forgotPinBtn) {
        forgotPinBtn.addEventListener('click', handleForgotPin);
    }
    
    if (copyWalletIdBtn) {
        copyWalletIdBtn.addEventListener('click', copyWalletId);
    }
    
    if (saveBackupBtn) {
        saveBackupBtn.addEventListener('click', saveBackupEmail);
    }
    
    // Setup PIN input fields
    setupPinInputs(pinDigits);
    setupPinInputs(pinConfirmDigits);
    setupPinInputs(pinLoginDigits);
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === walletModal) {
            closeWallet();
        }
    });
    
    // Create backup email section
    function createBackupEmailSection() {
        const backupSection = document.createElement('div');
        backupSection.id = 'backupEmailSection';
        backupSection.className = 'backup-email-section hidden';
        backupSection.innerHTML = `
            <div class="pin-icon">
                <i class="fas fa-envelope-open-text"></i>
            </div>
            <h3>Set Backup Email</h3>
            <p>Add a backup email to recover your wallet if you forget your PIN.</p>
            
            <div class="input-group">
                <label for="backupEmail">Backup Email</label>
                <input type="email" id="backupEmail" placeholder="Enter your backup email">
            </div>
            
            <div class="input-group">
                <label for="backupPassword">Recovery Password</label>
                <div class="password-input">
                    <input type="password" id="backupPassword" placeholder="Create a recovery password">
                    <button type="button" id="toggleBackupPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <button class="wallet-btn primary-btn" id="saveBackupBtn">Save Backup</button>
            <button class="wallet-btn text-btn" id="skipBackupBtn">Skip for Now</button>
        `;
        
        // Append to PIN screen if it exists
        if (pinScreen) {
            pinScreen.appendChild(backupSection);
            
            // Add toggle password functionality
            const toggleBackupPassword = document.getElementById('toggleBackupPassword');
            const backupPassword = document.getElementById('backupPassword');
            
            if (toggleBackupPassword && backupPassword) {
                toggleBackupPassword.addEventListener('click', function() {
                    if (backupPassword.type === 'password') {
                        backupPassword.type = 'text';
                        toggleBackupPassword.innerHTML = '<i class="fas fa-eye-slash"></i>';
                    } else {
                        backupPassword.type = 'password';
                        toggleBackupPassword.innerHTML = '<i class="fas fa-eye"></i>';
                    }
                });
            }
            
            // Add skip backup functionality
            const skipBackupBtn = document.getElementById('skipBackupBtn');
            if (skipBackupBtn) {
                skipBackupBtn.addEventListener('click', function() {
                    backupEmailSection.classList.add('hidden');
                    loadWalletDashboard();
                });
            }
        }
    }
    
    // Initialize wallet
    function initWallet() {
        // Check if user is logged in
        if (!isUserLoggedIn()) {
            // Redirect to login or show login prompt
            showToast('Please log in to access your wallet', 'warning');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Check if PIN is already set in Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Check if wallet PIN exists
                    if (userData.walletPinHash) {
                        // PIN exists, show login screen
                        if (pinSetupSection) pinSetupSection.classList.add('hidden');
                        if (pinEntrySection) pinEntrySection.classList.remove('hidden');
                        if (backupEmailSection) backupEmailSection.classList.add('hidden');
                    } else {
                        // No PIN, show setup screen
                        if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                        if (pinEntrySection) pinEntrySection.classList.add('hidden');
                        if (backupEmailSection) backupEmailSection.classList.add('hidden');
                    }
                } else {
                    // User document doesn't exist, show setup screen
                    if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                    if (pinEntrySection) pinEntrySection.classList.add('hidden');
                    if (backupEmailSection) backupEmailSection.classList.add('hidden');
                }
            })
            .catch(error => {
                console.error('Error checking PIN status:', error);
                showToast('Failed to check PIN status', 'error');
                
                // Default to setup screen
                if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                if (pinEntrySection) pinEntrySection.classList.add('hidden');
                if (backupEmailSection) backupEmailSection.classList.add('hidden');
            });
    }
    
    // Open wallet modal
    function openWallet() {
        // Check if user is logged in
        if (!isUserLoggedIn()) {
            showToast('Please log in to access your wallet', 'warning');
            return;
        }
        
        // Reset PIN inputs
        resetPinInputs();
        
        // Show wallet modal with overlay
        if (walletModal) {
            walletModal.style.display = 'flex';
            
            // Add overlay
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.classList.add('active');
            } else {
                const newOverlay = document.createElement('div');
                newOverlay.className = 'modal-overlay active';
                document.body.appendChild(newOverlay);
            }
            
            // Initialize wallet to check PIN status
            initWallet();
            
            // Focus on first PIN input after a short delay to ensure elements are visible
            setTimeout(() => {
                if (pinSetupSection && !pinSetupSection.classList.contains('hidden')) {
                    if (pinDigits && pinDigits.length > 0) pinDigits[0].focus();
                } else if (pinEntrySection && !pinEntrySection.classList.contains('hidden')) {
                    if (pinLoginDigits && pinLoginDigits.length > 0) pinLoginDigits[0].focus();
                }
            }, 300);
            
            // Add body class to prevent scrolling
            document.body.classList.add('modal-open');
        }
    }
    
    // Close wallet modal
    function closeWallet() {
        if (walletModal) {
            walletModal.style.display = 'none';
            
            // Remove overlay
            const overlay = document.querySelector('.modal-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
            
            // Reset PIN inputs
            resetPinInputs();
            
            // Reset screens
            if (pinScreen) pinScreen.classList.remove('hidden');
            if (walletDashboard) walletDashboard.classList.add('hidden');
            if (backupEmailSection) backupEmailSection.classList.add('hidden');
            
            // Remove body class to allow scrolling
            document.body.classList.remove('modal-open');
            
            // Clean up any listeners
            cleanupWallet();
        }
    }
    
    // Setup PIN input fields
    function setupPinInputs(inputs) {
        if (!inputs || inputs.length === 0) return;
        
        inputs.forEach((input, index) => {
            // Handle input
            input.addEventListener('input', function(e) {
                // Allow only numbers
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Move to next input if value is entered
                if (this.value && index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
                
                // Check if all digits are filled
                if (inputs === pinDigits) {
                    checkPinComplete(pinDigits);
                }
            });
            
            // Handle backspace
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    inputs[index - 1].focus();
                }
            });
            
            // Handle paste
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').replace(/[^0-9]/g, '').slice(0, inputs.length);
                
                if (pastedData) {
                    // Fill inputs with pasted data
                    for (let i = 0; i < pastedData.length; i++) {
                        if (index + i < inputs.length) {
                            inputs[index + i].value = pastedData[i];
                        }
                    }
                    
                    // Focus on next empty input or last input
                    const nextIndex = Math.min(index + pastedData.length, inputs.length - 1);
                    inputs[nextIndex].focus();
                    
                    // Check if all digits are filled
                    if (inputs === pinDigits) {
                        checkPinComplete(pinDigits);
                    }
                }
            });
        });
    }
    
    // Check if PIN is complete and show confirm section
    function checkPinComplete(inputs) {
        if (!inputs || inputs.length === 0 || !pinConfirmContainer) return;
        
        const isComplete = Array.from(inputs).every(input => input.value.length === 1);
        
        if (isComplete && !pinConfirmContainer.classList.contains('hidden')) {
            return;
        }
        
        if (isComplete) {
            pinConfirmContainer.classList.remove('hidden');
            if (pinConfirmDigits && pinConfirmDigits.length > 0) {
                pinConfirmDigits[0].focus();
            }
        }
    }
    
    // Reset PIN inputs
    function resetPinInputs() {
        // Reset PIN setup inputs
        if (pinDigits) {
            Array.from(pinDigits).forEach(input => input.value = '');
        }
        
        if (pinConfirmDigits) {
            Array.from(pinConfirmDigits).forEach(input => input.value = '');
        }
        
        if (pinLoginDigits) {
            Array.from(pinLoginDigits).forEach(input => input.value = '');
        }
        
        // Hide confirm container
        if (pinConfirmContainer) {
            pinConfirmContainer.classList.add('hidden');
        }
    }
    
    // Handle PIN creation
    function handlePinCreation() {
        if (!pinDigits || !pinConfirmDigits) return;
        
        // Get PIN values
        const pin = Array.from(pinDigits).map(input => input.value).join('');
        const confirmPin = Array.from(pinConfirmDigits).map(input => input.value).join('');
        
        // Validate PIN
        if (pin.length !== 4) {
            showToast('Please enter a 4-digit PIN', 'error');
            return;
        }
        
        // Check if confirm PIN is shown
        if (pinConfirmContainer && pinConfirmContainer.classList.contains('hidden')) {
            pinConfirmContainer.classList.remove('hidden');
            if (pinConfirmDigits && pinConfirmDigits.length > 0) {
                pinConfirmDigits[0].focus();
            }
            return;
        }
        
        // Validate confirm PIN
        if (confirmPin.length !== 4) {
            showToast('Please confirm your PIN', 'error');
            return;
        }
        
        // Check if PINs match
        if (pin !== confirmPin) {
            showToast('PINs do not match. Please try again.', 'error');
            resetPinInputs();
            if (pinDigits && pinDigits.length > 0) {
                pinDigits[0].focus();
            }
            return;
        }
        
        // Save PIN to Firebase
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
               // Show loading state
               if (createPinBtn) {
            createPinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
            createPinBtn.disabled = true;
        }
        
        // Hash the PIN before storing
        const pinHash = hashPin(pin);
        
        // Save PIN to Firebase
        firebase.firestore().collection('users').doc(userId).update({
            walletPinHash: pinHash,
            walletPinCreatedAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            // Show success message
            showToast('PIN created successfully', 'success');
            
            // Reset button state
            if (createPinBtn) {
                createPinBtn.innerHTML = 'Create PIN';
                createPinBtn.disabled = false;
            }
            
            // Show backup email section
            if (pinSetupSection) pinSetupSection.classList.add('hidden');
            if (backupEmailSection) backupEmailSection.classList.remove('hidden');
        })
        .catch(error => {
            console.error('Error saving PIN:', error);
            showToast('Failed to create PIN. Please try again.', 'error');
            
            // Reset button state
            if (createPinBtn) {
                createPinBtn.innerHTML = 'Create PIN';
                createPinBtn.disabled = false;
            }
        });
    }
    
    // Save backup email
    function saveBackupEmail() {
        if (!backupEmailInput || !backupPasswordInput) return;
        
        const email = backupEmailInput.value.trim();
        const password = backupPasswordInput.value.trim();
        
        // Validate email
        if (!email) {
            showToast('Please enter a backup email', 'error');
            return;
        }
        
        // Simple email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            showToast('Please enter a valid email address', 'error');
            return;
        }
        
        // Validate password
        if (!password) {
            showToast('Please create a recovery password', 'error');
            return;
        }
        
        if (password.length < 6) {
            showToast('Password must be at least 6 characters', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        if (saveBackupBtn) {
            saveBackupBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            saveBackupBtn.disabled = true;
        }
        
        // Save to Firebase
        firebase.firestore().collection('users').doc(userId).update({
            backupEmail: email,
            backupPasswordHash: hashPassword(password),
            backupSetAt: firebase.firestore.FieldValue.serverTimestamp()
        })
        .then(() => {
            // Show success message
            showToast('Backup email saved successfully', 'success');
            
            // Reset button state
            if (saveBackupBtn) {
                saveBackupBtn.innerHTML = 'Save Backup';
                saveBackupBtn.disabled = false;
            }
            
            // Load wallet dashboard
            if (backupEmailSection) backupEmailSection.classList.add('hidden');
            loadWalletDashboard();
        })
        .catch(error => {
            console.error('Error saving backup email:', error);
            showToast('Failed to save backup email. Please try again.', 'error');
            
            // Reset button state
            if (saveBackupBtn) {
                saveBackupBtn.innerHTML = 'Save Backup';
                saveBackupBtn.disabled = false;
            }
        });
    }
    
    // Handle PIN login
    function handlePinLogin() {
        if (!pinLoginDigits) return;
        
        // Get entered PIN
        const enteredPin = Array.from(pinLoginDigits).map(input => input.value).join('');
        
        // Validate PIN
        if (enteredPin.length !== 4) {
            showToast('Please enter your 4-digit PIN', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        if (loginPinBtn) {
            loginPinBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            loginPinBtn.disabled = true;
        }
        
        // Get stored PIN from Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const storedPinHash = userData.walletPinHash;
                    
                    // Check if PIN is correct
                    if (storedPinHash !== hashPin(enteredPin)) {
                        showToast('Incorrect PIN. Please try again.', 'error');
                        resetPinInputs();
                        if (pinLoginDigits && pinLoginDigits.length > 0) {
                            pinLoginDigits[0].focus();
                        }
                        
                        // Reset button state
                        if (loginPinBtn) {
                            loginPinBtn.innerHTML = 'Login';
                            loginPinBtn.disabled = false;
                        }
                        return;
                    }
                    
                    // Reset button state
                    if (loginPinBtn) {
                        loginPinBtn.innerHTML = 'Login';
                        loginPinBtn.disabled = false;
                    }
                    
                    // Load wallet dashboard
                    loadWalletDashboard();
                } else {
                    showToast('User data not found. Please try again.', 'error');
                    
                    // Reset button state
                    if (loginPinBtn) {
                        loginPinBtn.innerHTML = 'Login';
                        loginPinBtn.disabled = false;
                    }
                }
            })
            .catch(error => {
                console.error('Error verifying PIN:', error);
                showToast('Failed to verify PIN. Please try again.', 'error');
                
                // Reset button state
                if (loginPinBtn) {
                    loginPinBtn.innerHTML = 'Login';
                    loginPinBtn.disabled = false;
                }
            });
    }
    
    // Handle forgot PIN
    function handleForgotPin() {
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Check if backup email is set in Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const backupEmail = userData.backupEmail;
                    
                    if (!backupEmail) {
                        showToast('No backup email found. Please contact support.', 'error');
                        return;
                    }
                    
                    // Create reset PIN modal
                    createResetPinModal(backupEmail);
                } else {
                    showToast('User data not found. Please contact support.', 'error');
                }
            })
            .catch(error => {
                console.error('Error checking backup email:', error);
                showToast('Failed to check backup email. Please try again.', 'error');
            });
    }
    
    // Create reset PIN modal
    function createResetPinModal(email) {
        // Hide current screens
        if (pinScreen) pinScreen.classList.add('hidden');
        
        // Create reset PIN modal if it doesn't exist
        let resetPinModal = document.getElementById('resetPinModal');
        
        if (!resetPinModal) {
            resetPinModal = document.createElement('div');
            resetPinModal.id = 'resetPinModal';
            resetPinModal.className = 'wallet-screen';
            resetPinModal.innerHTML = `
                <div class="wallet-header">
                    <h2>Reset PIN</h2>
                    <button class="close-wallet" id="closeResetPinBtn">&times;</button>
                </div>
                
                <div class="reset-pin-content">
                    <div class="pin-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <h3>Reset Your Wallet PIN</h3>
                    <p>We'll send a reset link to your backup email: <strong>${maskEmail(email)}</strong></p>
                    
                    <div class="input-group">
                        <label for="recoveryPassword">Recovery Password</label>
                        <input type="password" id="recoveryPassword" placeholder="Enter your recovery password">
                    </div>
                    
                    <button class="wallet-btn primary-btn" id="sendResetLinkBtn">Send Reset Link</button>
                    <button class="wallet-btn text-btn" id="backToLoginBtn">Back to Login</button>
                </div>
            `;
            
            if (walletModal) {
                walletModal.querySelector('.wallet-container').appendChild(resetPinModal);
            }
            
            // Add event listeners
            const closeResetPinBtn = document.getElementById('closeResetPinBtn');
            const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
            const backToLoginBtn = document.getElementById('backToLoginBtn');
            
            if (closeResetPinBtn) {
                closeResetPinBtn.addEventListener('click', closeWallet);
            }
            
            if (sendResetLinkBtn) {
                sendResetLinkBtn.addEventListener('click', sendResetLink);
            }
            
            if (backToLoginBtn) {
                backToLoginBtn.addEventListener('click', function() {
                    resetPinModal.classList.add('hidden');
                    if (pinScreen) pinScreen.classList.remove('hidden');
                });
            }
        } else {
            resetPinModal.classList.remove('hidden');
        }
    }
    
    // Send reset link
    function sendResetLink() {
        const recoveryPassword = document.getElementById('recoveryPassword');
        
        if (!recoveryPassword) return;
        
        const password = recoveryPassword.value.trim();
        
        if (!password) {
            showToast('Please enter your recovery password', 'error');
            return;
        }
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User authentication failed', 'error');
            return;
        }
        
        // Show loading state
        const sendResetLinkBtn = document.getElementById('sendResetLinkBtn');
        if (sendResetLinkBtn) {
            sendResetLinkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            sendResetLinkBtn.disabled = true;
        }
        
        // Verify recovery password against Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const storedPasswordHash = userData.backupPasswordHash;
                    
                    // Check if password is correct
                    if (storedPasswordHash !== hashPassword(password)) {
                        showToast('Incorrect recovery password', 'error');
                        
                        // Reset button state
                        if (sendResetLinkBtn) {
                            sendResetLinkBtn.innerHTML = 'Send Reset Link';
                            sendResetLinkBtn.disabled = false;
                        }
                        return;
                    }
                    
                    // In a real app, this would send an actual email
                    // For this demo, we'll simulate sending an email and reset the PIN directly
                    
                    // Remove PIN from Firebase
                    return firebase.firestore().collection('users').doc(userId).update({
                        walletPinHash: firebase.firestore.FieldValue.delete()
                    });
                } else {
                    throw new Error('User data not found');
                }
            })
            .then(() => {
                // Show success message
                showToast('Reset link sent to your email', 'success');
                
                // Close reset modal
                const resetPinModal = document.getElementById('resetPinModal');
                if (resetPinModal) {
                    resetPinModal.classList.add('hidden');
                }
                
                // Show PIN setup screen
                if (pinScreen) pinScreen.classList.remove('hidden');
                if (pinSetupSection) pinSetupSection.classList.remove('hidden');
                if (pinEntrySection) pinEntrySection.classList.add('hidden');
                
                // Reset PIN inputs
                resetPinInputs();
                
                // Focus on first PIN input
                if (pinDigits && pinDigits.length > 0) {
                    pinDigits[0].focus();
                }
                
                // Reset button state
                if (sendResetLinkBtn) {
                    sendResetLinkBtn.innerHTML = 'Send Reset Link';
                    sendResetLinkBtn.disabled = false;
                }
            })
            .catch(error => {
                console.error('Error resetting PIN:', error);
                showToast('Failed to reset PIN. Please try again.', 'error');
                
                // Reset button state
                if (sendResetLinkBtn) {
                    sendResetLinkBtn.innerHTML = 'Send Reset Link';
                    sendResetLinkBtn.disabled = false;
                }
            });
    }
    
    // Load wallet dashboard
    function loadWalletDashboard() {
        // Hide PIN screen and show dashboard
        if (pinScreen) pinScreen.classList.add('hidden');
        if (walletDashboard) walletDashboard.classList.remove('hidden');
        
        // Show loading state
        if (talentCoinBalance) talentCoinBalance.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        if (commissionBalance) commissionBalance.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        
        // Get user ID
        const userId = getUserId();
        
        if (!userId) {
            showToast('User not authenticated', 'error');
            return;
        }
        
        // Get wallet data from Firebase
        firebase.firestore().collection('users').doc(userId).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Set wallet ID
                    if (walletIdDisplay) {
                        walletIdDisplay.textContent = userData.walletId || 'WL' + userId.substring(0, 8);
                    }
                    
                    // Get wallet balance
                    return firebase.firestore().collection('wallets').doc(userId).get();
                } else {
                    throw new Error('User data not found');
                }
            })
            .then(doc => {
                if (doc.exists) {
                    const walletData = doc.data();
                    
                    // Set balances
                    const talentCoins = walletData.talentCoins || 0;
                    const commission = walletData.commission || 0;
                    
                    // Update UI
                    if (talentCoinBalance) talentCoinBalance.textContent = formatNumber(talentCoins);
                    if (commissionBalance) commissionBalance.textContent = formatNumber(commission);
                    
                    // Calculate Naira equivalent
                    const nairaValue = talentCoins * TALENT_COIN_RATE;
                    if (nairaEquivalent) nairaEquivalent.textContent = formatNumber(nairaValue);
                } else {
                    // Create wallet if it doesn't exist
                    return firebase.firestore().collection('wallets').doc(userId).set({
                        talentCoins: 0,
                        commission: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        if (talentCoinBalance) talentCoinBalance.textContent = '0';
                        if (commissionBalance) commissionBalance.textContent = '0';
                        if (nairaEquivalent) nairaEquivalent.textContent = '0';
                    });
                }
            })
            .catch(error => {
                console.error('Error loading wallet data:', error);
                showToast('Failed to load wallet data', 'error');
                
                // Set default values
                if (talentCoinBalance) talentCoinBalance.textContent = '0';
                if (commissionBalance) commissionBalance.textContent = '0';
                if (nairaEquivalent) nairaEquivalent.textContent = '0';
            });
            
        // Setup real-time updates
        setupRealTimeUpdates();
    }
    
    // Copy wallet ID
    function copyWalletId() {
        if (!walletIdDisplay) return;
        
        const walletId = walletIdDisplay.textContent;
        
        // Copy to clipboard
        navigator.clipboard.writeText(walletId)
            .then(() => {
                showToast('Wallet ID copied to clipboard', 'success');
            })
            .catch(err => {
                console.error('Could not copy text: ', err);
                
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = walletId;
                textArea.style.position = 'fixed';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    const successful = document.execCommand('copy');
                    showToast(successful ? 'Wallet ID copied to clipboard' : 'Failed to copy wallet ID', successful ? 'success' : 'error');
                } catch (err) {
                    showToast('Failed to copy wallet ID', 'error');
                }
                
                document.body.removeChild(textArea);
            });
    }
    
    // Helper function to check if user is logged in
    function isUserLoggedIn() {
        return firebase.auth().currentUser !== null;
    }
    
    // Helper function to get user ID
    function getUserId() {
        const user = firebase.auth().currentUser;
        return user ? user.uid : null;
    }
    
    // Helper function to hash PIN (simple hash for demo)
    function hashPin(pin) {
        // In a real app, use a proper hashing algorithm
        // This is just a simple hash for demonstration
        let hash = 0;
        for (let i = 0; i < pin.length; i++) {
            const char = pin.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString();
    }
    
    // Helper function to hash password
    function hashPassword(password) {
        // In a real app, use a proper hashing algorithm with salt
        // This is just a simple hash for demonstration
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
            const char = password.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32bit integer
        }
        return hash.toString();
    }
    
    // Helper function to mask email
    function maskEmail(email) {
        if (!email) return '';
        
        const parts = email.split('@');
        if (parts.length !== 2) return email;
        
        const name = parts[0];
        const domain = parts[1];
        
        const maskedName = name.substring(0, 2) + '***' + name.substring(name.length - 2);
        
        return maskedName + '@' + domain;
    }
    
    // Helper function to format numbers with commas
    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // Function to show toast message
    function showToast(message, type = 'info') {
        // Check if toast container exists, create if not
        let toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toastContainer';
            document.body.appendChild(toastContainer);
            
            // Add styles
            const style = document.createElement('style');
            style.textContent = `
                #toastContainer {
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    z-index: 9999;
                }
                .toast {
                    padding: 12px 20px;
                    margin-bottom: 10px;
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    animation: slideUp 0.3s ease-out forwards;
                    max-width: 90vw;
                }
                .toast.success {
                    background-color: #4CAF50;
                    color: white;
                }
                .toast.error {
                    background-color: #F44336;
                    color: white;
                }
                .toast.info {
                    background-color: #2196F3;
                    color: white;
                }
                .toast.warning {
                    background-color: #FF9800;
                    color: white;
                }
                .toast i {
                    margin-right: 10px;
                    font-size: 18px;
                }
                @keyframes slideUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                @keyframes fadeOut {
                    from {
                        opacity: 1;
                    }
                    to {
                        opacity: 0;
                    }
                }
                
                /* Backup email section styles */
                .backup-email-section {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                    padding: 20px;
                }
                
                .password-input {
                    position: relative;
                    width: 100%;
                }
                
                .password-input input {
                    width: 100%;
                    padding-right: 40px;
                }
                
                .password-input button {
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: var(--text-light);
                    cursor: pointer;
                }
                
                /* Reset PIN modal styles */
                .reset-pin-content {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-align: center;
                    padding: 20px;
                }
                
                /* Animation classes for balance changes */
                .increasing {
                    animation: increaseValue 1s ease;
                    color: var(--success-color);
                }
                
                .decreasing {
                    animation: decreaseValue 1s ease;
                    color: var(--danger-color);
                }
                
                @keyframes increaseValue {
                    0% { color: var(--success-color); transform: scale(1); }
                    50% { color: var(--success-color); transform: scale(1.1); }
                    100% { color: inherit; transform: scale(1); }
                }
                
                @keyframes decreaseValue {
                    0% { color: var(--danger-color); transform: scale(1); }
                    50% { color: var(--danger-color); transform: scale(1.1); }
                    100% { color: inherit; transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        // Set icon based on type
        let icon;
        switch (type) {
            case 'success':
                icon = 'fas fa-check-circle';
                break;
            case 'error':
                icon = 'fas fa-times-circle';
                break;
            case 'warning':
                icon = 'fas fa-exclamation-triangle';
                break;
            default:
                icon = 'fas fa-info-circle';
        }
        
        // Set content
        toast.innerHTML = `<i class="${icon}"></i><span>${message}</span>`;
        
        // Add to container
        toastContainer.appendChild(toast);
        
        // Remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s ease-out forwards';
            setTimeout(() => {
                toastContainer.removeChild(toast);
            }, 300);
        }, 3000);
    }
    
    // Add touch support for mobile devices
    function addTouchSupport() {
        // Add touch support for PIN inputs
        const addTouchToInputs = (inputs) => {
            inputs.forEach(input => {
                input.addEventListener('touchstart', function() {
                    this.focus();
                });
            });
        };
        
        addTouchToInputs(pinDigits);
        addTouchToInputs(pinConfirmDigits);
        addTouchToInputs(pinLoginDigits);
        
        // Fix iOS zoom on input focus
        const viewportMeta = document.querySelector('meta[name="viewport"]');
        if (viewportMeta) {
            viewportMeta.content = 'width=device-width, initial-scale=1, maximum-scale=1';
        } else {
            const meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width, initial-scale=1, maximum-scale=1';
            document.head.appendChild(meta);
        }
    }
    
    // Add mobile-specific enhancements
    function enhanceForMobile() {
        // Detect if device is mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile) {
            // Add touch support
            addTouchSupport();
            
            // Add tap highlight color for better feedback
            const style = document.createElement('style');
            style.textContent = `
                .pin-digit, .pin-confirm-digit, .pin-login-digit, 
                .wallet-btn, .copy-btn, .close-wallet {
                    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
                }
                
                /* Fix for iOS input styling */
                input[type="password"], input[type="text"], input[type="email"] {
                    -webkit-appearance: none;
                    border-radius: 4px;
                }
                
                /* Improve touch targets */
                .wallet-btn, .copy-btn, .close-wallet {
                    min-height: 44px;
                }
                
                /* Fix for iOS modal positioning */
                .wallet-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    -webkit-overflow-scrolling: touch;
                }
                
                /* Fix for iOS scrolling */
                .wallet-container {
                    max-height: 85vh;
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }
                
                /* Add active state for buttons */
                .wallet-btn.active, .copy-btn.active, .close-wallet.active {
                    opacity: 0.8;
                    transform: scale(0.98);
                }
            `;
            document.head.appendChild(style);
            
            // Add active state for buttons
            const buttons = document.querySelectorAll('.wallet-btn, .copy-btn, .close-wallet');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                });
                
                button.addEventListener('touchcancel', function() {
                    this.classList.remove('active');
                });
            });
            
            // Fix for iOS body scrolling when modal is open
            document.addEventListener('touchmove', function(e) {
                if (document.body.classList.contains('modal-open')) {
                    if (!e.target.closest('.wallet-container')) {
                        e.preventDefault();
                    }
                }
            }, { passive: false });
        }
    }
    
    // Call mobile enhancements
    enhanceForMobile();
    
    // Listen for auth state changes
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // User is signed in, enable wallet button
            if (walletBtn) walletBtn.classList.remove('disabled');
        } else {
            // User is signed out, disable wallet button
            if (walletBtn) walletBtn.classList.add('disabled');
            
            // Close wallet if open
            if (walletModal && walletModal.style.display === 'flex') {
                closeWallet();
            }
        }
    });
    
    // Add swipe to close functionality for mobile
    let touchStartY = 0;
    let touchEndY = 0;
    
    if (walletModal) {
        walletModal.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        }, false);
        
        walletModal.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, false);
    }
    
    function handleSwipe() {
        const swipeDistance = touchEndY - touchStartY;
        
        // If swiped down more than 100px, close the modal
        if (swipeDistance > 100) {
            closeWallet();
        }
    }
    
    // Add real-time updates for wallet balance
    function setupRealTimeUpdates() {
        const userId = getUserId();
        
        if (!userId) return;
        
        // Listen for wallet changes
        const unsubscribe = firebase.firestore()
            .collection('wallets')
            .doc(userId)
            .onSnapshot(doc => {
                if (doc.exists && walletDashboard && !walletDashboard.classList.contains('hidden')) {
                    const walletData = doc.data();
                    
                    // Update balances
                    const talentCoins = walletData.talentCoins || 0;
                    const commission = walletData.commission || 0;
                    
                    // Update UI with animation
                    if (talentCoinBalance) animateValueChange(talentCoinBalance, talentCoins);
                    if (commissionBalance) animateValueChange(commissionBalance, commission);
                    
                    // Calculate Naira equivalent
                    const nairaValue = talentCoins * TALENT_COIN_RATE;
                    if (nairaEquivalent) animateValueChange(nairaEquivalent, nairaValue);
                }
            }, error => {
                console.error("Error listening to wallet updates:", error);
            });
        
        // Store unsubscribe function to clean up when wallet is closed
        if (walletModal) {
            walletModal.setAttribute('data-unsubscribe', 'true');
            // Store the unsubscribe function in a global variable
            window.walletUnsubscribe = unsubscribe;
        }
    }
    
    // Animate value change
    function animateValueChange(element, newValue) {
        if (!element) return;
        
        // Get current value
        const currentValue = parseFloat(element.textContent.replace(/,/g, '')) || 0;
        
        // If values are the same, do nothing
        if (currentValue === newValue) return;
        
        // Determine if increasing or decreasing
        const isIncreasing = newValue > currentValue;
        
        // Add class for animation
        element.classList.add(isIncreasing ? 'increasing' : 'decreasing');
        
        // Set new value
        element.textContent = formatNumber(newValue);
        
        // Remove animation class after animation completes
        setTimeout(() => {
            element.classList.remove('increasing', 'decreasing');
        }, 1000);
    }
    
    // Clean up when wallet is closed
    function cleanupWallet() {
        // Unsubscribe from real-time updates
        if (window.walletUnsubscribe && typeof window.walletUnsubscribe === 'function') {
            window.walletUnsubscribe();
            window.walletUnsubscribe = null;
        }
    }
});


// Global variables
let uploadedScreenshotURL = null;
let currentUser = null;

// Initialize Firebase Auth listener
document.addEventListener('DOMContentLoaded', function() {
    // Listen for auth state changes
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            currentUser = user;
            // Initialize wallet functionality once user is authenticated
            initializeBuyCoinFeature();
            // Listen for buy request updates
            listenForBuyRequestUpdates();
        } else {
            currentUser = null;
            console.log('User not logged in');
        }
    });
});

// Initialize Buy Coin Feature
function initializeBuyCoinFeature() {
    // Buy Coins Button Click Event
    const buyCoinsBtn = document.getElementById('buyCoinsBtn');
    const buyCoinsModal = document.getElementById('buyCoinsModal');
    
    if (buyCoinsBtn) {
        buyCoinsBtn.addEventListener('click', function() {
            buyCoinsModal.style.display = 'block';
            resetBuyCoinsForm();
        });
    }
    
    // Close modal when clicking the X button
    const closeButtons = document.querySelectorAll('.close-feature-modal');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            buyCoinsModal.style.display = 'none';
        });
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === buyCoinsModal) {
            buyCoinsModal.style.display = 'none';
        }
    });
    
    // Tab switching functionality
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });
    
    // Next button functionality
    const nextTabBtn = document.querySelector('.next-tab-btn');
    if (nextTabBtn) {
        nextTabBtn.addEventListener('click', function() {
            // Validate input before proceeding
            const coinAmount = document.getElementById('coinAmount').value;
            if (!coinAmount || coinAmount <= 0) {
                showToast('Please enter a valid coin amount', 'error');
                return;
            }
            
            // Set the transfer amount in the confirmation tab
            document.getElementById('transferAmount').value = coinAmount * 10;
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transferDate').value = today;
            
            // Switch to confirmation tab
            switchTab('confirmation');
        });
    }
    
    // Previous button functionality
    const prevTabBtn = document.querySelector('.prev-tab-btn');
    if (prevTabBtn) {
        prevTabBtn.addEventListener('click', function() {
            switchTab('payment');
        });
    }
    
    // Calculate Naira equivalent as user types
    const coinAmountInput = document.getElementById('coinAmount');
    if (coinAmountInput) {
        coinAmountInput.addEventListener('input', function() {
            const amount = parseFloat(this.value) || 0;
            const nairaAmount = amount * 10; // 1 Talent Coin = 10
            document.getElementById('paymentAmount').textContent = nairaAmount.toFixed(0);
        });
    }
    
    // Copy account number functionality
    const copyAccountBtn = document.getElementById('copyAccountBtn');
    if (copyAccountBtn) {
        copyAccountBtn.addEventListener('click', function() {
            const accountNumber = '9078139367';
            navigator.clipboard.writeText(accountNumber)
                .then(() => {
                    showToast('Account number copied to clipboard', 'success');
                })
                .catch(err => {
                    console.error('Could not copy text: ', err);
                    showToast('Failed to copy account number', 'error');
                });
        });
    }
    
    // File upload handling
    const transferScreenshot = document.getElementById('transferScreenshot');
    const fileName = document.getElementById('fileName');
    
    if (transferScreenshot) {
        transferScreenshot.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileName.textContent = file.name;
                
                // Show loading state
                showToast('Uploading screenshot...', 'info');
                
                // Upload the file to Firebase Storage
                uploadScreenshot(file);
            }
        });
    }
    
    // Confirm Transfer Button
    const confirmTransferBtn = document.getElementById('confirmTransferBtn');
    if (confirmTransferBtn) {
        confirmTransferBtn.addEventListener('click', function() {
            submitBuyRequest();
        });
    }
}

// Switch between tabs
function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show the selected tab content
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    // Add active class to the selected tab
    document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
}

// Reset the buy coins form
function resetBuyCoinsForm() {
    document.getElementById('coinAmount').value = '';
    document.getElementById('paymentAmount').textContent = '0';
    document.getElementById('transferReference').value = '';
    document.getElementById('transferAmount').value = '';
    document.getElementById('transferScreenshot').value = '';
    document.getElementById('fileName').textContent = '';
    uploadedScreenshotURL = null;
    
    // Reset to first tab
    switchTab('payment');
}

// Upload screenshot to Firebase Storage
function uploadScreenshot(file) {
    if (!currentUser) {
        showToast('You must be logged in to upload files', 'error');
        return;
    }
    
    const storageRef = firebase.storage().ref();
    const fileRef = storageRef.child(`screenshots/${currentUser.uid}/${Date.now()}_${file.name}`);
    
    fileRef.put(file).then(snapshot => {
        return snapshot.ref.getDownloadURL();
    }).then(downloadURL => {
        uploadedScreenshotURL = downloadURL;
        showToast('Screenshot uploaded successfully', 'success');
    }).catch(error => {
        console.error('Error uploading file:', error);
        showToast('Failed to upload screenshot', 'error');
    });
}

// Submit buy request to Firestore
function submitBuyRequest() {
    if (!currentUser) {
        showToast('You must be logged in to buy coins', 'error');
        return;
    }
    
    // Get form values
    const coinAmount = parseFloat(document.getElementById('coinAmount').value);
    const nairaAmount = coinAmount * 10;
    const transferReference = document.getElementById('transferReference').value;
    const transferDate = document.getElementById('transferDate').value;
    const transferAmount = parseFloat(document.getElementById('transferAmount').value);
    
    // Validate inputs
    if (!coinAmount || coinAmount <= 0) {
        showToast('Please enter a valid coin amount', 'error');
        return;
    }
    
    if (!transferReference) {
        showToast('Please enter the transfer reference', 'error');
        return;
    }
    
    if (!transferDate) {
        showToast('Please select the transfer date', 'error');
        return;
    }
    
    if (!transferAmount || transferAmount <= 0) {
        showToast('Please enter a valid transfer amount', 'error');
        return;
    }
    
    // Validate that naira amount matches transfer amount
    if (Math.abs(nairaAmount - transferAmount) > 0.01) {
        showToast('Transfer amount must match the calculated amount', 'error');
        return;
    }
    
    // Show loading state
    showToast('Submitting your request...', 'info');
    
    // Get user data
    const db = firebase.firestore();
    db.collection('users').doc(currentUser.uid).get()
        .then(userDoc => {
            if (!userDoc.exists) {
                throw new Error('User profile not found');
            }
            
            const userData = userDoc.data();
            
            // Create the buy request document
            return db.collection('buyRequests').add({
                userId: currentUser.uid,
                username: userData.username || userData.displayName || 'Unknown User',
                walletId: currentUser.uid, // Using userId as walletId for simplicity
                amount: coinAmount,
                nairaAmount: nairaAmount,
                transferReference: transferReference,
                paymentScreenshot: uploadedScreenshotURL || '',
                transferDate: transferDate,
                status: 'pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                moderatorNotes: ''
            });
        })
        .then(docRef => {
            console.log('Buy request created with ID:', docRef.id);
            
            // Create activity record
            return db.collection('activity').add({
                userId: currentUser.uid,
                type: 'buy',
                title: 'Buy Request Submitted',
                details: `${coinAmount} Talent Coins (${nairaAmount})`,
                status: 'pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        })
        .then(() => {
            showToast('Buy request submitted successfully', 'success');
            
            // Close the modal
            document.getElementById('buyCoinsModal').style.display = 'none';
            
            // Reset the form
            resetBuyCoinsForm();
            
            // Refresh wallet transactions
            if (typeof loadWalletTransactions === 'function') {
                loadWalletTransactions();
            }
        })
        .catch(error => {
            console.error('Error submitting buy request:', error);
            showToast('Failed to submit buy request: ' + error.message, 'error');
        });
}













// Listen for updates to buy requests
function listenForBuyRequestUpdates() {
    if (!currentUser) return;
    
    const db = firebase.firestore();
    
    // Listen for changes to user's buy requests
    return db.collection('buyRequests')
        .where('userId', '==', currentUser.uid)
        .onSnapshot(snapshot => {
            snapshot.docChanges().forEach(change => {
                const data = change.doc.data();
                
                // If a request was updated
                if (change.type === 'modified') {
                    // Check if status changed to completed
                    if (data.status === 'completed') {
                        // Show notification to user
                        showToast(`Your buy request for ${data.amount} Talent Coins has been approved!`, 'success');
                        
                        // Refresh wallet balance
                        if (typeof refreshWalletBalance === 'function') {
                            refreshWalletBalance();
                        }
                        
                        // Refresh wallet transactions
                        if (typeof loadWalletTransactions === 'function') {
                            loadWalletTransactions();
                        }
                    } 
                    // Check if status changed to rejected
                    else if (data.status === 'rejected') {
                        showToast(`Your buy request for ${data.amount} Talent Coins was rejected. Reason: ${data.moderatorNotes || 'No reason provided'}`, 'error');
                        
                        // Refresh wallet transactions
                        if (typeof loadWalletTransactions === 'function') {
                            loadWalletTransactions();
                        }
                    }
                }
            });
        }, error => {
            console.error('Error listening for buy request updates:', error);
        });
}

// Show toast notification
function showToast(message, type = 'info') {
    // Check if toast container exists, if not create it
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    
    // Add toast to container
    toastContainer.appendChild(toast);
    
    // Show toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Remove toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toastContainer.removeChild(toast);
        }, 300);
    }, 3000);
}










// Load Buy Coin Requests from Firestore
function loadBuyCoinRequests(statusFilter = 'all') {
    const requestsContainer = document.getElementById('buyRequestsContainer');
    if (!requestsContainer) return;
    
    // Show loading state
    requestsContainer.innerHTML = '<div class="loading-spinner"></div>';
    
    const db = firebase.firestore();
    let query = db.collection('buyRequests').orderBy('timestamp', 'desc');
    
    // Apply status filter if not 'all'
    if (statusFilter !== 'all') {
        query = query.where('status', '==', statusFilter);
    }
    
    query.get().then(snapshot => {
        if (snapshot.empty) {
            requestsContainer.innerHTML = '<div class="no-requests">No buy requests found</div>';
            return;
        }
        
        let requestsHTML = '';
        snapshot.forEach(doc => {
            const request = doc.data();
            const requestId = doc.id;
            const timestamp = request.timestamp ? new Date(request.timestamp.toDate()).toLocaleString() : 'Unknown';
            
            let statusClass = '';
            switch(request.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    break;
                case 'completed':
                    statusClass = 'status-completed';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    break;
            }
            
            requestsHTML += `
                <div class="request-card" data-id="${requestId}">
                    <div class="request-header">
                        <div class="request-user">
                            <i class="fas fa-user"></i>
                            <span>${request.username || 'Unknown User'}</span>
                        </div>
                        <div class="request-status ${statusClass}">
                            ${request.status}
                        </div>
                    </div>
                    <div class="request-details">
                        <div class="detail-row">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${request.amount} Talent Coins</span>
                        </div>
                                             <div class="detail-row">
                            <span class="detail-label">Naira:</span>
                            <span class="detail-value">${request.nairaAmount}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Date:</span>
                            <span class="detail-value">${timestamp}</span>
                        </div>
                    </div>
                    <div class="request-actions">
                        <button class="view-details-btn" onclick="viewRequestDetails('${requestId}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                </div>
            `;
        });
        
        requestsContainer.innerHTML = requestsHTML;
    }).catch(error => {
        console.error('Error loading buy requests:', error);
        requestsContainer.innerHTML = '<div class="error-message">Error loading requests. Please try again.</div>';
    });
}

// View Request Details
function viewRequestDetails(requestId) {
    const modal = document.getElementById('requestDetailsModal');
    const modalContent = document.getElementById('requestDetailsContent');
    
    if (!modal || !modalContent) return;
    
    // Show loading state
    modalContent.innerHTML = '<div class="loading-spinner"></div>';
    modal.style.display = 'block';
    
    const db = firebase.firestore();
    db.collection('buyRequests').doc(requestId).get()
        .then(doc => {
            if (!doc.exists) {
                modalContent.innerHTML = '<div class="error-message">Request not found</div>';
                return;
            }
            
            const request = doc.data();
            const timestamp = request.timestamp ? new Date(request.timestamp.toDate()).toLocaleString() : 'Unknown';
            
            let statusClass = '';
            switch(request.status) {
                case 'pending':
                    statusClass = 'status-pending';
                    break;
                case 'completed':
                    statusClass = 'status-completed';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    break;
            }
            
            // Prepare action buttons based on status
            let actionButtons = '';
            if (request.status === 'pending') {
                actionButtons = `
                    <button class="action-btn approve-btn" onclick="approveRequest('${requestId}')">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="action-btn reject-btn" onclick="rejectRequest('${requestId}')">
                        <i class="fas fa-times"></i> Reject
                    </button>
                `;
            }
            
            // Prepare screenshot display
            let screenshotHTML = '';
            if (request.paymentScreenshot) {
                screenshotHTML = `
                    <div class="screenshot-container">
                        <h3>Payment Screenshot</h3>
                        <img src="${request.paymentScreenshot}" alt="Payment Screenshot" class="payment-screenshot">
                        <a href="${request.paymentScreenshot}" target="_blank" class="view-full-btn">
                            <i class="fas fa-external-link-alt"></i> View Full Size
                        </a>
                    </div>
                `;
            } else {
                screenshotHTML = `
                    <div class="no-screenshot">
                        <p>No payment screenshot provided</p>
                    </div>
                `;
            }
            
            modalContent.innerHTML = `
                <div class="request-detail-header">
                    <h2>Buy Request Details</h2>
                    <div class="request-id">ID: ${requestId}</div>
                </div>
                
                <div class="request-detail-status ${statusClass}">
                    Status: ${request.status}
                </div>
                
                <div class="request-detail-section">
                    <h3>User Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Username:</span>
                        <span class="detail-value">${request.username || 'Unknown User'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">User ID:</span>
                        <span class="detail-value">${request.userId}</span>
                    </div>
                </div>
                
                <div class="request-detail-section">
                    <h3>Payment Information</h3>
                    <div class="detail-row">
                        <span class="detail-label">Amount:</span>
                        <span class="detail-value">${request.amount} Talent Coins</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Naira Amount:</span>
                        <span class="detail-value">${request.nairaAmount}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Transfer Reference:</span>
                        <span class="detail-value">${request.transferReference}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Transfer Date:</span>
                        <span class="detail-value">${request.transferDate}</span>
                    </div>
                </div>
                
                ${screenshotHTML}
                
                <div class="request-detail-actions">
                    ${actionButtons}
                </div>
                
                ${request.status === 'pending' ? `
                <div class="admin-notes-input">
                    <label for="moderatorNotes">Admin Notes:</label>
                    <textarea id="moderatorNotes" placeholder="Add notes about this request (optional)"></textarea>
                </div>
                ` : ''}
            `;
        })
        .catch(error => {
            console.error('Error loading request details:', error);
            modalContent.innerHTML = '<div class="error-message">Error loading request details. Please try again.</div>';
        });
}

// Approve Buy Request
function approveRequest(requestId) {
    // Get admin notes
    const notesInput = document.getElementById('moderatorNotes');
    const notes = notesInput ? notesInput.value : '';
    
    // Show loading state
    showToast('Processing request...', 'info');
    
    const db = firebase.firestore();
    
    // Get the request data first
    db.collection('buyRequests').doc(requestId).get()
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Request not found');
            }
            
            const requestData = doc.data();
            const userId = requestData.userId;
            const amount = requestData.amount;
            
            // Use a transaction to update both the request and the wallet
            return db.runTransaction(transaction => {
                // Get the user's wallet
                const walletRef = db.collection('wallets').doc(userId);
                
                return transaction.get(walletRef)
                    .then(walletDoc => {
                        // Get current admin user
                        const adminUser = firebase.auth().currentUser;
                        const adminName = adminUser ? adminUser.displayName || adminUser.email : 'Admin';
                        
                        // Create wallet if it doesn't exist
                        if (!walletDoc.exists) {
                            transaction.set(walletRef, {
                                talentCoins: amount,
                                commission: 0,
                                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            // Update existing wallet
                            const walletData = walletDoc.data();
                            const currentBalance = walletData.talentCoins || 0;
                            
                            transaction.update(walletRef, {
                                talentCoins: currentBalance + amount,
                                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        
                        // Update the request status
                        const requestRef = db.collection('buyRequests').doc(requestId);
                        transaction.update(requestRef, {
                            status: 'completed',
                            moderatorNotes: notes,
                            completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            moderator: adminName
                        });
                        
                        // Create activity record
                        const activityRef = db.collection('activity').doc();
                        transaction.set(activityRef, {
                            userId: userId,
                            type: 'buy',
                            title: 'Buy Request Approved',
                            details: `${amount} Talent Coins added to wallet`,
                            status: 'completed',
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    });
            });
        })
        .then(() => {
            showToast('Buy request approved successfully', 'success');
            
            // Close details modal
            document.getElementById('requestDetailsModal').style.display = 'none';
            
            // Reload buy requests to update the UI
            loadBuyCoinRequests();
        })
        .catch(error => {
            console.error("Error approving request:", error);
            showToast('Failed to approve request: ' + error.message, 'error');
        });
}

// Reject Buy Request
function rejectRequest(requestId) {
    // Get admin notes
    const notesInput = document.getElementById('moderatorNotes');
    const notes = notesInput ? notesInput.value : '';
    
    if (!notes) {
        showToast('Please provide a reason for rejection in the Admin Notes field', 'error');
        return;
    }
    
    // Show loading state
    showToast('Processing request...', 'info');
    
    const db = firebase.firestore();
    
    // Get the request data first
    db.collection('buyRequests').doc(requestId).get()
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Request not found');
            }
            
            const requestData = doc.data();
            const userId = requestData.userId;
            
            // Get current admin user
            const adminUser = firebase.auth().currentUser;
            const adminName = adminUser ? adminUser.displayName || adminUser.email : 'Admin';
            
            // Update the request status
            return db.collection('buyRequests').doc(requestId).update({
                status: 'rejected',
                moderatorNotes: notes,
                completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                moderator: adminName
            }).then(() => {
                // Create activity record
                return db.collection('activity').add({
                    userId: userId,
                    type: 'buy',
                    title: 'Buy Request Rejected',
                    details: `Reason: ${notes}`,
                    status: 'rejected',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            });
        })
        .then(() => {
            showToast('Buy request rejected successfully', 'success');
            
            // Close details modal
            document.getElementById('requestDetailsModal').style.display = 'none';
            
            // Reload buy requests to update the UI
            loadBuyCoinRequests();
        })
        .catch(error => {
            console.error("Error rejecting request:", error);
            showToast('Failed to reject request: ' + error.message, 'error');
        });
}

// Show toast notification
function showToast(message, type = 'info') {
    // Check if toast container exists, if not create it
    let toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    
    // Add toast to container
    toastContainer.appendChild(toast);
    
    // Show toast
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Remove toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toastContainer.removeChild(toast);
        }, 300);
    }, 3000);
}

// Initialize when document is ready
document.addEventListener('DOMContentLoaded', function() {
    // Load buy requests if we're on the admin page
    const requestsContainer = document.getElementById('buyRequestsContainer');
    if (requestsContainer) {
        loadBuyCoinRequests();
    }
    
    // Set up refresh button
    const refreshBtn = document.getElementById('refreshRequestsBtn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            loadBuyCoinRequests();
        });
    }
    
    // Set up filter functionality
    const statusFilter = document.getElementById('statusFilter');
    if (statusFilter) {
        statusFilter.addEventListener('change', function() {
            loadBuyCoinRequests(this.value);
        });
    }
    
    // Set up request details modal close button
    const closeModalBtn = document.querySelector('#requestDetailsModal .close-modal');
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
            document.getElementById('requestDetailsModal').style.display = 'none';
        });
    }
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('requestDetailsModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});


// Initialize history feature
document.addEventListener('DOMContentLoaded', function() {
    // History Button Click Event
    const historyBtn = document.getElementById('historyBtn');
    const historyModal = document.getElementById('historyModal');
    
    if (historyBtn) {
        historyBtn.addEventListener('click', function() {
            openHistoryModal();
        });
    }
    
    // Close modal when clicking the X button
    const closeHistoryModal = document.getElementById('closeHistoryModal');
    if (closeHistoryModal) {
        closeHistoryModal.addEventListener('click', function() {
            historyModal.style.display = 'none';
        });
    }
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === historyModal) {
            historyModal.style.display = 'none';
        }
    });
    
    // Tab switching functionality
    const tabs = document.querySelectorAll('#historyModal .tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchHistoryTab(tabName);
        });
    });
    
    // Transaction filter change event
    const transactionTypeFilter = document.getElementById('transactionTypeFilter');
    if (transactionTypeFilter) {
        transactionTypeFilter.addEventListener('change', function() {
            currentFilter = this.value;
            currentPage = 1;
            loadTransactionHistory();
        });
    }
    
    // Date filter apply button
    const applyDateFilter = document.getElementById('applyDateFilter');
    if (applyDateFilter) {
        applyDateFilter.addEventListener('click', function() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            startDateFilter = startDateInput.value ? new Date(startDateInput.value) : null;
            endDateFilter = endDateInput.value ? new Date(endDateInput.value) : null;
            
            // Validate date range
            if (startDateFilter && endDateFilter && startDateFilter > endDateFilter) {
                showToast('Start date cannot be after end date', 'error');
                return;
            }
            
            currentPage = 1;
            loadTransactionHistory();
        });
    }
    
    // Pagination controls
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    
    if (prevPageBtn) {
        prevPageBtn.addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                loadTransactionHistory();
            }
        });
    }
    
    if (nextPageBtn) {
        nextPageBtn.addEventListener('click', function() {
            if (currentPage < totalPages) {
                currentPage++;
                loadTransactionHistory();
            }
        });
    }
});

// Open history modal
function openHistoryModal() {
    const historyModal = document.getElementById('historyModal');
    if (!historyModal) return;
    
    // Check if user is logged in
    if (!isUserLoggedIn()) {
        showToast('Please log in to view your history', 'warning');
        return;
    }
    
    // Show modal
    historyModal.style.display = 'block';
    
    // Default to inbox tab
    switchHistoryTab('inbox');
    
    // Load inbox messages
    loadInboxMessages();
    
    // Add body class to prevent scrolling
    document.body.classList.add('modal-open');
}

// Switch between history tabs
function switchHistoryTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('#historyModal .tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('#historyModal .tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show the selected tab content
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    // Add active class to the selected tab
    document.querySelector(`#historyModal .tab[data-tab="${tabName}"]`).classList.add('active');
    
    // Load data for the selected tab
    if (tabName === 'inbox') {
        loadInboxMessages();
    } else if (tabName === 'transactions') {
        loadTransactionHistory();
    }
}

// Load inbox messages from Firebase
function loadInboxMessages() {
    const inboxContainer = document.getElementById('inboxContainer');
    const emptyInbox = document.getElementById('emptyInbox');
    
    if (!inboxContainer || !emptyInbox) return;
    
    // Show loading state
    inboxContainer.innerHTML = '<div class="loading-spinner"></div>';
    inboxContainer.style.display = 'block';
    emptyInbox.style.display = 'none';
    
    // Get user ID
    const userId = getUserId();
    
    if (!userId) {
        inboxContainer.innerHTML = '<div class="error-message">Authentication error. Please log in again.</div>';
        return;
    }
    
    // Get messages from Firebase
    firebase.firestore().collection('messages')
        .where('userId', '==', userId)
        .orderBy('timestamp', 'desc')
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                inboxContainer.style.display = 'none';
                emptyInbox.style.display = 'flex';
                return;
            }
            
            let messagesHTML = '';
            let unreadCount = 0;
            
            snapshot.forEach(doc => {
                const message = doc.data();
                const messageId = doc.id;
                const timestamp = message.timestamp ? new Date(message.timestamp.toDate()).toLocaleString() : 'Unknown';
                const isUnread = !message.read;
                
                if (isUnread) {
                    unreadCount++;
                }
                
                messagesHTML += `
                    <div class="message-card ${isUnread ? 'unread' : ''}" data-id="${messageId}">
                        <div class="message-header">
                            <div class="message-title">
                                ${isUnread ? '<span class="unread-dot"></span>' : ''}
                                ${message.title || 'No Subject'}
                            </div>
                            <div class="message-date">${timestamp}</div>
                        </div>
                        <div class="message-body">
                            ${message.content || 'No content'}
                        </div>
                        <div class="message-footer">
                            <button class="mark-read-btn" onclick="markMessageAsRead('${messageId}')">
                                ${isUnread ? 'Mark as Read' : 'Mark as Unread'}
                            </button>
                            <button class="delete-message-btn" onclick="deleteMessage('${messageId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            inboxContainer.innerHTML = messagesHTML;
            inboxContainer.style.display = 'block';
            emptyInbox.style.display = 'none';
            
            // Update unread count badge
            const unreadCountBadge = document.getElementById('unreadCount');
            if (unreadCountBadge) {
                unreadCountBadge.textContent = unreadCount;
                unreadCountBadge.style.display = unreadCount > 0 ? 'inline-flex' : 'none';
            }
        })
        .catch(error => {
            console.error('Error loading inbox messages:', error);
            inboxContainer.innerHTML = '<div class="error-message">Failed to load messages. Please try again.</div>';
        });
}

// Mark message as read
function markMessageAsRead(messageId) {
    const userId = getUserId();
    
    if (!userId || !messageId) {
        showToast('Error updating message status', 'error');
        return;
    }
    
    // Get current read status
    firebase.firestore().collection('messages').doc(messageId).get()
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Message not found');
            }
            
            const message = doc.data();
            const currentReadStatus = message.read || false;
            
            // Toggle read status
            return firebase.firestore().collection('messages').doc(messageId).update({
                read: !currentReadStatus
            });
        })
        .then(() => {
            // Reload inbox to reflect changes
            loadInboxMessages();
            
            showToast('Message status updated', 'success');
        })
        .catch(error => {
            console.error('Error updating message status:', error);
            showToast('Failed to update message status', 'error');
        });
}

// Delete message
function deleteMessage(messageId) {
    if (!confirm('Are you sure you want to delete this message?')) {
        return;
    }
    
    const userId = getUserId();
    
    if (!userId || !messageId) {
        showToast('Error deleting message', 'error');
        return;
    }
    
    firebase.firestore().collection('messages').doc(messageId).delete()
        .then(() => {
            // Reload inbox to reflect changes
            loadInboxMessages();
            
            showToast('Message deleted', 'success');
        })
        .catch(error => {
            console.error('Error deleting message:', error);
            showToast('Failed to delete message', 'error');
        });
}

// Load transaction history from Firebase
function loadTransactionHistory() {
    const transactionsContainer = document.getElementById('transactionsContainer');
    const emptyTransactions = document.getElementById('emptyTransactions');
    const pageIndicator = document.getElementById('pageIndicator');
    
    if (!transactionsContainer || !emptyTransactions) return;
    
    // Show loading state
    transactionsContainer.innerHTML = '<div class="loading-spinner"></div>';
    transactionsContainer.style.display = 'block';
    emptyTransactions.style.display = 'none';
    
    // Get user ID
    const userId = getUserId();
    
    if (!userId) {
        transactionsContainer.innerHTML = '<div class="error-message">Authentication error. Please log in again.</div>';
        return;
    }
    
    // Create query
    let query = firebase.firestore().collection('transactions')
        .where('userId', '==', userId);
    
    // Apply type filter
    if (currentFilter !== 'all') {
        query = query.where('type', '==', currentFilter);
    }
    
    // Get total count for pagination
    query.get()
        .then(snapshot => {
            let filteredDocs = snapshot.docs;
            
            // Apply date filters in memory (Firestore can't filter on multiple fields)
            if (startDateFilter || endDateFilter) {
                filteredDocs = filteredDocs.filter(doc => {
                    const data = doc.data();
                    const txDate = data.timestamp ? new Date(data.timestamp.toDate()) : new Date();
                    
                    if (startDateFilter && endDateFilter) {
                        return txDate >= startDateFilter && txDate <= endDateFilter;
                    } else if (startDateFilter) {
                        return txDate >= startDateFilter;
                    } else if (endDateFilter) {
                        return txDate <= endDateFilter;
                    }
                    
                    return true;
                });
            }
            
            // Calculate pagination
            totalPages = Math.max(1, Math.ceil(filteredDocs.length / pageSize));
            
            // Adjust current page if needed
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            
            // Update page indicator
            if (pageIndicator) {
                pageIndicator.textContent = `Page ${currentPage} of ${totalPages}`;
            }
            
            // Enable/disable pagination buttons
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            
            if (prevPageBtn) {
                prevPageBtn.disabled = currentPage <= 1;
            }
            if (nextPageBtn) {
                nextPageBtn.disabled = currentPage >= totalPages;
            }
            
            // Get paginated results
            const startIndex = (currentPage - 1) * pageSize;
            const paginatedDocs = filteredDocs.slice(startIndex, startIndex + pageSize);
            
            if (paginatedDocs.length === 0) {
                transactionsContainer.style.display = 'none';
                emptyTransactions.style.display = 'flex';
                return;
            }
            
            // Sort by timestamp (most recent first)
            paginatedDocs.sort((a, b) => {
                const timestampA = a.data().timestamp ? a.data().timestamp.toDate() : new Date(0);
                const timestampB = b.data().timestamp ? b.data().timestamp.toDate() : new Date(0);
                return timestampB - timestampA;
            });
            
            let transactionsHTML = '';
            
            paginatedDocs.forEach(doc => {
                const transaction = doc.data();
                const transactionId = doc.id;
                const timestamp = transaction.timestamp 
                    ? new Date(transaction.timestamp.toDate()).toLocaleString() 
                    : 'Unknown';
                
                // Determine transaction icon and status class
                let icon, statusClass, statusText;
                
                switch (transaction.type) {
                    case 'buy':
                        icon = 'fa-shopping-cart';
                        statusClass = getStatusClass(transaction.status);
                        statusText = transaction.status || 'Processing';
                        break;
                    case 'send':
                        icon = 'fa-paper-plane';
                        statusClass = 'completed';
                        statusText = 'Sent';
                        break;
                    case 'receive':
                        icon = 'fa-download';
                        statusClass = 'completed';
                        statusText = 'Received';
                        break;
                    case 'reward':
                        icon = 'fa-gift';
                        statusClass = 'completed';
                        statusText = 'Rewarded';
                        break;
                    default:
                        icon = 'fa-exchange-alt';
                        statusClass = 'pending';
                        statusText = 'Unknown';
                }
                
                // Format transaction details based on type
                let transactionDetails = '';
                
                if (transaction.type === 'buy') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Naira Amount:</span>
                            <span class="detail-value">${transaction.nairaAmount || (transaction.amount * 10)}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Reference:</span>
                            <span class="detail-value">${transaction.transferReference || 'N/A'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'send') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Recipient:</span>
                            <span class="detail-value">${transaction.recipientUsername || 'Unknown User'}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Note:</span>
                            <span class="detail-value">${transaction.note || 'No note'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'receive') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">From:</span>
                            <span class="detail-value">${transaction.senderUsername || 'Unknown User'}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Note:</span>
                            <span class="detail-value">${transaction.note || 'No note'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'reward') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Reason:</span>
                            <span class="detail-value">${transaction.reason || 'Platform reward'}</span>
                        </div>
                    `;
                }
                
                transactionsHTML += `
                    <div class="transaction-card" data-id="${transactionId}">
                        <div class="transaction-icon">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="transaction-content">
                            <div class="transaction-header">
                                <div class="transaction-title">
                                    ${getTransactionTitle(transaction)}
                                </div>
                                <div class="transaction-date">${timestamp}</div>
                            </div>
                            <div class="transaction-details">
                                ${transactionDetails}
                            </div>
                            <div class="transaction-status ${statusClass}">
                                ${statusText}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            transactionsContainer.innerHTML = transactionsHTML;
            transactionsContainer.style.display = 'block';
            emptyTransactions.style.display = 'none';
        })
        .catch(error => {
            console.error('Error loading transaction history:', error);
            transactionsContainer.innerHTML = '<div class="error-message">Failed to load transactions. Please try again.</div>';
        });
}

// Helper function to get transaction title based on type
function getTransactionTitle(transaction) {
    switch (transaction.type) {
        case 'buy':
            return 'Purchased Talent Coins';
        case 'send':
            return `Sent Coins to ${transaction.recipientUsername || 'User'}`;
        case 'receive':
            return `Received Coins from ${transaction.senderUsername || 'User'}`;
        case 'reward':
            return 'Platform Reward';
        default:
            return 'Transaction';
    }
}

// Helper function to get status class for styling
function getStatusClass(status) {
    switch (status) {
        case 'completed':
        case 'approved':
            return 'completed';
        case 'pending':
            return 'pending';
        case 'rejected':
        case 'failed':
            return 'rejected';
        default:
            return 'pending';
    }
}

// Helper function to get current user ID
function getUserId() {
    const user = firebase.auth().currentUser;
    return user ? user.uid : null;
}

// Helper function to check if user is logged in
function isUserLoggedIn() {
    return !!firebase.auth().currentUser;
}

// Helper function to show toast notifications
function showToast(message, type = 'info') {
    // Check if toast container exists, if not create it
    let toastContainer = document.querySelector('.toast-container');
    
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${getToastIcon(type)}"></i>
            <span>${message}</span>
        </div>
        <div class="toast-progress"></div>
    `;
    
    // Add toast to container
    toastContainer.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Remove toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

// Helper function to get toast icon based on type
function getToastIcon(type) {
    switch (type) {
        case 'success':
            return 'fa-check-circle';
        case 'error':
            return 'fa-exclamation-circle';
        case 'warning':
            return 'fa-exclamation-triangle';
        default:
            return 'fa-info-circle';
    }
}

// Add CSS for the history feature
const historyStyles = `
/* History Modal Styles */
.feature-modal#historyModal .feature-modal-content {
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
}

.feature-modal#historyModal .feature-modal-body {
    max-height: calc(80vh - 60px);
    overflow-y: auto;
}

/* Tabs */
.tabs {
    display: flex;
    border-bottom: 1px solid #ddd;
    margin-bottom: 20px;
}

.tab {
    padding: 12px 20px;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
}

.tab.active {
    border-bottom: 3px solid #4a6cf7;
    color: #4a6cf7;
    font-weight: 600;
}

.tab:hover:not(.active) {
    background-color: #f5f5f5;
}

.notification-badge {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #ff4757;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

/* Tab Content */
.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

/* Inbox Styles */
.inbox-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message-card {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    transition: all 0.3s ease;
}

.message-card.unread {
    border-left: 4px solid #4a6cf7;
    background-color: #f0f5ff;
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.message-title {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.unread-dot {
    width: 10px;
    height: 10px;
    background-color: #4a6cf7;
    border-radius: 50%;
    display: inline-block;
}

.message-date {
    font-size: 0.85rem;
    color: #777;
}

.message-body {
    margin-bottom: 15px;
    line-height: 1.5;
}

.message-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.mark-read-btn, .delete-message-btn {
    padding: 6px 12px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s ease;
}

.mark-read-btn {
    background-color: #f1f1f1;
    color: #333;
}

.mark-read-btn:hover {
    background-color: #e1e1e1;
}

.delete-message-btn {
    background-color: #ffebee;
    color: #e53935;
}

.delete-message-btn:hover {
    background-color: #ffcdd2;
}

/* Transaction Styles */
.filter-controls {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.date-filter {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 8px 15px;
    background-color: #4a6cf7;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-btn:hover {
    background-color: #3a5bd9;
}

.transactions-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.transaction-card {
    display: flex;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    transition: all 0.3s ease;
}

.transaction-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #f1f5fe;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    flex-shrink: 0;
}

.transaction-icon i {
    font-size: 20px;
    color: #4a6cf7;
}

.transaction-content {
    flex: 1;
}

.transaction-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.transaction-title {
    font-weight: 600;
}

.transaction-date {
    font-size: 0.85rem;
    color: #777;
}

.transaction-details {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-bottom: 10px;
}

.transaction-detail {
    display: flex;
    font-size: 0.9rem;
}

.detail-label {
    width: 100px;
    color: #777;
}
.transaction-status {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-align: center;
}

.transaction-status.completed {
    background-color: #e6f7ee;
    color: #2ecc71;
}

.transaction-status.pending {
    background-color: #fff8e6;
    color: #f39c12;
}

.transaction-status.rejected {
    background-color: #ffebee;
    color: #e53935;
}

/* Pagination Controls */
.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 15px;
}

.pagination-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid #ddd;
    background-color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.pagination-btn:hover:not(:disabled) {
    background-color: #f5f5f5;
    border-color: #aaa;
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#pageIndicator {
    font-size: 0.9rem;
    color: #555;
}

/* Empty States */
.empty-state {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 20px;
    color: #777;
    text-align: center;
}

.empty-state i {
    margin-bottom: 15px;
    color: #ddd;
}

/* Loading Spinner */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3;
    border-top: 4px solid #4a6cf7;
    border-radius: 50%;
    margin: 20px auto;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.toast {
    min-width: 250px;
    max-width: 350px;
    background-color: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    overflow: hidden;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
}

.toast.show {
    transform: translateX(0);
    opacity: 1;
}

.toast.success .toast-content i {
    color: #2ecc71;
}

.toast.error .toast-content i {
    color: #e53935;
}

.toast.warning .toast-content i {
    color: #f39c12;
}

.toast.info .toast-content i {
    color: #4a6cf7;
}

.toast-content {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.toast-content i {
    font-size: 20px;
}

.toast-progress {
    height: 3px;
    background-color: #4a6cf7;
    width: 100%;
    animation: progress 3s linear forwards;
}

@keyframes progress {
    0% { width: 100%; }
    100% { width: 0%; }
}

/* Responsive Styles */
@media (max-width: 768px) {
    .feature-modal#historyModal .feature-modal-content {
        width: 95%;
    }
    
    .filter-controls {
        flex-direction: column;
        gap: 15px;
    }
    
    .date-filter {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .date-filter input {
        width: 100%;
    }
    
    .transaction-header {
        flex-direction: column;
        gap: 5px;
    }
    
    .transaction-detail {
        flex-direction: column;
        gap: 2px;
    }
    
    .detail-label {
        width: auto;
    }
}
`;

           // Initialize the history feature when the document is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Add the history modal to the DOM if it doesn't exist
    if (!document.getElementById('historyModal')) {
        // Create the history modal element
        const historyModalHTML = `
            <!-- History Modal -->
            <div class="feature-modal" id="historyModal">
                <div class="feature-modal-content">
                    <div class="feature-modal-header">
                        <h2>History</h2>
                        <button class="close-feature-modal" id="closeHistoryModal">&times;</button>
                    </div>
                    
                    <div class="feature-modal-body">
                        <div class="tabs">
                            <div class="tab active" data-tab="inbox">
                                <i class="fas fa-inbox"></i> Inbox
                                <span class="notification-badge" id="unreadCount">0</span>
                            </div>
                            <div class="tab" data-tab="transactions">
                                <i class="fas fa-exchange-alt"></i> Transactions
                            </div>
                        </div>
                        
                        <!-- Inbox Tab -->
                        <div class="tab-content active" id="inboxTab">
                            <div class="inbox-container" id="inboxContainer">
                                <div class="loading-spinner"></div>
                            </div>
                            <div class="empty-state" id="emptyInbox">
                                <i class="fas fa-inbox fa-3x"></i>
                                <p>Your inbox is empty</p>
                            </div>
                        </div>
                        
                        <!-- Transactions Tab -->
                        <div class="tab-content" id="transactionsTab">
                            <div class="filter-controls">
                                <select id="transactionTypeFilter">
                                    <option value="all">All Transactions</option>
                                    <option value="buy">Buy Coins</option>
                                    <option value="send">Send Coins</option>
                                    <option value="receive">Receive Coins</option>
                                    <option value="reward">Rewards</option>
                                </select>
                                <div class="date-filter">
                                    <input type="date" id="startDate" placeholder="Start Date">
                                    <input type="date" id="endDate" placeholder="End Date">
                                    <button id="applyDateFilter" class="filter-btn">Apply</button>
                                </div>
                            </div>
                            
                            <div class="transactions-container" id="transactionsContainer">
                                <div class="loading-spinner"></div>
                            </div>
                            
                            <div class="empty-state" id="emptyTransactions">
                                <i class="fas fa-exchange-alt fa-3x"></i>
                                <p>No transactions found</p>
                            </div>
                            
                            <div class="pagination-controls" id="transactionPagination">
                                <button id="prevPage" class="pagination-btn"><i class="fas fa-chevron-left"></i></button>
                                <span id="pageIndicator">Page 1 of 1</span>
                                <button id="nextPage" class="pagination-btn"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Create a container element
        const modalContainer = document.createElement('div');
        modalContainer.innerHTML = historyModalHTML;
        
        // Append to the body
        document.body.appendChild(modalContainer.firstElementChild);
        
        // Add the CSS styles
        const styleElement = document.createElement('style');
        styleElement.textContent = `
            /* History Modal Styles */
            .feature-modal#historyModal .feature-modal-content {
                max-width: 800px;
                width: 90%;
                max-height: 80vh;
            }

            .feature-modal#historyModal .feature-modal-body {
                max-height: calc(80vh - 60px);
                overflow-y: auto;
            }

            /* Tabs */
            .tabs {
                display: flex;
                border-bottom: 1px solid #ddd;
                margin-bottom: 20px;
            }

            .tab {
                padding: 12px 20px;
                cursor: pointer;
                position: relative;
                transition: all 0.3s ease;
            }

            .tab.active {
                border-bottom: 3px solid #4a6cf7;
                color: #4a6cf7;
                font-weight: 600;
            }

            .tab:hover:not(.active) {
                background-color: #f5f5f5;
            }

            .notification-badge {
                position: absolute;
                top: 5px;
                right: 5px;
                background-color: #ff4757;
                color: white;
                border-radius: 50%;
                width: 18px;
                height: 18px;
                font-size: 11px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            /* Tab Content */
            .tab-content {
                display: none;
            }

            .tab-content.active {
                display: block;
            }

            /* Inbox Styles */
            .inbox-container {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .message-card {
                background-color: #fff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                padding: 15px;
                transition: all 0.3s ease;
            }

            .message-card.unread {
                border-left: 4px solid #4a6cf7;
                background-color: #f0f5ff;
            }

            .message-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            .message-title {
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .unread-dot {
                width: 10px;
                height: 10px;
                background-color: #4a6cf7;
                border-radius: 50%;
                display: inline-block;
            }

            .message-date {
                font-size: 0.85rem;
                color: #777;
            }

            .message-body {
                margin-bottom: 15px;
                line-height: 1.5;
            }

            .message-footer {
                display: flex;
                justify-content: flex-end;
                gap: 10px;
            }

            .mark-read-btn, .delete-message-btn {
                padding: 6px 12px;
                border-radius: 4px;
                border: none;
                cursor: pointer;
                font-size: 0.85rem;
                transition: all 0.2s ease;
            }

            .mark-read-btn {
                background-color: #f1f1f1;
                color: #333;
            }

            .mark-read-btn:hover {
                background-color: #e1e1e1;
            }

            .delete-message-btn {
                background-color: #ffebee;
                color: #e53935;
            }

            .delete-message-btn:hover {
                background-color: #ffcdd2;
            }

            /* Transaction Styles */
            .filter-controls {
                display: flex;
                justify-content: space-between;
                margin-bottom: 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            .date-filter {
                display: flex;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
            }

            .filter-btn {
                padding: 8px 15px;
                background-color: #4a6cf7;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .filter-btn:hover {
                background-color: #3a5bd9;
            }

            .transactions-container {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .transaction-card {
                display: flex;
                background-color: #fff;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                padding: 15px;
                transition: all 0.3s ease;
            }

            .transaction-icon {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background-color: #f1f5fe;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 15px;
                flex-shrink: 0;
            }

            .transaction-icon i {
                font-size: 20px;
                color: #4a6cf7;
            }

            .transaction-content {
                flex: 1;
            }

            .transaction-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            .transaction-title {
                font-weight: 600;
            }

            .transaction-date {
                font-size: 0.85rem;
                color: #777;
            }

            .transaction-details {
                display: flex;
                flex-direction: column;
                gap: 5px;
                margin-bottom: 10px;
            }

            .transaction-detail {
                display: flex;
                font-size: 0.9rem;
            }

            .detail-label {
                width: 100px;
                color: #777;
            }

            .transaction-status {
                display: inline-block;
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 600;
                text-align: center;
            }

            .transaction-status.completed {
                background-color: #e6f7ee;
                color: #2ecc71;
            }

            .transaction-status.pending {
                background-color: #fff8e6;
                color: #f39c12;
            }

            .transaction-status.rejected {
                background-color: #ffebee;
                color: #e53935;
            }

            /* Pagination Controls */
            .pagination-controls {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-top: 20px;
                gap: 15px;
            }

            .pagination-btn {
                width: 36px;
                height: 36px;
                border-radius: 50%;
                border: 1px solid #ddd;
                background-color: white;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
            }

            .pagination-btn:hover:not(:disabled) {
                background-color: #f5f5f5;
                border-color: #aaa;
            }

            .pagination-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }

            #pageIndicator {
                font-size: 0.9rem;
                color: #555;
            }

            /* Empty States */
            .empty-state {
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 40px 20px;
                color: #777;
                text-align: center;
            }

            .empty-state i {
                margin-bottom: 15px;
                color: #ddd;
            }

            /* Loading Spinner */
            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #4a6cf7;
                border-radius: 50%;
                margin: 20px auto;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            /* Toast Notifications */
            .toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .toast {
                min-width: 250px;
                max-width: 350px;
                background-color: white;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                border-radius: 8px;
                overflow: hidden;
                transform: translateX(100%);
                opacity: 0;
                transition: all 0.3s ease;
            }

            .toast.show {
                transform: translateX(0);
                opacity: 1;
            }

            .toast.success .toast-content i {
                color: #2ecc71;
            }

            .toast.error .toast-content i {
                color: #e53935;
            }

            .toast.warning .toast-content i {
                color: #f39c12;
            }

            .toast.info .toast-content i {
                color: #4a6cf7;
            }

            .toast-content {
                padding: 12px 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .toast-content i {
                font-size: 20px;
            }

            .toast-progress {
                height: 3px;
                background-color: #4a6cf7;
                width: 100%;
                animation: progress 3s linear forwards;
            }

            @keyframes progress {
                0% { width: 100%; }
                100% { width: 0%; }
            }

            /* Responsive Styles */
            @media (max-width: 768px) {
                .feature-modal#historyModal .feature-modal-content {
                    width: 95%;
                }
                
                .filter-controls {
                    flex-direction: column;
                    gap: 15px;
                }
                
                .date-filter {
                    flex-direction: column;
                    align-items: flex-start;
                }
                
                .date-filter input {
                    width: 100%;
                }
                
                .transaction-header {
                    flex-direction: column;
                    gap: 5px;
                }
                
                .transaction-detail {
                    flex-direction: column;
                    gap: 2px;
                }
                
                .detail-label {
                    width: auto;
                }
            }
        `;
        document.head.appendChild(styleElement);
    }
        // Add event listener to the history button
        const historyBtn = document.getElementById('historyBtn');
    if (historyBtn) {
        historyBtn.addEventListener('click', function() {
            openHistoryModal();
        });
    }
    
    // Add event listeners for tab switching
    const tabs = document.querySelectorAll('#historyModal .tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchHistoryTab(tabName);
        });
    });
    
    // Close modal when clicking the X button
    const closeHistoryModal = document.getElementById('closeHistoryModal');
    if (closeHistoryModal) {
        closeHistoryModal.addEventListener('click', function() {
            document.getElementById('historyModal').style.display = 'none';
        });
    }
    
    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        const historyModal = document.getElementById('historyModal');
        if (event.target === historyModal) {
            historyModal.style.display = 'none';
        }
    });
    
    // Transaction filter change event
    const transactionTypeFilter = document.getElementById('transactionTypeFilter');
    if (transactionTypeFilter) {
        transactionTypeFilter.addEventListener('change', function() {
            currentFilter = this.value;
            currentPage = 1;
            loadTransactionHistory();
        });
    }
    
    // Date filter apply button
    const applyDateFilter = document.getElementById('applyDateFilter');
    if (applyDateFilter) {
        applyDateFilter.addEventListener('click', function() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            startDateFilter = startDateInput.value ? new Date(startDateInput.value) : null;
            endDateFilter = endDateInput.value ? new Date(endDateInput.value) : null;
            
            // Validate date range
            if (startDateFilter && endDateFilter && startDateFilter > endDateFilter) {
                showToast('Start date cannot be after end date', 'error');
                return;
            }
            
            currentPage = 1;
            loadTransactionHistory();
        });
    }
    
    // Pagination controls
    const prevPageBtn = document.getElementById('prevPage');
    const nextPageBtn = document.getElementById('nextPage');
    
    if (prevPageBtn) {
        prevPageBtn.addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                loadTransactionHistory();
            }
        });
    }
    
    if (nextPageBtn) {
        nextPageBtn.addEventListener('click', function() {
            if (currentPage < totalPages) {
                currentPage++;
                loadTransactionHistory();
            }
        });
    }
});

// Global variables for pagination
let currentPage = 1;
const pageSize = 10;
let totalPages = 1;
let currentFilter = 'all';
let startDateFilter = null;
let endDateFilter = null;

// Open history modal
function openHistoryModal() {
    const historyModal = document.getElementById('historyModal');
    if (!historyModal) return;
    
    // Check if user is logged in
    if (!isUserLoggedIn()) {
        showToast('Please log in to view your history', 'warning');
        return;
    }
    
    // Show modal
    historyModal.style.display = 'block';
    
    // Default to inbox tab
    switchHistoryTab('inbox');
    
    // Load inbox messages
    loadInboxMessages();
    
    // Add body class to prevent scrolling
    document.body.classList.add('modal-open');
}

// Switch between history tabs
function switchHistoryTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('#historyModal .tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('#historyModal .tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Show the selected tab content
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    // Add active class to the selected tab
    document.querySelector(`#historyModal .tab[data-tab="${tabName}"]`).classList.add('active');
    
    // Load data for the selected tab
    if (tabName === 'inbox') {
        loadInboxMessages();
    } else if (tabName === 'transactions') {
        loadTransactionHistory();
    }
}

// Load inbox messages from Firebase
function loadInboxMessages() {
    const inboxContainer = document.getElementById('inboxContainer');
    const emptyInbox = document.getElementById('emptyInbox');
    
    if (!inboxContainer || !emptyInbox) return;
    
    // Show loading state
    inboxContainer.innerHTML = '<div class="loading-spinner"></div>';
    inboxContainer.style.display = 'block';
    emptyInbox.style.display = 'none';
    
    // Get user ID
    const userId = getUserId();
    
    if (!userId) {
        inboxContainer.innerHTML = '<div class="error-message">Authentication error. Please log in again.</div>';
        return;
    }
    
    // Get messages from Firebase
    firebase.firestore().collection('messages')
        .where('userId', '==', userId)
        .orderBy('timestamp', 'desc')
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                inboxContainer.style.display = 'none';
                emptyInbox.style.display = 'flex';
                return;
            }
            
            let messagesHTML = '';
            let unreadCount = 0;
            
            snapshot.forEach(doc => {
                const message = doc.data();
                const messageId = doc.id;
                const timestamp = message.timestamp ? new Date(message.timestamp.toDate()).toLocaleString() : 'Unknown';
                const isUnread = !message.read;
                
                if (isUnread) {
                    unreadCount++;
                }
                
                messagesHTML += `
                    <div class="message-card ${isUnread ? 'unread' : ''}" data-id="${messageId}">
                        <div class="message-header">
                            <div class="message-title">
                                ${isUnread ? '<span class="unread-dot"></span>' : ''}
                                ${message.title || 'No Subject'}
                            </div>
                            <div class="message-date">${timestamp}</div>
                        </div>
                        <div class="message-body">
                            ${message.content || 'No content'}
                        </div>
                        <div class="message-footer">
                            <button class="mark-read-btn" onclick="markMessageAsRead('${messageId}')">
                                ${isUnread ? 'Mark as Read' : 'Mark as Unread'}
                            </button>
                            <button class="delete-message-btn" onclick="deleteMessage('${messageId}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            inboxContainer.innerHTML = messagesHTML;
            inboxContainer.style.display = 'block';
            emptyInbox.style.display = 'none';
            
            // Update unread count badge
            const unreadCountBadge = document.getElementById('unreadCount');
            if (unreadCountBadge) {
                unreadCountBadge.textContent = unreadCount;
                unreadCountBadge.style.display = unreadCount > 0 ? 'inline-flex' : 'none';
            }
        })
        .catch(error => {
            console.error('Error loading inbox messages:', error);
            inboxContainer.innerHTML = '<div class="error-message">Failed to load messages. Please try again.</div>';
        });
}

// Mark message as read
function markMessageAsRead(messageId) {
    const userId = getUserId();
    
    if (!userId || !messageId) {
        showToast('Error updating message status', 'error');
        return;
    }
    
    // Get current read status
    firebase.firestore().collection('messages').doc(messageId).get()
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Message not found');
            }
            
            const message = doc.data();
            const currentReadStatus = message.read || false;
            
            // Toggle read status
            return firebase.firestore().collection('messages').doc(messageId).update({
                read: !currentReadStatus
            });
        })
        .then(() => {
            // Reload inbox to reflect changes
            loadInboxMessages();
            
            showToast('Message status updated', 'success');
        })
        .catch(error => {
            console.error('Error updating message status:', error);
            showToast('Failed to update message status', 'error');
        });
}

// Delete message
function deleteMessage(messageId) {
    if (!confirm('Are you sure you want to delete this message?')) {
        return;
    }
    
    const userId = getUserId();
    
    if (!userId || !messageId) {
        showToast('Error deleting message', 'error');
        return;
    }
    
    firebase.firestore().collection('messages').doc(messageId).delete()
        .then(() => {
            // Reload inbox to reflect changes
            loadInboxMessages();
            
            showToast('Message deleted', 'success');
        })
        .catch(error => {
            console.error('Error deleting message:', error);
            showToast('Failed to delete message', 'error');
        });
}

// Load transaction history from Firebase
function loadTransactionHistory() {
    const transactionsContainer = document.getElementById('transactionsContainer');
    const emptyTransactions = document.getElementById('emptyTransactions');
    const pageIndicator = document.getElementById('pageIndicator');
    
    if (!transactionsContainer || !emptyTransactions) return;
    
    // Show loading state
    transactionsContainer.innerHTML = '<div class="loading-spinner"></div>';
    transactionsContainer.style.display = 'block';
    emptyTransactions.style.display = 'none';
    
    // Get user ID
    const userId = getUserId();
    
    if (!userId) {
        transactionsContainer.innerHTML = '<div class="error-message">Authentication error. Please log in again.</div>';
        return;
    }
    
    // Create query
    let query = firebase.firestore().collection('transactions')
        .where('userId', '==', userId);
    
    // Apply type filter
    if (currentFilter !== 'all') {
        query = query.where('type', '==', currentFilter);
    }
    
    // Get total count for pagination
    query.get()
        .then(snapshot => {
            let filteredDocs = snapshot.docs;
            
            // Apply date filters in memory (Firestore can't filter on multiple fields)
            if (startDateFilter || endDateFilter) {
                filteredDocs = filteredDocs.filter(doc => {
                    const data = doc.data();
                    const txDate = data.timestamp ? new Date(data.timestamp.toDate()) : new Date();
                    
                    if (startDateFilter && endDateFilter) {
                        return txDate >= startDateFilter && txDate <= endDateFilter;
                    } else if (startDateFilter) {
                        return txDate >= startDateFilter;
                    } else if (endDateFilter) {
                        return txDate <= endDateFilter;
                    }
                    
                    return true;
                });
            }
            
            // Calculate pagination
            totalPages = Math.max(1, Math.ceil(filteredDocs.length / pageSize));
            
            // Adjust current page if needed
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            
            // Update page indicator
            if (pageIndicator) {
                pageIndicator.textContent = `Page ${currentPage} of ${totalPages}`;
            }
            
            // Enable/disable pagination buttons
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            
            if (prevPageBtn) {
                prevPageBtn.disabled = currentPage <= 1;
            }
            
            if (nextPageBtn) {
                nextPageBtn.disabled = currentPage >= totalPages;
            }
            
            // Get paginated results
            const startIndex = (currentPage - 1) * pageSize;
            const paginatedDocs = filteredDocs.slice(startIndex, startIndex + pageSize);
            
            if (paginatedDocs.length === 0) {
                transactionsContainer.style.display = 'none';
                emptyTransactions.style.display = 'flex';
                return;
            }
            
            // Sort by timestamp (most recent first)
            paginatedDocs.sort((a, b) => {
                const timestampA = a.data().timestamp ? a.data().timestamp.toDate() : new Date(0);
                const timestampB = b.data().timestamp ? b.data().timestamp.toDate() : new Date(0);
                return timestampB - timestampA;
            });
            
            let transactionsHTML = '';
            
            paginatedDocs.forEach(doc => {
                const transaction = doc.data();
                const transactionId = doc.id;
                const timestamp = transaction.timestamp 
                    ? new Date(transaction.timestamp.toDate()).toLocaleString() 
                    : 'Unknown';
                
                // Determine transaction icon and status class
                let icon, statusClass, statusText;
                
                switch (transaction.type) {
                    case 'buy':
                        icon = 'fa-shopping-cart';
                        statusClass = getStatusClass(transaction.status);
                        statusText = transaction.status || 'Processing';
                        break;
                    case 'send':
                        icon = 'fa-paper-plane';
                        statusClass = 'completed';
                        statusText = 'Sent';
                        break;
                    case 'receive':
                        icon = 'fa-download';
                        statusClass = 'completed';
                        statusText = 'Received';
                        break;
                    case 'reward':
                        icon = 'fa-gift';
                        statusClass = 'completed';
                        statusText = 'Rewarded';
                        break;
                    default:
                        icon = 'fa-exchange-alt';
                        statusClass = 'pending';
                        statusText = 'Unknown';
                }
                
                // Format transaction details based on type
                let transactionDetails = '';
                
                if (transaction.type === 'buy') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Naira Amount:</span>
                            <span class="detail-value">${transaction.nairaAmount || (transaction.amount * 10)}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Reference:</span>
                            <span class="detail-value">${transaction.transferReference || 'N/A'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'send') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Recipient:</span>
                            <span class="detail-value">${transaction.recipientUsername || 'Unknown User'}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Note:</span>
                            <span class="detail-value">${transaction.note || 'No note'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'receive') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">From:</span>
                            <span class="detail-value">${transaction.senderUsername || 'Unknown User'}</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Note:</span>
                            <span class="detail-value">${transaction.note || 'No note'}</span>
                        </div>
                    `;
                } else if (transaction.type === 'reward') {
                    transactionDetails = `
                        <div class="transaction-detail">
                            <span class="detail-label">Amount:</span>
                            <span class="detail-value">${transaction.amount} Talent Coins</span>
                        </div>
                        <div class="transaction-detail">
                            <span class="detail-label">Reason:</span>
                            <span class="detail-value">${transaction.reason || 'Platform reward'}</span>
                        </div>
                    `;
                }
                
                transactionsHTML += `
                    <div class="transaction-card" data-id="${transactionId}">
                        <div class="transaction-icon">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div class="transaction-content">
                            <div class="transaction-header">
                                <div class="transaction-title">
                                    ${getTransactionTitle(transaction)}
                                </div>
                                <div class="transaction-date">${timestamp}</div>
                            </div>
                            <div class="transaction-details">
                                ${transactionDetails}
                            </div>
                            <div class="transaction-status ${statusClass}">
                                ${statusText}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            transactionsContainer.innerHTML = transactionsHTML;
            transactionsContainer.style.display = 'block';
            emptyTransactions.style.display = 'none';
        })
        .catch(error => {
            console.error('Error loading transaction history:', error);
            transactionsContainer.innerHTML = '<div class="error-message">Failed to load transactions. Please try again.</div>';
        });
}

// Helper function to get transaction title based on type
function getTransactionTitle(transaction) {
    switch (transaction.type) {
        case 'buy':
            return 'Purchased Talent Coins';
        case 'send':
            return `Sent Coins to ${transaction.recipientUsername || 'User'}`;
        case 'receive':
            return `Received Coins from ${transaction.senderUsername || 'User'}`;
        case 'reward':
            return 'Platform Reward';
        default:
            return 'Transaction';
    }
}

// Helper function to get status class for styling
function getStatusClass(status) {
    switch (status) {
        case 'completed':
        case 'approved':
            return 'completed';
        case 'pending':
            return 'pending';
        case 'rejected':
        case 'failed':
            return 'rejected';
        default:
            return 'pending';
    }
}

// Helper function to get current user ID
function getUserId() {
    const user = firebase.auth().currentUser;
    return user ? user.uid : null;
}

// Helper function to check if user is logged in
function isUserLoggedIn() {
    return !!firebase.auth().currentUser;
}

// Helper function to show toast notifications
function showToast(message, type = 'info') {
    // Check if toast container exists, if not create it
    let toastContainer = document.querySelector('.toast-container');
    
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${getToastIcon(type)}"></i>
            <span>${message}</span>
        </div>
        <div class="toast-progress"></div>
    `;
    
    // Add toast to container
    toastContainer.appendChild(toast);
    
    // Trigger animation
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    // Remove toast after 3 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

// Helper function to get toast icon based on type
function getToastIcon(type) {
    switch (type) {
        case 'success':
            return 'fa-check-circle';
        case 'error':
            return 'fa-exclamation-circle';
        case 'warning':
            return 'fa-exclamation-triangle';
        default:
            return 'fa-info-circle';
    }
}

// Talent Coin Dispenser functionality
document.addEventListener('DOMContentLoaded', function() {
    // Get references to elements
    const talentCoinDispenserBtn = document.getElementById('talentCoinDispenserBtn');
    const talentCoinDispenserSection = document.getElementById('talentCoinDispenser');
    const dashboardSection = document.getElementById('dashboard');
    const backBtn = talentCoinDispenserSection.querySelector('.back-btn');
    const walletIdInput = document.getElementById('walletId');
    const refreshUserInfoBtn = document.getElementById('refreshUserInfo');
    const userInfoContent = document.getElementById('userInfoContent');
    const userInfoDetails = document.getElementById('userInfoDetails');
    const transactionReasonSelect = document.getElementById('transactionReason');
    const otherReasonGroup = document.getElementById('otherReasonGroup');
    const processTransactionBtn = document.getElementById('processTransactionBtn');
    const userTransactionList = document.getElementById('userTransactionList');
    
    // Add event listener to the Talent Coin Dispenser button
    if (talentCoinDispenserBtn) {
        talentCoinDispenserBtn.addEventListener('click', function() {
            // Hide dashboard and show dispenser section
            if (dashboardSection) dashboardSection.classList.add('hidden');
            talentCoinDispenserSection.classList.remove('hidden');
            
            // Reset form
            resetDispenserForm();
        });
    }
    
    // Add event listener to the back button
    if (backBtn) {
        backBtn.addEventListener('click', function() {
            // Hide dispenser section and show dashboard
            talentCoinDispenserSection.classList.add('hidden');
            if (dashboardSection) dashboardSection.classList.remove('hidden');
        });
    }
    
    // Add event listener to the wallet ID input for lookup
    if (walletIdInput) {
        walletIdInput.addEventListener('blur', function() {
            if (walletIdInput.value.trim() !== '') {
                fetchUserInfo(walletIdInput.value.trim());
            }
        });
        
        // Also allow pressing Enter to search
        walletIdInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && walletIdInput.value.trim() !== '') {
                fetchUserInfo(walletIdInput.value.trim());
            }
        });
    }
    
    // Add event listener to the refresh button
    if (refreshUserInfoBtn) {
        refreshUserInfoBtn.addEventListener('click', function() {
            if (walletIdInput.value.trim() !== '') {
                fetchUserInfo(walletIdInput.value.trim());
            }
        });
    }
    
    // Add event listener to the transaction reason select
    if (transactionReasonSelect) {
        transactionReasonSelect.addEventListener('change', function() {
            if (this.value === 'other') {
                otherReasonGroup.style.display = 'block';
            } else {
                otherReasonGroup.style.display = 'none';
            }
        });
    }
    
    // Add event listener to the process transaction button
    if (processTransactionBtn) {
        processTransactionBtn.addEventListener('click', function() {
            processTransaction();
        });
    }
    
    // Function to fetch user information
    function fetchUserInfo(walletId) {
        // Show loading state
        userInfoContent.innerHTML = '<div class="loading-spinner"></div>';
        userInfoDetails.classList.add('hidden');
        userTransactionList.innerHTML = '<div class="loading-spinner"></div>';
        
        // Check if admin is logged in
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            showToast('You must be logged in as an admin to perform this action', 'error');
            return;
        }
        
        // First, check if the current user is an admin
        firebase.firestore().collection('admins').doc(currentUser.uid)
            .get()
            .then(adminDoc => {
                if (!adminDoc.exists) {
                    throw new Error('Unauthorized access. Admin privileges required.');
                }
                
                // Now fetch the user by wallet ID
                return firebase.firestore().collection('users')
                    .where('walletId', '==', walletId)
                    .limit(1)
                    .get();
            })
            .then(snapshot => {
                if (snapshot.empty) {
                    userInfoContent.innerHTML = `
                        <div class="empty-state error">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>No user found with wallet ID: ${walletId}</p>
                        </div>
                    `;
                    userTransactionList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>No transactions to display</p>
                        </div>
                    `;
                    return;
                }
                
                // Get user data
                const userData = snapshot.docs[0].data();
                const userId = snapshot.docs[0].id;
                
                // Update user info display
                document.getElementById('userUsername').textContent = userData.username || 'N/A';
                document.getElementById('userWalletId').textContent = userData.walletId || 'N/A';
                document.getElementById('userBalance').textContent = 
                    `${userData.balance || 0} Talent Coins`;
                document.getElementById('userCommission').textContent = 
                    `${userData.commissionBalance || 0} Talent Coins`;
                
                // Set status with appropriate class
                const userStatusElement = document.getElementById('userStatus');
                userStatusElement.textContent = userData.status || 'Active';
                userStatusElement.className = 'info-value status-badge';
                userStatusElement.classList.add(userData.status === 'Suspended' ? 'status-suspended' : 'status-active');
                
                // Hide loading content and show details
                userInfoContent.style.display = 'none';
                userInfoDetails.classList.remove('hidden');
                
                // Fetch recent transactions
                return firebase.firestore().collection('transactions')
                    .where('userId', '==', userId)
                    .orderBy('timestamp', 'desc')
                    .limit(5)
                    .get();
            })
            .then(transactionSnapshot => {
                if (!transactionSnapshot || transactionSnapshot.empty) {
                    userTransactionList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>No transactions to display</p>
                        </div>
                    `;
                    
                    // Update last transaction field
                    document.getElementById('userLastTransaction').textContent = 'No transactions';
                    return;
                }
                
                let transactionsHTML = '';
                let firstTransaction = true;
                
                transactionSnapshot.forEach(doc => {
                    const transaction = doc.data();
                    const timestamp = transaction.timestamp 
                        ? new Date(transaction.timestamp.toDate()).toLocaleString()
                        : 'Unknown';
                    
                    // Update last transaction field with the most recent one
                    if (firstTransaction) {
                        document.getElementById('userLastTransaction').textContent = 
                            `${getTransactionTypeText(transaction.type)} - ${timestamp}`;
                        firstTransaction = false;
                    }
                    
                    // Add transaction to the list
                    transactionsHTML += `
                        <div class="transaction-item">
                            <div class="transaction-icon ${getTransactionTypeClass(transaction.type)}">
                                <i class="fas ${getTransactionTypeIcon(transaction.type)}"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">
                                    ${getTransactionTypeText(transaction.type)}
                                </div>
                                <div class="transaction-amount">
                                    ${transaction.type === 'debit' ? '-' : '+'} ${transaction.amount} Talent Coins
                                </div>
                                <div class="transaction-date">${timestamp}</div>
                            </div>
                        </div>
                    `;
                });
                
                userTransactionList.innerHTML = transactionsHTML;
            })
            .catch(error => {
                console.error('Error fetching user info:', error);
                userInfoContent.innerHTML = `
                    <div class="empty-state error">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
                userTransactionList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No transactions to display</p>
                    </div>
                `;
            });
    }
    
    // Function to process the transaction
    function processTransaction() {
        // Get form values
        const walletId = document.getElementById('walletId').value.trim();
        const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
        const coinAmount = parseFloat(document.getElementById('coinAmount').value);
        const transactionReason = document.getElementById('transactionReason').value;
        const otherReason = document.getElementById('otherReason').value.trim();
        const transactionNotes = document.getElementById('transactionNotes').value.trim();
        
        // Validate inputs
        if (!walletId) {
            showToast('Please enter a wallet ID', 'error');
            return;
        }
        
        if (isNaN(coinAmount) || coinAmount <= 0) {
            showToast('Please enter a valid amount greater than 0', 'error');
            return;
        }
        
        if (!transactionReason) {
            showToast('Please select a transaction reason', 'error');
            return;
        }
        
        if (transactionReason === 'other' && !otherReason) {
            showToast('Please specify the reason for this transaction', 'error');
            return;
        }
        
        // Confirm transaction
        const confirmMessage = `Are you sure you want to ${transactionType === 'credit' ? 'add' : 'remove'} ${coinAmount} Talent Coins ${transactionType === 'credit' ? 'to' : 'from'} this user's wallet?`;
        if (!confirm(confirmMessage)) {
            return;
        }
        
        // Show loading state
        processTransactionBtn.disabled = true;
        processTransactionBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        // Check if admin is logged in
        const currentUser = firebase.auth().currentUser;
        if (!currentUser) {
            showToast('You must be logged in as an admin to perform this action', 'error');
            processTransactionBtn.disabled = false;
            processTransactionBtn.textContent = 'Process Transaction';
            return;
        }
        
        // First, check if the current user is an admin
        firebase.firestore().collection('admins').doc(currentUser.uid)
            .get()
            .then(adminDoc => {
                if (!adminDoc.exists) {
                    throw new Error('Unauthorized access. Admin privileges required.');
                }
                
                // Now fetch the user by wallet ID
                return firebase.firestore().collection('users')
                    .where('walletId', '==', walletId)
                    .limit(1)
                    .get();
            })
            .then(snapshot => {
                if (snapshot.empty) {
                    throw new Error(`No user found with wallet ID: ${walletId}`);
                }
                
                // Get user data
                const userData = snapshot.docs[0].data();
                const userId = snapshot.docs[0].id;
                const currentBalance = userData.balance || 0;
                
                // Check if debit would result in negative balance
                if (transactionType === 'debit' && coinAmount > currentBalance) {
                    throw new Error('Insufficient balance for debit transaction');
                }
                
                // Calculate new balance
                const newBalance = transactionType === 'credit' 
                    ? currentBalance + coinAmount 
                    : currentBalance - coinAmount;
                
                // Create transaction record
                const transactionData = {
                    userId: userId,
                    type: transactionType,
                    amount: coinAmount,
                    reason: transactionReason === 'other' ? otherReason : transactionReason,
                    notes: transactionNotes,
                    adminId: currentUser.uid,
                    adminName: adminDoc.data().name || 'Admin',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    previousBalance: currentBalance,
                    newBalance: newBalance
                };
                
                // Start a batch write
                const batch = firebase.firestore().batch();
                
                // Update user balance
                const userRef = firebase.firestore().collection('users').doc(userId);
                batch.update(userRef, { balance: newBalance });
                
                // Create transaction record
                const transactionRef = firebase.firestore().collection('transactions').doc();
                batch.set(transactionRef, transactionData);
                
                // Create admin log
                const adminLogRef = firebase.firestore().collection('adminLogs').doc();
                batch.set(adminLogRef, {
                    adminId: currentUser.uid,
                    adminName: adminDoc.data().name || 'Admin',
                    action: `${transactionType === 'credit' ? 'Credited' : 'Debited'} ${coinAmount} Talent Coins ${transactionType === 'credit' ? 'to' : 'from'} user ${userData.username || userId}`,
                    details: {
                        userId: userId,
                        username: userData.username,
                        walletId: walletId,
                        transactionType: transactionType,
                        amount: coinAmount,
                        reason: transactionReason === 'other' ? otherReason : transactionReason,
                        notes: transactionNotes
                    },
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Create notification for user
                const notificationRef = firebase.firestore().collection('messages').doc();
                batch.set(notificationRef, {
                    userId: userId,
                    title: `Wallet ${transactionType === 'credit' ? 'Credit' : 'Debit'} Notification`,
                    content: `Your wallet has been ${transactionType === 'credit' ? 'credited with' : 'debited'} ${coinAmount} Talent Coins. Reason: ${transactionReason === 'other' ? otherReason : getReasonText(transactionReason)}. ${transactionNotes ? `Note: ${transactionNotes}` : ''}`,
                    read: false,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Commit the batch
                return batch.commit();
            })
            .then(() => {
                // Show success message
                showToast(`Successfully ${transactionType === 'credit' ? 'credited' : 'debited'} ${coinAmount} Talent Coins`, 'success');
                
                // Reset form
                resetDispenserForm();
                
                // Refresh user info
                fetchUserInfo(walletId);
            })
            .catch(error => {
                console.error('Error processing transaction:', error);
                showToast(`Error: ${error.message}`, 'error');
            })
            .finally(() => {
                // Reset button state
                processTransactionBtn.disabled = false;
                processTransactionBtn.textContent = 'Process Transaction';
            });
    }
        // Helper function to reset the dispenser form
    function resetDispenserForm() {
        // Don't clear the wallet ID if it's already filled
        document.querySelector('input[name="transactionType"][value="credit"]').checked = true;
        document.getElementById('coinAmount').value = '';
        document.getElementById('transactionReason').value = '';
        document.getElementById('otherReason').value = '';
        document.getElementById('transactionNotes').value = '';
        otherReasonGroup.style.display = 'none';
    }
    
    // Helper function to get transaction type text
    function getTransactionTypeText(type) {
        switch (type) {
            case 'buy':
                return 'Purchase';
            case 'send':
                return 'Sent';
            case 'receive':
                return 'Received';
            case 'credit':
                return 'Admin Credit';
            case 'debit':
                return 'Admin Debit';
            case 'reward':
                return 'Reward';
            default:
                return 'Transaction';
        }
    }
    
    // Helper function to get transaction type icon
    function getTransactionTypeIcon(type) {
        switch (type) {
            case 'buy':
                return 'fa-shopping-cart';
            case 'send':
                return 'fa-paper-plane';
            case 'receive':
                return 'fa-download';
            case 'credit':
                return 'fa-plus-circle';
            case 'debit':
                return 'fa-minus-circle';
            case 'reward':
                return 'fa-gift';
            default:
                return 'fa-exchange-alt';
        }
    }
    
    // Helper function to get transaction type class for styling
    function getTransactionTypeClass(type) {
        switch (type) {
            case 'buy':
                return 'transaction-buy';
            case 'send':
                return 'transaction-send';
            case 'receive':
                return 'transaction-receive';
            case 'credit':
                return 'transaction-credit';
            case 'debit':
                return 'transaction-debit';
            case 'reward':
                return 'transaction-reward';
            default:
                return '';
        }
    }
    
    // Helper function to get reason text
    function getReasonText(reason) {
        switch (reason) {
            case 'buy':
                return 'Buy Coin Verification';
            case 'withdraw':
                return 'Withdrawal Processing';
            case 'refund':
                return 'Refund';
            case 'bonus':
                return 'Bonus';
            case 'correction':
                return 'Balance Correction';
            default:
                return reason;
        }
    }
    
    // Helper function to show toast notifications
    function showToast(message, type = 'info') {
        // Check if toast container exists, if not create it
        let toastContainer = document.querySelector('.toast-container');
        
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas ${getToastIcon(type)}"></i>
                <span>${message}</span>
            </div>
            <div class="toast-progress"></div>
        `;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Trigger animation
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
    
    // Helper function to get toast icon based on type
    function getToastIcon(type) {
        switch (type) {
            case 'success':
                return 'fa-check-circle';
            case 'error':
                return 'fa-exclamation-circle';
            case 'warning':
                return 'fa-exclamation-triangle';
            default:
                return 'fa-info-circle';
        }
    }
});

// Initialize Talent Coin Dispenser functionality
document.addEventListener('DOMContentLoaded', function() {
    // Get DOM elements
    const walletIdInput = document.getElementById('walletId');
    const coinAmountInput = document.getElementById('coinAmount');
    const transactionReasonSelect = document.getElementById('transactionReason');
    const otherReasonGroup = document.getElementById('otherReasonGroup');
    const otherReasonInput = document.getElementById('otherReason');
    const transactionNotesTextarea = document.getElementById('transactionNotes');
    const dispenseBtn = document.getElementById('dispenseBtn');
    const refreshUserInfoBtn = document.getElementById('refreshUserInfo');
    
    // User info elements
    const userInfoUsername = document.getElementById('userInfoUsername');
    const userInfoWalletId = document.getElementById('userInfoWalletId');
    const userInfoBalance = document.getElementById('userInfoBalance');
    const userInfoStatus = document.getElementById('userInfoStatus');
    const userTransactionsList = document.getElementById('userTransactionsList');
    
    // Current user data
    let currentUserData = null;
    
    // Show/hide other reason input based on reason selection
    transactionReasonSelect.addEventListener('change', function() {
        otherReasonGroup.style.display = this.value === 'other' ? 'block' : 'none';
    });
    
    // Wallet ID input event - lookup user when ID is entered
    walletIdInput.addEventListener('input', debounce(function() {
        const walletId = walletIdInput.value.trim();
        if (walletId.length >= 6) {
            lookupUserByWalletId(walletId);
        } else {
            resetUserInfo();
        }
    }, 500));
    
    // Refresh user info button click
    refreshUserInfoBtn.addEventListener('click', function() {
        const walletId = walletIdInput.value.trim();
        if (walletId) {
            lookupUserByWalletId(walletId);
            this.classList.add('rotating');
            setTimeout(() => {
                this.classList.remove('rotating');
            }, 1000);
        } else {
            showToast('Please enter a wallet ID first', 'warning');
        }
    });
    
    // Process transaction button click
    dispenseBtn.addEventListener('click', function() {
        processTransaction();
    });
    
    // Function to lookup user by wallet ID - MODIFIED TO USE ADMIN CALLABLE FUNCTION
    function lookupUserByWalletId(walletId) {
        // Show loading state
        setUserInfoLoading(true);
        
        // Check if user is authenticated
        if (!firebase.auth().currentUser) {
            showToast('You must be logged in to perform this action', 'error');
            setUserInfoLoading(false);
            return;
        }
        
        // Use a different approach - get all users and filter client-side
        // This is a workaround for permission issues
        firebase.firestore().collection('users')
            .get()
            .then(snapshot => {
                let foundUser = null;
                
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    if (userData.walletId === walletId) {
                        foundUser = { ...userData, id: doc.id };
                    }
                });
                
                if (!foundUser) {
                    showToast('User not found with this wallet ID', 'error');
                    resetUserInfo();
                    return;
                }
                
                // Set current user data
                currentUserData = foundUser;
                
                // Update user info display
                updateUserInfoDisplay(currentUserData);
                
                // Load user's recent transactions
                loadUserTransactions(currentUserData.id);
            })
            .catch(error => {
                console.error('Error looking up user:', error);
                showToast('Error looking up user: ' + error.message, 'error');
                resetUserInfo();
            })
            .finally(() => {
                setUserInfoLoading(false);
            });
    }
    
    // Function to load user's recent transactions - MODIFIED FOR PERMISSIONS
    function loadUserTransactions(userId) {
        userTransactionsList.innerHTML = '<div class="loading-spinner"></div>';
        
        firebase.firestore().collection('transactions')
            .get()
            .then(snapshot => {
                // Filter transactions client-side
                const userTransactions = [];
                
                snapshot.forEach(doc => {
                    const transaction = doc.data();
                    if (transaction.userId === userId) {
                        userTransactions.push({
                            id: doc.id,
                            ...transaction
                        });
                    }
                });
                
                // Sort by timestamp descending
                userTransactions.sort((a, b) => {
                    const timeA = a.timestamp ? a.timestamp.toDate().getTime() : 0;
                    const timeB = b.timestamp ? b.timestamp.toDate().getTime() : 0;
                    return timeB - timeA;
                });
                
                // Limit to 5 most recent
                const recentTransactions = userTransactions.slice(0, 5);
                
                if (recentTransactions.length === 0) {
                    userTransactionsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exchange-alt"></i>
                            <p>No transactions available</p>
                        </div>
                    `;
                    return;
                }
                
                let transactionsHTML = '';
                
                recentTransactions.forEach(transaction => {
                    const timestamp = transaction.timestamp 
                        ? new Date(transaction.timestamp.toDate()).toLocaleString() 
                        : 'Unknown';
                    
                    // Determine transaction icon and class based on type
                    let icon, transactionClass, amountPrefix;
                    
                    switch (transaction.type) {
                        case 'credit':
                        case 'receive':
                        case 'reward':
                        case 'bonus':
                            icon = 'fa-arrow-down';
                            transactionClass = 'transaction-credit';
                            amountPrefix = '+';
                            break;
                        case 'debit':
                        case 'send':
                        case 'withdraw':
                            icon = 'fa-arrow-up';
                            transactionClass = 'transaction-debit';
                            amountPrefix = '-';
                            break;
                        default:
                            icon = 'fa-exchange-alt';
                            transactionClass = '';
                            amountPrefix = '';
                    }
                    
                    transactionsHTML += `
                        <div class="transaction-item ${transactionClass}">
                            <div class="transaction-icon">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">
                                    ${transaction.reason || transaction.type || 'Transaction'}
                                </div>
                                <div class="transaction-date">${timestamp}</div>
                            </div>
                            <div class="transaction-amount">
                                ${amountPrefix}${transaction.amount} TC
                            </div>
                        </div>
                    `;
                });
                
                userTransactionsList.innerHTML = transactionsHTML;
            })
            .catch(error => {
                console.error('Error loading transactions:', error);
                userTransactionsList.innerHTML = `
                    <div class="error-message">
                        Failed to load transactions: ${error.message}
                    </div>
                `;
            });
    }
    
    // Function to process transaction - MODIFIED FOR PERMISSIONS
    function processTransaction() {
        // Validate inputs
        const walletId = walletIdInput.value.trim();
        const amount = parseFloat(coinAmountInput.value);
        const transactionType = document.querySelector('input[name="transactionType"]:checked').value;
        const reason = transactionReasonSelect.value;
        const otherReason = otherReasonInput.value.trim();
        const notes = transactionNotesTextarea.value.trim();
        
        // Check if user is found
        if (!currentUserData) {
            showToast('Please enter a valid wallet ID', 'error');
            return;
        }
        
        // Validate amount
        if (isNaN(amount) || amount <= 0) {
            showToast('Please enter a valid amount', 'error');
            return;
        }
        
        // Validate reason
        if (!reason) {
            showToast('Please select a reason', 'error');
            return;
        }
        
        // Validate other reason if selected
        if (reason === 'other' && !otherReason) {
            showToast('Please specify the reason', 'error');
            return;
        }
        
        // For debit transactions, check if user has enough balance
        if (transactionType === 'debit' && amount > currentUserData.balance) {
            showToast('User does not have enough balance for this debit', 'error');
            return;
        }
        
        // Confirm transaction
        if (!confirm(`Are you sure you want to ${transactionType} ${amount} Talent Coins ${transactionType === 'credit' ? 'to' : 'from'} ${currentUserData.username}'s account?`)) {
            return;
        }
        
        // Disable button to prevent double submission
        dispenseBtn.disabled = true;
        dispenseBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        
        // Get the final reason text
        const finalReason = reason === 'other' ? otherReason : reason;
        
        // Create transaction document
        const transactionData = {
            userId: currentUserData.id,
            walletId: currentUserData.walletId,
            type: transactionType,
            amount: amount,
            reason: finalReason,
            notes: notes,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            processedBy: firebase.auth().currentUser.uid,
            processedByEmail: firebase.auth().currentUser.email
        };
        
        // Create transaction
        firebase.firestore().collection('transactions')
            .add(transactionData)
            .then(transactionRef => {
                // Update user balance
                const newBalance = transactionType === 'credit' 
                    ? (currentUserData.balance || 0) + amount 
                    : (currentUserData.balance || 0) - amount;
                
                return firebase.firestore().collection('users').doc(currentUserData.id)
                    .update({
                        balance: newBalance,
                        lastTransactionDate: firebase.firestore.FieldValue.serverTimestamp()
                    });
            })
            .then(() => {
                // Create notification for the user
                return firebase.firestore().collection('messages').add({
                    userId: currentUserData.id,
                    title: `${transactionType === 'credit' ? 'Credit' : 'Debit'} Transaction`,
                    content: `Your account has been ${transactionType === 'credit' ? 'credited with' : 'debited'} ${amount} Talent Coins. Reason: ${finalReason}${notes ? '. Notes: ' + notes : ''}`,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    read: false
                });
            })
            .then(() => {
                showToast(`Successfully ${transactionType === 'credit' ? 'credited' : 'debited'} ${amount} Talent Coins`, 'success');
                
                // Update local user data
                currentUserData.balance = transactionType === 'credit' 
                    ? (currentUserData.balance || 0) + amount 
                    : (currentUserData.balance || 0) - amount;
                
                // Update display
                updateUserInfoDisplay(currentUserData);
                
                // Reload transactions
                loadUserTransactions(currentUserData.id);
                
                // Reset form
                coinAmountInput.value = '';
                transactionNotesTextarea.value = '';
                if (reason === 'other') {
                    otherReasonInput.value = '';
                }
                transactionReasonSelect.selectedIndex = 0;
                otherReasonGroup.style.display = 'none';
            })
            .catch(error => {
                console.error('Error processing transaction:', error);
                showToast('Error processing transaction: ' + error.message, 'error');
            })
            .finally(() => {
                // Re-enable button
                dispenseBtn.disabled = false;
                dispenseBtn.innerHTML = 'Process Transaction';
            });
    }
    
    // Function to update user info display
    function updateUserInfoDisplay(userData) {
        userInfoUsername.textContent = userData.username || 'Unknown';
        userInfoWalletId.textContent = userData.walletId || '-';
        userInfoBalance.textContent = `${userData.balance || 0} Talent Coins`;
        
        // Set status with appropriate class
        userInfoStatus.textContent = userData.status || 'Active';
        userInfoStatus.className = 'info-value';
        
        if (userData.status === 'Suspended') {
            userInfoStatus.classList.add('status-suspended');
        } else if (userData.status === 'Inactive') {
            userInfoStatus.classList.add('status-inactive');
        } else {
            userInfoStatus.classList.add('status-active');
        }
    }
    
    // Function to reset user info display
    function resetUserInfo() {
        currentUserData = null;
        userInfoUsername.textContent = '-';
        userInfoWalletId.textContent = '-';
        userInfoBalance.textContent = '-';
        userInfoStatus.textContent = '-';
        userInfoStatus.className = 'info-value';
        
        userTransactionsList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exchange-alt"></i>
                <p>No transactions available</p>
            </div>
        `;
    }
    
    // Function to set loading state for user info
    function setUserInfoLoading(isLoading) {
        if (isLoading) {
            userInfoUsername.innerHTML = '<div class="loading-shimmer"></div>';
            userInfoWalletId.innerHTML = '<div class="loading-shimmer"></div>';
            userInfoBalance.innerHTML = '<div class="loading-shimmer"></div>';
            userInfoStatus.innerHTML = '<div class="loading-shimmer"></div>';
            
            userTransactionsList.innerHTML = '<div class="loading-spinner"></div>';
        }
    }
    
    // Utility function to debounce input
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this;
            const args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                func.apply(context, args);
            }, wait);
        };
    }
    
    // Function to show toast notifications
    function showToast(message, type = 'info') {
        // Check if toast container exists, if not create it
        let toastContainer = document.querySelector('.toast-container');
        
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        // Get appropriate icon based on type
        let icon;
        switch (type) {
            case 'success':
                icon = 'fa-check-circle';
                break;
            case 'error':
                icon = 'fa-exclamation-circle';
                break;
            case 'warning':
                icon = 'fa-exclamation-triangle';
                break;
            default:
                icon = 'fa-info-circle';
        }
        
        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            </div>
            <div class="toast-progress"></div>
        `;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Trigger animation
        setTimeout(() => {
            toast.classList.add('show');
        }, 10);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
    
    // Check admin status on load
    function checkAdminStatus() {
        const user = firebase.auth().currentUser;
        if (!user) {
            showToast('You must be logged in to use this feature', 'error');
            return;
        }
        
        // Check if user is in admins collection
        firebase.firestore().collection('admins').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    showToast('You do not have admin privileges to use this feature', 'error');
                    // Optionally hide the dispenser UI
                    // document.getElementById('talentCoinDispenser').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error checking admin status:', error);
            });
    }
    
    // Call this on page load
    checkAdminStatus();
});
   

</script>
</body>
</html>
