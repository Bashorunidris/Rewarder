<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rewarder - Monetized Talent Competition</title>
    <style>
    :root {
        --primary-color: #6c5ce7;
        --primary-dark: #5549c0;
        --secondary-color: #fd79a8;
        --text-color: #2d3436;
        --light-text: #636e72;
        --background-color: #f9f9f9;
        --white: #ffffff;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
        --border-color: #dfe6e9;
        --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
    }
    
    .container {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }
    
    .split-screen {
        display: flex;
        background-color: var(--white);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: var(--box-shadow);
        width: 100%;
        max-width: 1200px;
        min-height: 600px;
    }
    
    /* Left side styling */
    .left {
        flex: 1;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: var(--white);
        padding: 60px 40px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
    }
    
    .left::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .left::after {
        content: '';
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .logo h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        letter-spacing: 1px;
    }
    
    .tagline {
        margin-top: 60px;
        z-index: 1;
    }
    
    .tagline h2 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .tagline p {
        font-size: 1.1rem;
        opacity: 0.9;
    }
    
    .features {
        margin-top: 60px;
        z-index: 1;
    }
    
    .feature {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    
    .feature i {
        font-size: 1.2rem;
        margin-right: 15px;
        background: rgba(255, 255, 255, 0.2);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .feature span {
        font-size: 1rem;
    }
    
    /* Right side styling */
    .right {
        flex: 1;
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .auth-container {
        width: 100%;
        max-width: 400px;
        transition: all 0.3s ease;
    }
    
    .auth-container.hidden {
        display: none;
    }
    
    .auth-container h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-color);
    }
    
    .auth-container > p {
        color: var(--light-text);
        margin-bottom: 30px;
    }
    
    .social-login {
        margin-bottom: 25px;
    }
    
    .social-btn {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background-color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .social-btn:hover {
        background-color: #f5f5f5;
    }
    
    .social-btn img {
        width: 20px;
        height: 20px;
        margin-right: 10px;
    }
    
    .divider {
        display: flex;
        align-items: center;
        margin: 25px 0;
    }
    
    .divider::before,
    .divider::after {
        content: '';
        flex: 1;
        height: 1px;
        background-color: var(--border-color);
    }
    
    .divider span {
        padding: 0 15px;
        color: var(--light-text);
        font-size: 0.9rem;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
        border-color: var(--primary-color);
        outline: none;
    }
    
    .password-input {
        position: relative;
    }
    
    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--light-text);
    }
    
    .password-strength {
        margin-top: 10px;
    }
    
    .strength-meter {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }
    
    .strength-segment {
        height: 4px;
        flex: 1;
        background-color: #ddd;
        border-radius: 2px;
    }
    
    .strength-segment.weak {
        background-color: var(--error-color);
    }
    
    .strength-segment.medium {
        background-color: #f39c12;
    }
    
    .strength-segment.strong {
        background-color: var(--success-color);
    }
    
    .strength-text {
        font-size: 0.8rem;
        color: var(--light-text);
    }
    
    .form-options {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        font-size: 0.9rem;
    }
    
    .remember-me,
    .terms {
        display: flex;
        align-items: center;
    }
    
    .remember-me input,
    .terms input {
        margin-right: 8px;
    }
    
    .forgot-password,
    .terms a {
        color: var(--primary-color);
        text-decoration: none;
    }
    
    .forgot-password:hover,
    .terms a:hover {
        text-decoration: underline;
    }
    
    .auth-btn {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .auth-btn:hover {
        background-color: var(--primary-dark);
    }
    
    .auth-switch {
        text-align: center;
        margin-top: 25px;
        font-size: 0.9rem;
    }
    
    .auth-switch a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
    }
    
    .auth-switch a:hover {
        text-decoration: underline;
    }
    
    /* Error message styling */
    .error-message {
        color: var(--error-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .error-message.visible {
        display: block;
    }
    
    /* Success message styling */
    .success-message {
        color: var(--success-color);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
    }
    
    .success-message.visible {
        display: block;
    }
    
    /* Loading indicator */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--white);
        animation: spin 0.8s linear infinite;
        margin-left: 10px;
    }
    
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }
    
    .auth-btn.loading {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    /* Toast notification */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: var(--white);
        font-size: 0.9rem;
        max-width: 300px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
    }
    
    .toast.success {
        background-color: var(--success-color);
    }
    
    .toast.error {
        background-color: var(--error-color);
    }
    
    .toast.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    /* Responsive styles */
    @media (max-width: 992px) {
        .split-screen {
            flex-direction: column;
            max-width: 600px;
        }
        
        .left {
            padding: 40px 30px;
            min-height: 300px;
        }
        
        .tagline {
            margin-top: 30px;
        }
        
        .features {
            margin-top: 30px;
        }
        
        .right {
            padding: 30px;
        }
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 10px;
        }
        
        .split-screen {
            border-radius: 15px;
        }
        
        .left {
            padding: 30px 20px;
            min-height: 250px;
        }
        
        .logo h1 {
            font-size: 2rem;
        }
        
        .tagline h2 {
            font-size: 1.5rem;
        }
        
        .tagline p {
            font-size: 1rem;
        }
        
        .feature i {
            width: 35px;
            height: 35px;
            font-size: 1rem;
        }
        
        .feature span {
            font-size: 0.9rem;
        }
        
        .auth-container h2 {
            font-size: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        .split-screen {
            border-radius: 10px;
        }
        
        .left {
            padding: 25px 15px;
            min-height: 200px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .tagline {
            margin-top: 20px;
        }
        
        .tagline h2 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .tagline p {
            font-size: 0.9rem;
        }
        
        .features {
            margin-top: 20px;
        }
        
        .feature {
            margin-bottom: 15px;
        }
        
        .feature i {
            width: 30px;
            height: 30px;
            font-size: 0.9rem;
            margin-right: 10px;
        }
        
        .feature span {
            font-size: 0.85rem;
        }
        
        .right {
            padding: 25px 15px;
        }
        
        .auth-container h2 {
            font-size: 1.4rem;
        }
        
        .auth-container > p {
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            font-size: 0.85rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 10px 12px;
            font-size: 0.9rem;
        }
        
        .form-options {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .auth-btn {
            padding: 12px;
        }
        
        .social-btn span {
            font-size: 0.9rem;
        }
        
        .divider span {
            font-size: 0.8rem;
        }
    }
    
    /* iOS specific adjustments */
    @supports (-webkit-touch-callout: none) {
        input, select {
            font-size: 16px !important; /* Prevents zoom on focus in iOS */
        }
        
        .form-group input,
        .form-group select {
            -webkit-appearance: none; /* Removes default styling */
            border-radius: 8px;
        }
        
        .auth-btn {
            -webkit-appearance: none;
        }
    }
    
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
        :root {
            --background-color: #1a1a2e;
            --text-color: #e6e6e6;
            --light-text: #a7a7a7;
            --white: #222236;
            --border-color: #393954;
        }
        
        .social-btn {
            background-color: #2a2a42;
            border-color: #393954;
        }
        
        .social-btn:hover {
            background-color: #33334d;
        }
        
        .strength-segment {
            background-color: #444;
        }
        
        .form-group input,
        .form-group select {
            background-color: #2a2a42;
            color: var(--text-color);
        }
        
        .form-group input::placeholder,
        .form-group select::placeholder {
            color: #777;
        }
    }
    
    /* Animations */
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .auth-container {
        animation: fadeIn 0.5s ease forwards;
    }
    
    /* Accessibility improvements */
    .auth-btn:focus,
    .social-btn:focus,
    input:focus,
    select:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    /* Dashboard Styles - Fixed for vertical overflow issues */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
    position: relative;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
}

.dashboard-page {
    display: none;
    flex-direction: column;
    height: 100vh; /* Use viewport height instead of min-height */
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    position: fixed; /* Fix the position to prevent page movement */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--background-color);
}

.dashboard-page.active {
    display: flex;
}

/* Top Navigation Bar */
.dashboard-nav {
    background-color: var(--white);
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: relative; /* Changed from sticky to relative */
    width: 100%;
    z-index: 100;
    flex-shrink: 0; /* Prevent shrinking */
    height: 56px; /* Fixed height */
}

.user-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.profile-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid var(--primary-color);
    flex-shrink: 0;
}

.profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.username {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-color);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100px;
}

.trophy-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: var(--primary-color);
    color: var(--white);
    padding: 6px 15px;
    border-radius: 50px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(108, 92, 231, 0.2);
    font-size: 0.9rem;
    white-space: nowrap;
}

.trophy-btn:hover {
    background-color: var(--primary-dark);
}

.trophy-btn i {
    font-size: 0.9rem;
}

.hamburger-menu {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.hamburger-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.hamburger-menu i {
    font-size: 1.2rem;
    color: var(--text-color);
}

/* Main Dashboard Container */
.dashboard-container {
    flex: 1;
    padding: 15px;
    width: 100%;
    overflow-y: auto; /* Allow vertical scrolling within container */
    -webkit-overflow-scrolling: touch;
}

/* Action Buttons - Single Row */
.action-buttons-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    padding-bottom: 5px;
    flex-shrink: 0; /* Prevent shrinking */
}

.action-buttons-row::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
}

.action-btn {
    background-color: var(--white);
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
}

.action-btn:active {
    transform: scale(0.95);
}

.action-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
}

/* Spinning animation for spin icon */
.spin-icon {
    position: relative;
    overflow: hidden;
}

.spin-icon i {
    animation: spin 5s linear infinite;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.spin-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    border: 2px dashed var(--success-color);
    animation: spin-reverse 10s linear infinite;
}

@keyframes spin-reverse {
    0% {
        transform: rotate(360deg);
    }
    100% {
        transform: rotate(0deg);
    }
}

.wallet-btn .action-icon {
    background-color: rgba(108, 92, 231, 0.1);
    color: var(--primary-color);
}

.creator-btn .action-icon {
    background-color: rgba(253, 121, 168, 0.1);
    color: var(--secondary-color);
}

.spin-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: var(--success-color);
}

.notification-btn .action-icon {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
}

.action-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: var(--text-color);
    text-align: center;
    white-space: nowrap;
}

/* Fix for page transition */
.container {
    position: relative;
}

.split-screen.hidden {
    display: none;
}

/* Responsive Styles for Dashboard */
@media (max-width: 360px) {
    .dashboard-nav {
        padding: 8px 10px;
        height: 50px;
    }
    
    .profile-circle {
        width: 32px;
        height: 32px;
    }
    
    .username {
        font-size: 0.85rem;
        max-width: 80px;
    }
    
    .trophy-btn {
        padding: 5px 10px;
        font-size: 0.8rem;
    }
    
    .trophy-btn i {
        font-size: 0.8rem;
    }
    
    .hamburger-menu {
        width: 32px;
        height: 32px;
    }
    
    .hamburger-menu i {
        font-size: 1.1rem;
    }
    
    .action-buttons-row {
        gap: 8px;
    }
    
    .action-btn {
        min-width: 60px;
        padding: 8px;
    }
    
    .action-icon {
        width: 35px;
        height: 35px;
        font-size: 1rem;
    }
    
    .action-btn span {
        font-size: 0.75rem;
    }
}

/* iPhone X and newer notch fixes */
@supports (padding: max(0px)) {
    .dashboard-nav {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-top: max(10px, env(safe-area-inset-top));
    }
    
    .dashboard-container {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-bottom: max(15px, env(safe-area-inset-bottom));
    }
}

/* Fix for very small screens */
@media (max-width: 320px) {
    .action-buttons-row {
        justify-content: flex-start;
    }
    
    .action-btn {
        min-width: 55px;
    }
    
    .action-icon {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
    }
    
    .action-btn span {
        font-size: 0.7rem;
    }
    
    .trophy-btn span {
        display: none;
    }
    
    .trophy-btn {
        width: 32px;
        height: 32px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .trophy-btn i {
        margin: 0;
    }
}


/* Profile Modal Responsive Styles */

/* Base modal styles */
.profile-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
}

.profile-modal.active {
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.profile-modal-content {
    background-color: #fff;
    width: 90%;
    max-width: 500px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    animation: modalFadeIn 0.3s ease;
    padding: 0;
    position: relative;
}

/* Modal header */
.profile-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #eee;
    background-color: #f8f9fa;
}

.profile-modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: #333;
    font-weight: 600;
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 0;
    line-height: 1;
}

/* Emoji Avatar Section */
.emoji-avatar-wrapper {
    position: relative;
    cursor: pointer;
    width: 90px;
    height: 90px;
    margin: 20px auto;
}

.current-emoji-avatar {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 45px;
    background-color: #f0f0f0;
    border-radius: 50%;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.current-emoji-avatar:hover, .current-emoji-avatar:active {
    background-color: #e0e0e0;
    transform: scale(1.05);
}

.emoji-selector {
    position: absolute;
    top: 110%;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    padding: 12px;
    display: none;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    z-index: 10;
    width: 200px;
    max-width: 90vw;
}

.emoji-selector.active {
    display: grid;
    animation: fadeIn 0.2s ease-in-out;
}

.emoji-option {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.2s ease;
    background-color: #f8f8f8;
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.emoji-option:hover, .emoji-option:active {
    background-color: #f0f0f0;
    transform: scale(1.1);
}

/* Form styles */
#profileForm, #changePasswordForm {
    padding: 0 20px 20px;
}

.form-group {
    margin-bottom: 16px;
}

.form-group label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    color: #0c0000;
    font-size: 0.9rem;
}

.form-group input, 
.form-group select, 
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px; /* Prevent zoom on iOS */
    background-color: #f7f4f4;
    transition: border-color 0.3s;
    box-sizing: border-box;
    -webkit-appearance: none; /* Remove default styling on iOS */
    appearance: none;
    color: #0c0000;
   
}

.form-group input:focus, 
.form-group select:focus, 
.form-group textarea:focus {
    border-color: #6c5ce7;
    outline: none;
    background-color: #fff;
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

/* Password input styling */
.password-input {
    position: relative;
}

.password-input input {
    padding-right: 40px;
}

.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #777;
}

/* Password strength meter */
.password-strength {
    margin-top: 8px;
}

.strength-meter {
    display: flex;
    gap: 4px;
    margin-bottom: 4px;
}

.strength-segment {
    height: 4px;
    flex: 1;
    background-color: #ddd;
    border-radius: 2px;
}

.strength-segment.weak {
    background-color: #ff4757;
}

.strength-segment.medium {
    background-color: #ffa502;
}

.strength-segment.strong {
    background-color: #2ed573;
}

.strength-text {
    font-size: 0.75rem;
    color: #777;
}

/* Action buttons */
.profile-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.primary-btn, .secondary-btn {
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 0.9rem;
    border: none;
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
}

.primary-btn {
    background-color: #6c5ce7;
    color: white;
}

.primary-btn:hover, .primary-btn:active {
    background-color: #5649c0;
}

.secondary-btn {
    background-color: #f0f0f0;
    color: #333;
}

.secondary-btn:hover, .secondary-btn:active {
    background-color: #e0e0e0;
}

/* Change password section */
.change-password-section {
    padding: 0 20px 20px;
    border-top: 1px solid #eee;
    margin-top: 10px;
}

.change-password-section h3 {
    margin: 16px 0;
    font-size: 1.1rem;
    color: #333;
}

.hidden {
    display: none;
}

/* Animation keyframes */
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* Media queries for better responsiveness */
@media (max-width: 480px) {
    .profile-modal-content {
        width: 95%;
        margin: 10px auto;
    }
    
    .emoji-avatar-wrapper {
        width: 80px;
        height: 80px;
    }
    
    .current-emoji-avatar {
        font-size: 40px;
    }
    
    .emoji-selector {
        width: 180px;
        padding: 8px;
        gap: 8px;
    }
    
    .emoji-option {
        width: 36px;
        height: 36px;
        font-size: 20px;
    }
    
    .profile-actions {
        flex-direction: column-reverse;
        gap: 8px;
    }
    
    .primary-btn, .secondary-btn {
        width: 100%;
        padding: 12px 16px;
    }
    
    .form-group input, 
    .form-group select, 
    .form-group textarea {
        padding: 14px 12px;
    }
}

/* Fix for iOS input zoom */
@media screen and (-webkit-min-device-pixel-ratio: 0) { 
    select,
    textarea,
    input {
        font-size: 16px;
    }
}

/* Fix for notched iPhones */
@supports (padding: max(0px)) {
    .profile-modal {
        padding-top: max(20px, env(safe-area-inset-top));
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}


/* Sidebar Menu */
.sidebar-menu {
    position: fixed;
    top: 0;
    left: -300px;
    width: 280px;
    height: 100%;
    background-color: var(--sidebar-bg);
    z-index: 1000;
    transition: left 0.3s ease;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.sidebar-menu.active {
    left: 0;
}

/* Sidebar Header */
.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid var(--sidebar-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-user-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.user-details {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--sidebar-text);
}

.user-email {
    font-size: 12px;
    color: var(--sidebar-text);
    opacity: 0.8;
}

.close-sidebar {
    background: none;
    border: none;
    color: var(--sidebar-text);
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
}

/* Sidebar Content */
.sidebar-content {
    flex: 1;
    padding: 20px 0;
}

.sidebar-menu-items {
    list-style: none;
    padding: 0;
    margin: 0;
}

.menu-item {
    margin-bottom: 5px;
}

.menu-item a {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: var(--sidebar-text);
    text-decoration: none;
    transition: all 0.2s ease;
}

.menu-item a:hover {
    background-color: var(--sidebar-hover);
}

.menu-item a i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

.logout-btn {
    color: #ff6b6b !important;
}

/* Theme Toggle */
.theme-toggle {
    padding: 12px 20px;
}

.theme-switch-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: var(--sidebar-text);
}

.theme-switch-wrapper span {
    display: flex;
    align-items: center;
}

.theme-switch-wrapper span i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

.theme-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--toggle-bg);
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: var(--toggle-ball);
    transition: .4s;
}

input:checked + .slider {
    background-color: var(--toggle-active);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.slider.round {
    border-radius: 34px;
}

.slider.round:before {
    border-radius: 50%;
}

/* Sidebar Footer */
.sidebar-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--sidebar-border);
    text-align: center;
}

.app-version {
    font-size: 12px;
    color: var(--sidebar-text);
    opacity: 0.7;
}

/* Overlay */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--overlay-bg);
    z-index: 999;
    display: none;
}

.sidebar-overlay.active {
    display: block;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--overlay-bg);
    z-index: 1001;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}

.modal.active {
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.modal-content {
    background-color: var(--modal-bg);
    width: 90%;
    max-width: 600px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    animation: modalFadeIn 0.3s ease;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid var(--modal-border);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    color: var(--modal-text);
    font-weight: 600;
}

.close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--modal-text);
    padding: 0;
    line-height: 1;
}

.modal-body {
    padding: 20px;
    color: var(--modal-text);
    max-height: 70vh;
    overflow-y: auto;
}

.terms-content h3, .privacy-content h3 {
    margin-top: 20px;
    margin-bottom: 10px;
    font-size: 1.1rem;
    color: var(--modal-text);
}

.terms-content p, .privacy-content p {
    margin-bottom: 15px;
    line-height: 1.5;
    font-size: 0.95rem;
}

/* Animation keyframes */
@keyframes modalFadeIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Media queries for better responsiveness */
@media (max-width: 480px) {
    .sidebar-menu {
        width: 260px;
    }
    
    .hamburger-menu {
        top: 15px;
        left: 15px;
        width: 36px;
        height: 36px;
    }
    
    .modal-content {
        width: 95%;
        margin: 10px auto;
    }
    
    .user-avatar {
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}

/* Fix for notched iPhones */
@supports (padding: max(0px)) {
    .sidebar-menu {
        padding-top: max(0px, env(safe-area-inset-top));
        padding-bottom: max(0px, env(safe-area-inset-bottom));
    }
    
    .modal {
        padding-top: max(20px, env(safe-area-inset-top));
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
}

  </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="split-screen">
            <div class="left">
                <div class="logo">
                    <h1>Rewarder</h1>
                </div>
                <div class="tagline">
                    <h2>Discover Talent. Vote. Win.</h2>
                    <p>Join the platform where talent gets rewarded and voters earn too!</p>
                </div>
                <div class="features">
                    <div class="feature">
                        <i class="fas fa-trophy"></i>
                        <span>Compete in exciting talent categories</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-vote-yea"></i>
                        <span>Vote for your favorites and earn rewards</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-coins"></i>
                        <span>Win cash prizes and recognition</span>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="auth-container" id="loginForm">
                    <h2>Welcome Back</h2>
                    <p>Sign in to continue your journey</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google">
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign in with email</span>
                    </div>
                    
                    <form id="loginFormElement">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        <div class="form-options">
                            <div class="remember-me">
                                <input type="checkbox" id="remember">
                                <label for="remember">Remember me</label>
                            </div>
                            <a href="#" class="forgot-password">Forgot password?</a>
                        </div>
                        <button type="submit" class="auth-btn">Sign In</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Don't have an account? <a href="#" id="showSignup">Sign up</a></p>
                    </div>
                </div>
                
                <div class="auth-container hidden" id="signupForm">
                    <h2>Create Account</h2>
                    <p>Join the talent revolution</p>
                    
                    <div class="social-login">
                        <button class="social-btn google-btn">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google">
                            <span>Continue with Google</span>
                        </button>
                    </div>
                    
                    <div class="divider">
                        <span>or sign up with email</span>
                    </div>
                    
                    <form id="signupFormElement">
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <div class="password-input">
                                <input type="password" id="signupPassword" placeholder="Create a password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                            <div class="password-strength">
                                <div class="strength-meter">
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                </div>
                                <span class="strength-text">Password strength</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="userType">I want to join as</label>
                            <select id="userType" required>
                                <option value="" disabled selected>Select your role</option>
                                <option value="contestant">Contestant</option>
                                <option value="voter">Voter</option>
                                <option value="both">Both</option>
                            </select>
                        </div>
                        <div class="form-options">
                            <div class="terms">
                                <input type="checkbox" id="terms" required>
                                <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                            </div>
                        </div>
                        <button type="submit" class="auth-btn">Create Account</button>
                    </form>
                    
                    <div class="auth-switch">
                        <p>Already have an account? <a href="#" id="showLogin">Sign in</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
<div class="dashboard-page" id="dashboardPage">
    <!-- Top Navigation Bar -->
    <div class="dashboard-nav">
        <div class="user-info">
            <div class="profile-circle">
          <!-- User profile circle in header/navbar -->
<div class="user-profile-image emoji-avatar" id="profileCircle">🤖</div>

            </div>
            <span class="username" id="usernameDisplay">Username</span>
        </div>
        
        <div class="trophy-btn">
            <i class="fas fa-trophy"></i>
            <span>Trophy</span>
        </div>
        
        <div class="hamburger-menu">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        <!-- Action Buttons Container - Single Row -->
        <div class="action-buttons-row">
            <div class="action-btn wallet-btn">
                <div class="action-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <span>Wallet</span>
            </div>
            
            <div class="action-btn creator-btn">
                <div class="action-icon">
                    <i class="fas fa-video"></i>
                </div>
                <span>Creator</span>
            </div>
            
            <div class="action-btn spin-btn">
                <div class="action-icon spin-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <span>Spin</span>
            </div>
            
            <div class="action-btn notification-btn">
                <div class="action-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <span>Alerts</span>
            </div>
        </div>
    </div>
</div>


<!-- Profile Modal -->
<div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
        <div class="profile-modal-header">
            <h2>My Profile</h2>
            <button class="close-modal">&times;</button>
        </div>
        
       
      <!-- Emoji Avatar Section (replaces the profile image section) -->
      <div class="emoji-avatar-wrapper" id="emojiAvatarWrapper">
        <div class="current-emoji-avatar" id="currentEmojiAvatar">🤖</div>
        <div class="emoji-selector" id="emojiSelector">
          <div class="emoji-option" data-emoji="🎶">🎶</div>
          <div class="emoji-option" data-emoji="🤖">🤖</div>
          <div class="emoji-option" data-emoji="🕸️">🕸️</div>
          <div class="emoji-option" data-emoji="🛼">🛼</div>
          <div class="emoji-option" data-emoji="🎨">🎨</div>
          <div class="emoji-option" data-emoji="🦺">🦺</div>
          <div class="emoji-option" data-emoji="⛑️">⛑️</div>
        </div>
      </div>
      
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileFullName">Full Name</label>
                    <input type="text" id="profileFullName" placeholder="Your full name">
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Email</label>
                    <input type="email" id="profileEmail" readonly>
                </div>
                
                <div class="form-group">
                    <label for="profileUserType">Account Type</label>
                    <select id="profileUserType">
                        <option value="contestant">Contestant</option>
                        <option value="voter">Voter</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="profileBio">Bio</label>
                    <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                </div>
                
                <div class="profile-actions">
                    <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                    <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                </div>
            </form>
            
            <!-- Change Password Section (Hidden by default) -->
            <div id="changePasswordSection" class="change-password-section hidden">
                <h3>Change Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <div class="password-input">
                            <input type="password" id="currentPassword" placeholder="Enter current password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <div class="password-input">
                            <input type="password" id="newPassword" placeholder="Enter new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-strength">
                            <div class="strength-meter">
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                                <div class="strength-segment"></div>
                            </div>
                            <span class="strength-text">Password strength</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="password-input">
                            <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                        <button type="submit" class="primary-btn">Update Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Sidebar Menu -->
<div class="sidebar-menu" id="sidebarMenu">
    <div class="sidebar-header">
        <div class="sidebar-user-info">
            <div class="user-avatar emoji-avatar" id="sidebarUserAvatar">🤖</div>
            <div class="user-details">
                <div class="user-name" id="sidebarUserName">User Name</div>
                <div class="user-email" id="sidebarUserEmail">user@example.com</div>
            </div>
        </div>
        <button class="close-sidebar" id="closeSidebarBtn">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <div class="sidebar-content">
        <ul class="sidebar-menu-items">
            <li class="menu-item">
                <a href="#" id="profileMenuBtn">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </li>
            
            <li class="menu-item theme-toggle">
                <div class="theme-switch-wrapper">
                    <span>
                        <i class="fas fa-sun"></i>
                        <span>Theme</span>
                    </span>
                    <label class="theme-switch" for="themeCheckbox">
                        <input type="checkbox" id="themeCheckbox">
                        <div class="slider round"></div>
                    </label>
                </div>
            </li>
            
            <li class="menu-item">
                <a href="#" id="termsBtn">
                    <i class="fas fa-file-contract"></i>
                    <span>Terms & Conditions</span>
                </a>
            </li>
            
            <li class="menu-item">
                <a href="#" id="privacyBtn">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacy Policy</span>
                </a>
            </li>
            
            <li class="menu-item">
                <a href="#" id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>
    
    <div class="sidebar-footer">
        <div class="app-version">Version 1.0.0</div>
    </div>
</div>

<!-- Overlay for closing sidebar when clicking outside -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Terms & Conditions Modal -->
<div class="modal" id="termsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Terms & Conditions</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="terms-content">
                <h3>1. Acceptance of Terms</h3>
                <p>By accessing and using this application, you accept and agree to be bound by the terms and provisions of this agreement.</p>
                
                <h3>2. User Account</h3>
                <p>To use certain features of the application, you must register for an account. You agree to provide accurate information and keep your account secure.</p>
                
                <h3>3. User Conduct</h3>
                <p>You agree not to use the application for any illegal purposes or to conduct activities that may damage, disable, or impair the application's functionality.</p>
                
                <h3>4. Intellectual Property</h3>
                <p>All content, features, and functionality of the application are owned by us and are protected by international copyright, trademark, and other intellectual property laws.</p>
                
                <h3>5. Termination</h3>
                <p>We may terminate or suspend your account and access to the application at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users or us.</p>
                
                <h3>6. Changes to Terms</h3>
                <p>We reserve the right to modify these terms at any time. Your continued use of the application after such changes constitutes your acceptance of the new terms.</p>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal" id="privacyModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Privacy Policy</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="privacy-content">
                <h3>1. Information We Collect</h3>
                <p>We collect information you provide directly to us when you register for an account, create or modify your profile, and use the features of our application.</p>
                
                <h3>2. How We Use Information</h3>
                <p>We use the information we collect to provide, maintain, and improve our services, to develop new ones, and to protect our application and users.</p>
                
                <h3>3. Information Sharing</h3>
                <p>We do not share your personal information with companies, organizations, or individuals outside of our organization except in the following cases: with your consent, for legal reasons, or to protect rights and safety.</p>
                
                <h3>4. Data Security</h3>
                <p>We work hard to protect our users from unauthorized access to or unauthorized alteration, disclosure, or destruction of information we hold.</p>
                
                <h3>5. Data Retention</h3>
                <p>We retain your information for as long as your account is active or as needed to provide you services.</p>
                
                <h3>6. Changes to This Policy</h3>
                <p>We may change this privacy policy from time to time. We will notify you of any changes by posting the new privacy policy on this page.</p>
            </div>
        </div>
    </div>
</div>


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
   // Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAGJ6EoBub9uL-R7q8N-_r85-VhuSiSlFo",
  authDomain: "billsandmal.firebaseapp.com",
  projectId: "billsandmal",
  storageBucket: "billsandmal.firebasestorage.app",
  messagingSenderId: "663259820123",
  appId: "1:663259820123:web:078be226314c5a74444f7e",
  measurementId: "G-DSJ2FS4VRV"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const analytics = firebase.analytics();

// DOM Elements
const loginForm = document.getElementById('loginFormElement');
const signupForm = document.getElementById('signupFormElement');
const googleBtns = document.querySelectorAll('.google-btn');
const togglePasswordBtns = document.querySelectorAll('.toggle-password');
const showSignupBtn = document.getElementById('showSignup');
const showLoginBtn = document.getElementById('showLogin');
const loginContainer = document.getElementById('loginForm');
const signupContainer = document.getElementById('signupForm');
const splitScreen = document.querySelector('.split-screen');

// Create dashboard page if it doesn't exist
let dashboardPage = document.getElementById('dashboardPage');
if (!dashboardPage) {
  dashboardPage = document.createElement('div');
  dashboardPage.id = 'dashboardPage';
  dashboardPage.className = 'dashboard-page';
  document.querySelector('.container').appendChild(dashboardPage);
  
  // Add dashboard HTML
  dashboardPage.innerHTML = `
    <!-- Top Navigation Bar -->
    <div class="dashboard-nav">
        <div class="user-info">
            <div class="profile-circle">
                <img src="https://via.placeholder.com/40" alt="Profile" id="userProfileImage">
            </div>
            <span class="username" id="usernameDisplay">Username</span>
        </div>
        
        <div class="trophy-btn">
            <i class="fas fa-trophy"></i>
            <span>Trophy</span>
        </div>
        
        <div class="hamburger-menu" id="hamburgerMenu">
            <i class="fas fa-bars"></i>
        </div>
        
        <!-- Dropdown menu (hidden by default) -->
        <div class="dropdown-menu" id="dropdownMenu">
            <div class="dropdown-item logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
    </div>
    
    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        <!-- Action Buttons Container - Single Row -->
        <div class="action-buttons-row">
            <div class="action-btn wallet-btn">
                <div class="action-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <span>Wallet</span>
            </div>
            
            <div class="action-btn creator-btn">
                <div class="action-icon">
                    <i class="fas fa-video"></i>
                </div>
                <span>Creator</span>
            </div>
            
            <div class="action-btn spin-btn">
                <div class="action-icon spin-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <span>Spin</span>
            </div>
            
            <div class="action-btn notification-btn">
                <div class="action-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <span>Alerts</span>
            </div>
        </div>
    </div>
  `;
}

// Toast notification function
function showToast(message, type = 'success') {
  // Create toast container if it doesn't exist
  let toastContainer = document.querySelector('.toast-container');
  if (!toastContainer) {
    toastContainer = document.createElement('div');
    toastContainer.className = 'toast-container';
    document.body.appendChild(toastContainer);
  }
  
  // Create toast element
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <div class="toast-content">
      <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
      <span>${message}</span>
    </div>
    <div class="toast-progress"></div>
  `;
  
  toastContainer.appendChild(toast);
  
  // Show and hide toast with animation
  setTimeout(() => toast.classList.add('visible'), 10);
  
  // Remove toast after animation
  setTimeout(() => {
    toast.classList.remove('visible');
    setTimeout(() => toastContainer.removeChild(toast), 300);
  }, 3000);
}

// Add CSS for toast if not already in your stylesheet
const toastStyles = document.createElement('style');
toastStyles.textContent = `
  .toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .toast {
    background-color: white;
    color: #333;
    padding: 12px 15px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    min-width: 250px;
    max-width: 350px;
    transform: translateX(100%);
    opacity: 0;
    transition: all 0.3s ease;
    overflow: hidden;
  }
  
  .toast.visible {
    transform: translateX(0);
    opacity: 1;
  }
  
  .toast-content {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .toast.success i {
    color: #2ecc71;
  }
  
  .toast.error i {
    color: #e74c3c;
  }
  
  .toast-progress {
    height: 3px;
    background-color: #ddd;
    width: 100%;
    margin-top: 8px;
    position: relative;
  }
  
  .toast-progress::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    background-color: #2ecc71;
    animation: progress 3s linear forwards;
  }
  
  .toast.error .toast-progress::after {
    background-color: #e74c3c;
  }
  
  @keyframes progress {
    0% { width: 100%; }
    100% { width: 0%; }
  }
  
  /* Dropdown menu styles */
  .dropdown-menu {
    position: absolute;
    top: 55px;
    right: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    padding: 8px 0;
    min-width: 150px;
    display: none;
    z-index: 200;
  }
  
  .dropdown-menu.active {
    display: block;
    animation: fadeIn 0.2s ease forwards;
  }
  
  .dropdown-item {
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .dropdown-item:hover {
    background-color: #f5f5f5;
  }
  
  .logout-btn i {
    color: #e74c3c;
  }
  
  /* Loading spinner for buttons */
  .auth-btn.loading {
    position: relative;
    color: transparent !important;
    pointer-events: none;
  }
  
  .loading-spinner {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 0.8s linear infinite;
    top: calc(50% - 10px);
    left: calc(50% - 10px);
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
`;
document.head.appendChild(toastStyles);

// Toggle between login and signup forms
if (showSignupBtn) {
  showSignupBtn.addEventListener('click', function(e) {
    e.preventDefault();
    loginContainer.classList.add('hidden');
    signupContainer.classList.remove('hidden');
  });
}

if (showLoginBtn) {
  showLoginBtn.addEventListener('click', function(e) {
    e.preventDefault();
    signupContainer.classList.add('hidden');
    loginContainer.classList.remove('hidden');
  });
}

// Toggle password visibility
togglePasswordBtns.forEach(btn => {
  btn.addEventListener('click', function() {
    const passwordInput = this.parentElement.querySelector('input');
    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordInput.setAttribute('type', type);
    this.classList.toggle('fa-eye');
    this.classList.toggle('fa-eye-slash');
  });
});

// Password strength checker
const passwordInput = document.getElementById('signupPassword');
if (passwordInput) {
  const strengthSegments = document.querySelectorAll('.strength-segment');
  const strengthText = document.querySelector('.strength-text');

  passwordInput.addEventListener('input', function() {
    updatePasswordStrength(this.value);
  });

  function updatePasswordStrength(password) {
    // Reset all segments
    strengthSegments.forEach(segment => {
      segment.className = 'strength-segment';
    });
    
    if (!password) {
      strengthText.textContent = 'Password strength';
      return;
    }
    
    // Check password strength
    const hasLower = /[a-z]/.test(password);
    const hasUpper = /[A-Z]/.test(password);
    const hasNumber = /[0-9]/.test(password);
    const hasSpecial = /[^A-Za-z0-9]/.test(password);
    const length = password.length;
    
    let strength = 0;
    if (length >= 8) strength++;
    if (hasLower && hasUpper) strength++;
    if (hasNumber) strength++;
    if (hasSpecial) strength++;
    
    // Update UI based on strength
    for (let i = 0; i < strength; i++) {
      if (strengthSegments[i]) {
        if (strength === 1) {
          strengthSegments[i].classList.add('weak');
        } else if (strength === 2) {
          strengthSegments[i].classList.add('medium');
        } else {
          strengthSegments[i].classList.add('strong');
        }
      }
    }
    
    // Update text
    if (strength === 0) strengthText.textContent = 'Very weak';
    else if (strength === 1) strengthText.textContent = 'Weak';
    else if (strength === 2) strengthText.textContent = 'Medium';
    else if (strength === 3) strengthText.textContent = 'Strong';
    else strengthText.textContent = 'Very strong';
  }
}

// Show loading state on button
function setButtonLoading(button, isLoading) {
  if (isLoading) {
    button.classList.add('loading');
    const originalText = button.textContent;
    button.setAttribute('data-original-text', originalText);
    button.innerHTML = 'Processing... <span class="loading-spinner"></span>';
    button.disabled = true;
  } else {
    button.classList.remove('loading');
    const originalText = button.getAttribute('data-original-text');
    button.textContent = originalText;
    button.disabled = false;
  }
}

// Navigate to dashboard
function navigateToDashboard(user) {
  // Hide authentication container
  splitScreen.style.display = 'none';
  
  // Show dashboard
  dashboardPage.classList.add('active');
  
  // Set username
  const displayName = user.displayName || user.email.split('@')[0];
  document.getElementById('usernameDisplay').textContent = displayName;
  
  // Set profile image if available
  if (user.photoURL) {
    document.getElementById('userProfileImage').src = user.photoURL;
  }
  
  // Prevent body scrolling
  document.body.style.overflow = 'hidden';
  
  // Log analytics event
  analytics.logEvent('login', {
    method: user.providerData[0].providerId
  });
  
  // Setup hamburger menu
  setupHamburgerMenu();
}

// Setup hamburger menu
function setupHamburgerMenu() {
  const hamburgerMenu = document.getElementById('hamburgerMenu');
  const dropdownMenu = document.getElementById('dropdownMenu');
  
  if (hamburgerMenu && dropdownMenu) {
    hamburgerMenu.addEventListener('click', function() {
      dropdownMenu.classList.toggle('active');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      if (!hamburgerMenu.contains(event.target) && !dropdownMenu.contains(event.target)) {
        dropdownMenu.classList.remove('active');
      }
    });
  }
}

// Google Sign In
googleBtns.forEach(btn => {
  btn.addEventListener('click', function() {
    const provider = new firebase.auth.GoogleAuthProvider();
    provider.addScope('profile');
    provider.addScope('email');
    
    auth.signInWithPopup(provider)
      .then((result) => {
        // Save user data to Firestore
        const user = result.user;
        saveUserData(user);
        
               // Show success message
               showToast('Successfully signed in with Google!');
        
        // Navigate to dashboard
        navigateToDashboard(user);
      })
      .catch((error) => {
        console.error('Google sign in error:', error);
        showToast(error.message, 'error');
      });
  });
});

// Email/Password Sign Up
if (signupForm) {
  signupForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const fullName = document.getElementById('fullName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const userType = document.getElementById('userType').value;
    const termsAccepted = document.getElementById('terms').checked;
    
    if (!termsAccepted) {
      showToast('Please accept the Terms of Service and Privacy Policy', 'error');
      return;
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    // Create user with email and password
    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Update profile with display name
        return user.updateProfile({
          displayName: fullName
        }).then(() => {
          // Save additional user data to Firestore
          return saveUserData(user, {
            fullName,
            userType,
            termsAccepted,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        }).then(() => {
          showToast('Account created successfully!');
          navigateToDashboard(user);
        });
      })
      .catch((error) => {
        console.error('Signup error:', error);
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Email/Password Sign In
if (loginForm) {
  loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    const rememberMe = document.getElementById('remember') ? document.getElementById('remember').checked : false;
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    setButtonLoading(submitBtn, true);
    
    // Set persistence based on "Remember me" checkbox
    const persistence = rememberMe 
      ? firebase.auth.Auth.Persistence.LOCAL 
      : firebase.auth.Auth.Persistence.SESSION;
    
    auth.setPersistence(persistence)
      .then(() => {
        return auth.signInWithEmailAndPassword(email, password);
      })
      .then((userCredential) => {
        const user = userCredential.user;
        
        // Update last login timestamp
        db.collection('users').doc(user.uid).update({
          lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(err => console.log('Error updating last login:', err));
        
        showToast('Successfully signed in!');
        navigateToDashboard(user);
      })
      .catch((error) => {
        console.error('Login error:', error);
        showToast(error.message, 'error');
      })
      .finally(() => {
        setButtonLoading(submitBtn, false);
      });
  });
}

// Modify the saveUserData function to include better error handling
function saveUserData(user, additionalData = {}) {
  console.log('Attempting to save user data for:', user.email);
  
  // Basic user data
  const userData = {
    uid: user.uid,
    email: user.email,
    displayName: user.displayName || additionalData.fullName || '',
    photoURL: user.photoURL || '',
    emailVerified: user.emailVerified,
    lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
    ...additionalData
  };
  
  console.log('User data to save:', userData);
  
  // Save to Firestore (merge to update existing data)
  return db.collection('users').doc(user.uid).set(userData, { merge: true })
    .then(() => {
      console.log('User data successfully saved to Firestore');
      return true;
    })
    .catch((error) => {
      console.error('Error saving user data to Firestore:', error);
      showToast('Account created but profile data could not be saved: ' + error.message, 'error');
      throw error;
    });
}

// Check if user is already logged in
auth.onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in
    console.log('User is already signed in:', user.email);
    
    // If we're on the login page, navigate to dashboard
    if (splitScreen && splitScreen.style.display !== 'none') {
      navigateToDashboard(user);
    }
  }
});

// Forgot password functionality
const forgotPasswordLink = document.querySelector('.forgot-password');
if (forgotPasswordLink) {
  forgotPasswordLink.addEventListener('click', function(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    if (!email) {
      showToast('Please enter your email address first', 'error');
      return;
    }
    
    auth.sendPasswordResetEmail(email)
      .then(() => {
        showToast('Password reset email sent. Check your inbox.');
      })
      .catch((error) => {
        console.error('Password reset error:', error);
        showToast(error.message, 'error');
      });
  });
}

// Logout functionality
function logout() {
  auth.signOut()
    .then(() => {
      // Show login screen again
      splitScreen.style.display = 'flex';
      dashboardPage.classList.remove('active');
      
      // Reset body overflow
      document.body.style.overflow = 'auto';
      
      // Show success message
      showToast('Successfully logged out!');
    })
    .catch((error) => {
      console.error('Logout error:', error);
      showToast(error.message, 'error');
    });
}

// Add logout function to window object so it can be called from HTML
window.logout = logout;

// Add additional CSS for dashboard
const dashboardStyles = document.createElement('style');
dashboardStyles.textContent = `
  /* Dashboard Styles */
  .dashboard-page {
    display: none;
    flex-direction: column;
    height: 100vh;
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #f8f9fa;
    z-index: 1000;
  }

  .dashboard-page.active {
    display: flex;
  }

  /* Top Navigation Bar */
  .dashboard-nav {
    background-color: white;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: relative;
    width: 100%;
    z-index: 100;
    flex-shrink: 0;
    height: 56px;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .profile-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid #6c5ce7;
    flex-shrink: 0;
  }

  .profile-circle img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .username {
    font-weight: 600;
    font-size: 0.95rem;
    color: #333;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100px;
  }

  .trophy-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background-color: #6c5ce7;
    color: white;
    padding: 6px 15px;
    border-radius: 50px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(108, 92, 231, 0.2);
    font-size: 0.9rem;
    white-space: nowrap;
  }

  .trophy-btn:hover {
    background-color: #5b4bc4;
  }

  .trophy-btn i {
    font-size: 0.9rem;
  }

  .hamburger-menu {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 50%;
    transition: all 0.3s ease;
    flex-shrink: 0;
  }

  .hamburger-menu:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  .hamburger-menu i {
    font-size: 1.2rem;
    color: #333;
  }

  /* Main Dashboard Container */
  .dashboard-container {
    flex: 1;
    padding: 15px;
    width: 100%;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Action Buttons - Single Row */
  .action-buttons-row {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 15px;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding-bottom: 5px;
    flex-shrink: 0;
  }

  .action-buttons-row::-webkit-scrollbar {
    display: none;
  }

  .action-btn {
    background-color: white;
    border-radius: 12px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
    min-width: 70px;
    flex: 1;
  }

  .action-btn:active {
    transform: scale(0.95);
  }

  .action-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
  }

  /* Spinning animation for spin icon */
  .spin-icon {
    position: relative;
    overflow: hidden;
  }

  .spin-icon i {
    animation: spin 5s linear infinite;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .spin-icon::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 50%;
    border: 2px dashed #2ecc71;
    animation: spin-reverse 10s linear infinite;
  }

  @keyframes spin-reverse {
    0% { transform: rotate(360deg); }
    100% { transform: rotate(0deg); }
  }

  .wallet-btn .action-icon {
    background-color: rgba(108, 92, 231, 0.1);
    color: #6c5ce7;
  }

  .creator-btn .action-icon {
    background-color: rgba(253, 121, 168, 0.1);
    color: #fd79a8;
  }

  .spin-btn .action-icon {
    background-color: rgba(46, 204, 113, 0.1);
    color: #2ecc71;
  }

  .notification-btn .action-icon {
    background-color: rgba(241, 196, 15, 0.1);
    color: #f1c40f;
  }

  .action-btn span {
    font-weight: 500;
    font-size: 0.8rem;
    color: #333;
    text-align: center;
    white-space: nowrap;
  }
`;
document.head.appendChild(dashboardStyles);

// Initialize the app
console.log('Firebase Auth initialized');


// Profile functionality
document.addEventListener('DOMContentLoaded', function() {
    // Check if Firebase is initialized
    if (typeof firebase === 'undefined') {
        console.error('Firebase SDK is not loaded. Profile functionality will not work.');
        return;
    }

    // Ensure we have the storage SDK
    if (!firebase.storage) {
        // Load Firebase Storage SDK if not already loaded
        const storageScript = document.createElement('script');
        storageScript.src = 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js';
        storageScript.onload = function() {
            console.log('Firebase Storage SDK loaded');
            initProfileModal();
        };
        document.head.appendChild(storageScript);
    } else {
        initProfileModal();
    }
});

function initProfileModal() {
    // Create and append the profile modal HTML to the body
    const profileModalHTML = `
    <!-- Profile Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h2>My Profile</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="profile-modal-body">
                <div class="profile-image-container">
                    <div class="profile-image-wrapper">
                        <img src="https://via.placeholder.com/150" alt="Profile" id="profileModalImage">
                        <div class="profile-image-overlay">
                            <i class="fas fa-camera"></i>
                            <span>Change</span>
                        </div>
                    </div>
                    <input type="file" id="profileImageUpload" accept="image/*" hidden>
                </div>
                
                <form id="profileForm">
                    <div class="form-group">
                        <label for="profileFullName">Full Name</label>
                        <input type="text" id="profileFullName" placeholder="Your full name">
                    </div>
                    
                    <div class="form-group">
                        <label for="profileEmail">Email</label>
                        <input type="email" id="profileEmail" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileUserType">Account Type</label>
                        <select id="profileUserType">
                            <option value="contestant">Contestant</option>
                            <option value="voter">Voter</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="profileBio">Bio</label>
                        <textarea id="profileBio" placeholder="Tell us about yourself" rows="3"></textarea>
                    </div>
                    
                    <div class="profile-actions">
                        <button type="button" id="changePasswordBtn" class="secondary-btn">Change Password</button>
                        <button type="submit" id="saveProfileBtn" class="primary-btn">Save Changes</button>
                    </div>
                </form>
                
                <!-- Change Password Section (Hidden by default) -->
                <div id="changePasswordSection" class="change-password-section hidden">
                    <h3>Change Password</h3>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <div class="password-input">
                                <input type="password" id="currentPassword" placeholder="Enter current password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <div class="password-input">
                                <input type="password" id="newPassword" placeholder="Enter new password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                            <div class="password-strength">
                                <div class="strength-meter">
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                    <div class="strength-segment"></div>
                                </div>
                                <span class="strength-text">Password strength</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <div class="password-input">
                                <input type="password" id="confirmPassword" placeholder="Confirm new password" required>
                                <i class="fas fa-eye-slash toggle-password"></i>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button type="button" id="cancelPasswordChange" class="secondary-btn">Cancel</button>
                            <button type="submit" class="primary-btn">Update Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    `;

    // Add the profile modal CSS
    const profileStyles = document.createElement('style');
    profileStyles.textContent = `
    /* Profile Modal Styles */
    .profile-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        overflow-y: auto;
        animation: fadeIn 0.3s ease;
    }

    .profile-modal.active {
        display: block;
    }

    .profile-modal-content {
        background-color: white;
        margin: 20px auto;
        width: 90%;
        max-width: 500px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        animation: slideUp 0.4s ease;
    }

    .profile-modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .profile-modal-header h2 {
        margin: 0;
        font-size: 1.3rem;
        color: #333;
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #777;
        transition: color 0.3s ease;
    }

    .close-modal:hover {
        color: #333;
    }

    .profile-modal-body {
        padding: 20px;
    }

    .profile-image-container {
        display: flex;
        justify-content: center;
        margin-bottom: 25px;
    }

    .profile-image-wrapper {
        position: relative;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border: 3px solid #6c5ce7;
    }

    .profile-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-image-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 8px 0;
        text-align: center;
        font-size: 0.8rem;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .profile-image-wrapper:hover .profile-image-overlay {
        transform: translateY(0);
    }

    .profile-image-overlay i {
        font-size: 1rem;
        margin-bottom: 2px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
        font-size: 0.9rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 0.95rem;
        transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        border-color: #6c5ce7;
        outline: none;
    }

    .form-group input[readonly] {
        background-color: #f8f9fa;
        cursor: not-allowed;
    }

    .profile-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    .primary-btn,
    .secondary-btn {
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 0.95rem;
    }

    .primary-btn {
        background-color: #6c5ce7;
        color: white;
    }

    .primary-btn:hover {
        background-color: #5b4bc4;
    }

    .secondary-btn {
        background-color: #f1f3f5;
        color: #333;
    }

    .secondary-btn:hover {
        background-color: #e9ecef;
    }

    /* Change Password Section */
    .change-password-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
    }

    .change-password-section h3 {
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.1rem;
        color: #333;
    }

    .hidden {
        display: none;
    }

    .password-input {
        position: relative;
    }

    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #777;
    }

    /* Password Strength Meter */
    .password-strength {
        margin-top: 8px;
    }

    .strength-meter {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }

    .strength-segment {
        height: 4px;
        flex: 1;
        background-color: #ddd;
        border-radius: 2px;
        transition: background-color 0.3s ease;
    }

    .strength-segment.weak {
        background-color: #e74c3c;
    }

    .strength-segment.medium {
        background-color: #f39c12;
    }

    .strength-segment.strong {
        background-color: #2ecc71;
    }

    .strength-text {
        font-size: 0.8rem;
        color: #777;
    }

    /* Loading Spinner */
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
        margin-left: 8px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    /* Button Loading State */
    .primary-btn.loading,
    .secondary-btn.loading {
        position: relative;
        color: transparent !important;
        pointer-events: none;
    }

    .primary-btn.loading .loading-spinner,
    .secondary-btn.loading .loading-spinner {
        position: absolute;
        top: calc(50% - 10px);
        left: calc(50% - 10px);
    }

    .secondary-btn.loading .loading-spinner {
        border-top-color: #333;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
        .profile-modal-content {
            width: 95%;
            margin: 10px auto;
        }
        
        .profile-actions {
            flex-direction: column;
            gap: 10px;
        }
        
        .primary-btn,
        .secondary-btn {
            width: 100%;
        }
    }
    `;

    // Append the CSS and HTML to the document
    document.head.appendChild(profileStyles);
    document.body.insertAdjacentHTML('beforeend', profileModalHTML);

    // Initialize the profile functionality
    initializeProfileFunctionality();
}

function initializeProfileFunctionality() {
    // Get Firebase services
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // DOM Elements
    const profileCircle = document.querySelector('.profile-circle');
    const profileModal = document.getElementById('profileModal');
    const closeModalBtn = document.querySelector('.close-modal');
    const profileForm = document.getElementById('profileForm');
    const profileImageWrapper = document.querySelector('.profile-image-wrapper');
    const profileImageUpload = document.getElementById('profileImageUpload');
    const profileModalImage = document.getElementById('profileModalImage');
    const userProfileImage = document.getElementById('userProfileImage');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordSection = document.getElementById('changePasswordSection');
    const cancelPasswordChange = document.getElementById('cancelPasswordChange');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const togglePasswordBtns = document.querySelectorAll('.toggle-password');
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const strengthSegments = document.querySelectorAll('.strength-meter .strength-segment');
    const strengthText = document.querySelector('.strength-text');

    // Check if elements exist
    if (!profileCircle || !profileModal) {
        console.error('Required DOM elements not found');
        return;
    }

    // Open profile modal when clicking on profile circle
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    
    // Don't reset the image when opening the modal
    // Just load the user data from Firestore
    loadUserProfileData();
});

    // Close modal when clicking the close button
    closeModalBtn.addEventListener('click', function() {
        profileModal.classList.remove('active');
    });

    // Close modal when clicking outside the modal content
    profileModal.addEventListener('click', function(e) {
        if (e.target === profileModal) {
            profileModal.classList.remove('active');
        }
    });

    // Trigger file upload when clicking on profile image
    profileImageWrapper.addEventListener('click', function() {
        profileImageUpload.click();
    });


// Function to initialize the emoji avatar selector
function initEmojiAvatarSelector() {
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    const emojiSelector = document.getElementById('emojiSelector');
    const emojiOptions = document.querySelectorAll('.emoji-option');
    
    if (!currentEmojiAvatar || !emojiSelector) return;
    
    // Add click handler to show/hide emoji selector
    currentEmojiAvatar.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiSelector.classList.toggle('active');
    });
    
    // Close emoji selector when clicking outside
    document.addEventListener('click', () => {
        emojiSelector.classList.remove('active');
    });
    
    // Prevent closing when clicking inside the selector
    emojiSelector.addEventListener('click', (e) => {
        e.stopPropagation();
    });
    
    // Add click handlers for each emoji option
    emojiOptions.forEach(option => {
        option.addEventListener('click', () => {
            const emoji = option.getAttribute('data-emoji');
            selectEmojiAvatar(emoji);
        });
    });
    
    // Add styles for emoji avatar
    const emojiStyles = document.createElement('style');
    emojiStyles.textContent = `
        .emoji-avatar-wrapper {
            position: relative;
            cursor: pointer;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
        }
        
        .current-emoji-avatar {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            background-color: #f0f0f0;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .current-emoji-avatar:hover {
            background-color: #e0e0e0;
        }
        
        .emoji-selector {
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 10px;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            z-index: 10;
        }
        
        .emoji-selector.active {
            display: grid;
        }
        
        .emoji-option {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .emoji-option:hover {
            background-color: #f0f0f0;
            transform: scale(1.1);
        }
        
        .user-profile-image {
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f0f0;
        }
    `;
    document.head.appendChild(emojiStyles);
    
    // Also update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        // Remove any existing img tag
        userProfileImage.innerHTML = '';
        userProfileImage.classList.add('emoji-avatar');
    }
}

// Function to select and save an emoji avatar
function selectEmojiAvatar(emoji) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to change your avatar', 'error');
        return;
    }
    
    // Update the current avatar display
    const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
    if (currentEmojiAvatar) {
        currentEmojiAvatar.textContent = emoji;
    }
    
    // Update the small profile image in the header
    const userProfileImage = document.querySelector('.user-profile-image');
    if (userProfileImage) {
        userProfileImage.textContent = emoji;
    }
    
    // Close the emoji selector
    const emojiSelector = document.getElementById('emojiSelector');
    if (emojiSelector) {
        emojiSelector.classList.remove('active');
    }
    
    // Save the selected emoji to Firebase
    db.collection('users').doc(user.uid).update({
        emojiAvatar: emoji,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        console.log('Emoji avatar updated successfully');
        showToast('Avatar updated successfully');
    })
    .catch(error => {
        console.error('Error updating emoji avatar:', error);
        showToast('Error updating avatar: ' + error.message, 'error');
    });
}

// Function to load the user's emoji avatar
function loadUserEmojiAvatar() {
    const user = auth.currentUser;
    if (!user) return;
    
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Get the emoji avatar or use default
                const emojiAvatar = userData.emojiAvatar || '🤖';
                
                // Update the current avatar display
                const currentEmojiAvatar = document.getElementById('currentEmojiAvatar');
                if (currentEmojiAvatar) {
                    currentEmojiAvatar.textContent = emojiAvatar;
                }
                
                // Update the small profile image in the header
                const userProfileImage = document.querySelector('.user-profile-image');
                if (userProfileImage) {
                    userProfileImage.textContent = emojiAvatar;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user emoji avatar:', error);
        });
}

// Modified auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Load emoji avatar
        loadUserEmojiAvatar();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        emojiAvatar: '🤖', // Default emoji avatar
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else if (!doc.data().emojiAvatar) {
                    // If document exists but is missing emojiAvatar, add default
                    console.log('Adding default emoji avatar to user document');
                    return db.collection('users').doc(user.uid).update({
                        emojiAvatar: '🤖'
                    });
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Initialize emoji avatar selector when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    initEmojiAvatarSelector();
    
    // Also initialize the profile circle click handler
    const profileCircle = document.querySelector('.user-profile-image');
    if (profileCircle) {
        profileCircle.addEventListener('click', function() {
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                profileModal.classList.add('active');
                loadUserEmojiAvatar(); // Load emoji avatar when opening modal
                loadUserProfileData();
            }
        });
    }
});

    
    // Toggle password visibility
    togglePasswordBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const passwordInput = this.previousElementSibling;
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
        });
    });

    // Show/hide change password section
    changePasswordBtn.addEventListener('click', function() {
        profileForm.classList.add('hidden');
        changePasswordSection.classList.remove('hidden');
    });

    cancelPasswordChange.addEventListener('click', function() {
        changePasswordSection.classList.add('hidden');
        profileForm.classList.remove('hidden');
        changePasswordForm.reset();
    });

    // Password strength meter
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            updatePasswordStrength(this.value);
        });
    }

    // Save profile changes
    profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const saveBtn = document.getElementById('saveProfileBtn');
        setButtonLoading(saveBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to update your profile', 'error');
            setButtonLoading(saveBtn, false);
            return;
        }
        
        const fullName = document.getElementById('profileFullName').value.trim();
        const userType = document.getElementById('profileUserType').value;
        const bio = document.getElementById('profileBio').value.trim();
        
        // Update display name in Auth
        user.updateProfile({
            displayName: fullName
        }).then(() => {
            // Update user data in Firestore
            return db.collection('users').doc(user.uid).update({
                displayName: fullName,
                userType: userType,
                bio: bio,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }).then(() => {
            // Update username display in the dashboard
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = fullName;
            }
            
            showToast('Profile updated successfully');
            setButtonLoading(saveBtn, false);
        }).catch(error => {
            console.error('Error updating profile:', error);
            showToast('Error updating profile: ' + error.message, 'error');
            setButtonLoading(saveBtn, false);
        });
    });

    // Change password
    changePasswordForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('button[type="submit"]');
        setButtonLoading(submitBtn, true);
        
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to change your password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        // Check if passwords match
        if (newPassword !== confirmPassword) {
            showToast('New passwords do not match', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Check password strength
        if (getPasswordStrength(newPassword) < 2) {
            showToast('Please choose a stronger password', 'error');
            setButtonLoading(submitBtn, false);
            return;
        }
        
        // Reauthenticate user
        const credential = firebase.auth.EmailAuthProvider.credential(
            user.email, 
            currentPassword
        );
        
        user.reauthenticateWithCredential(credential)
            .then(() => {
                // Change password
                return user.updatePassword(newPassword);
            })
            .then(() => {
                showToast('Password updated successfully');
                changePasswordSection.classList.add('hidden');
                profileForm.classList.remove('hidden');
                changePasswordForm.reset();
                setButtonLoading(submitBtn, false);
            })
            .catch(error => {
                console.error('Error changing password:', error);
                let errorMessage = error.message;
                
                // Provide more user-friendly error messages
                if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Current password is incorrect';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'New password is too weak';
                }
                
                showToast('Error: ' + errorMessage, 'error');
                setButtonLoading(submitBtn, false);
            });
    });

    // Load user profile data
    function loadUserProfile() {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to view your profile', 'error');
            profileModal.classList.remove('active');
            return;
        }
        
        // Set email (from Auth)
        const profileEmail = document.getElementById('profileEmail');
        if (profileEmail) {
            profileEmail.value = user.email;
        }
        
        // Set name (from Auth)
        const profileFullName = document.getElementById('profileFullName');
        if (profileFullName) {
            profileFullName.value = user.displayName || '';
        }
        
        // Set profile image (from Auth)
        if (user.photoURL) {
            profileModalImage.src = user.photoURL;
            userProfileImage.src = user.photoURL;
        } else {
            // Set default image
            profileModalImage.src = 'https://via.placeholder.com/150';
            userProfileImage.src = 'https://via.placeholder.com/40';
        }
        
        // Get additional user data from Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    
                    // Set user type
                    const profileUserType = document.getElementById('profileUserType');
                    if (profileUserType && userData.userType) {
                        profileUserType.value = userData.userType;
                    }
                    
                    // Set bio
                    const profileBio = document.getElementById('profileBio');
                    if (profileBio && userData.bio) {
                        profileBio.value = userData.bio;
                    }
                }
            })
            .catch(error => {
                console.error('Error loading user data:', error);
                showToast('Error loading profile data', 'error');
            });
    }

    // Upload profile image to Firebase Storage
    function uploadProfileImage(file) {
        const user = auth.currentUser;
        if (!user) {
            showToast('You must be logged in to upload a profile image', 'error');
            return;
        }
        
        // Create a storage reference
        const storageRef = storage.ref();
        const profileImageRef = storageRef.child(`profile_images/${user.uid}`);
        
        // Show loading state
        profileImageWrapper.classList.add('uploading');
        
        // Upload file
        const uploadTask = profileImageRef.put(file);
        
        // Monitor upload progress
        uploadTask.on('state_changed', 
            (snapshot) => {
                // Progress function
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                console.log('Upload is ' + progress + '% done');
            }, 
            (error) => {
                // Error function
                console.error('Error uploading image:', error);
                showToast('Error uploading image: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            }, 
            () => {
                // Complete function
                uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    
                    // Update profile in Auth
                    user.updateProfile({
                        photoURL: downloadURL
                    }).then(() => {
                        // Update profile in Firestore
                        return db.collection('users').doc(user.uid).update({
                            photoURL: downloadURL,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }).then(() => {
                        showToast('Profile image updated successfully');
                        profileImageWrapper.classList.remove('uploading');
                    }).catch(error => {
                        console.error('Error updating profile with new image:', error);
                        showToast('Error updating profile with new image', 'error');
                        profileImageWrapper.classList.remove('uploading');
                    });
                });
            }
        );
    }

    // Password strength checker
    function getPasswordStrength(password) {
        let strength = 0;
        
        // Length check
        if (password.length >= 8) strength += 1;
        
        // Contains lowercase
        if (/[a-z]/.test(password)) strength += 1;
        
        // Contains uppercase
        if (/[A-Z]/.test(password)) strength += 1;
        
        // Contains number
        if (/[0-9]/.test(password)) strength += 1;
        
        // Contains special character
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;
        
        return Math.min(strength, 4);
    }

    // Update password strength meter
    function updatePasswordStrength(password) {
        const strength = getPasswordStrength(password);
        
        // Reset all segments
        strengthSegments.forEach(segment => {
            segment.className = 'strength-segment';
        });
        
        // Update strength text
        let strengthLabel = 'Weak';
        let strengthClass = 'weak';
        
        if (strength >= 4) {
            strengthLabel = 'Strong';
            strengthClass = 'strong';
        } else if (strength >= 2) {
            strengthLabel = 'Medium';
            strengthClass = 'medium';
        }
        
        strengthText.textContent = strengthLabel;
        
        // Update segments
        for (let i = 0; i < strength; i++) {
            strengthSegments[i].classList.add(strengthClass);
        }
    }

    // Set button loading state
    function setButtonLoading(button, isLoading) {
        if (!button) return;
        
        if (isLoading) {
            button.classList.add('loading');
            button.disabled = true;
            
            // Add spinner
            const spinner = document.createElement('span');
            spinner.className = 'loading-spinner';
            button.appendChild(spinner);
        } else {
            button.classList.remove('loading');
            button.disabled = false;
            
            // Remove spinner
            const spinner = button.querySelector('.loading-spinner');
            if (spinner) {
                button.removeChild(spinner);
            }
        }
    }

    // Initialize profile data when auth state changes
    auth.onAuthStateChanged(function(user) {
        if (user) {
            // Update profile circle image
            if (user.photoURL) {
                userProfileImage.src = user.photoURL;
            }
            
            // Update username display
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = user.displayName || user.email;
            }
        }
    });

    // Initialize dropdown menu for the hamburger button
    const hamburgerMenu = document.getElementById('hamburgerMenu');
    const dropdownMenu = document.getElementById('dropdownMenu');
    
    if (hamburgerMenu && dropdownMenu) {
        hamburgerMenu.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdownMenu.classList.toggle('active');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function() {
            if (dropdownMenu.classList.contains('active')) {
                dropdownMenu.classList.remove('active');
            }
        });
        
        // Prevent dropdown from closing when clicking inside it
        dropdownMenu.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }

    console.log('Profile functionality initialized');
}

// Add this CSS for the dropdown menu
const dropdownStyles = document.createElement('style');
dropdownStyles.textContent = `
.dropdown-menu {
    position: absolute;
    top: 56px;
    right: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    width: 180px;
    z-index: 100;
    overflow: hidden;
    display: none;
    animation: fadeIn 0.2s ease;
}

.dropdown-menu.active {
    display: block;
}

.dropdown-item {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item i {
    font-size: 1rem;
    color: #6c5ce7;
}

.dropdown-item span {
    font-size: 0.9rem;
    color: #333;
}

.logout-btn {
    border-top: 1px solid #eee;
}

.logout-btn i {
    color: #e74c3c;
}

.profile-image-wrapper.uploading {
    opacity: 0.7;
}

.profile-image-wrapper.uploading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.3) url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3
.org/2000/svg" width="38" height="38" viewBox="0 0 38 38">
    <defs>
        <linearGradient x1="8.042%" y1="0%" x2="65.682%" y2="23.865%" id="a">
            <stop stop-color="#fff" stop-opacity="0" offset="0%"/>
            <stop stop-color="#fff" stop-opacity=".631" offset="63.146%"/>
            <stop stop-color="#fff" offset="100%"/>
        </linearGradient>
    </defs>
    <g fill="none" fill-rule="evenodd">
        <g transform="translate(1 1)">
            <path d="M36 18c0-9.94-8.06-18-18-18" stroke="url(#a)" stroke-width="2">
                <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.9s" repeatCount="indefinite"/>
            </path>
        </g>
    </g>
</svg>') center no-repeat;
}
`;
document.head.appendChild(dropdownStyles);

// Helper function for showing toast notifications
function showToast(message, type = 'success') {
    // Create toast container if it doesn't exist
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container';
        document.body.appendChild(toastContainer);
    }
    
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
        <div class="toast-progress"></div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Show and hide toast with animation
    setTimeout(() => toast.classList.add('visible'), 10);
    
    // Remove toast after animation
    setTimeout(() => {
        toast.classList.remove('visible');
        setTimeout(() => toastContainer.removeChild(toast), 300);
    }, 3000);
}

// Add toast styles if they don't exist
if (!document.querySelector('style[data-toast-styles]')) {
    const toastStyles = document.createElement('style');
    toastStyles.setAttribute('data-toast-styles', 'true');
    toastStyles.textContent = `
    .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
    }
    
    .toast {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 10px;
        overflow: hidden;
        width: 300px;
        max-width: 100%;
        transform: translateX(120%);
        transition: transform 0.3s ease;
    }
    
    .toast.visible {
        transform: translateX(0);
    }
    
    .toast-content {
        display: flex;
        align-items: center;
        padding: 15px;
    }
    
    .toast-content i {
        font-size: 1.5rem;
        margin-right: 12px;
    }
    
    .toast.success i {
        color: #2ecc71;
    }
    
    .toast.error i {
        color: #e74c3c;
    }
    
    .toast-content span {
        flex: 1;
        font-size: 0.9rem;
        color: #333;
    }
    
    .toast-progress {
        height: 3px;
        background-color: #6c5ce7;
        width: 100%;
        animation: progress 3s linear;
    }
    
    .toast.error .toast-progress {
        background-color: #e74c3c;
    }
    
    @keyframes progress {
        from { width: 100%; }
        to { width: 0%; }
    }
    `;
    document.head.appendChild(toastStyles);
}

// Logout function
function logout() {
    firebase.auth().signOut().then(() => {
        // Redirect to login page or show login form
        window.location.href = 'index.html'; // Adjust as needed
    }).catch((error) => {
        console.error('Error signing out:', error);
        showToast('Error signing out: ' + error.message, 'error');
    });
}

// Check if we need to load Font Awesome
if (!document.querySelector('link[href*="font-awesome"]')) {
    const fontAwesome = document.createElement('link');
    fontAwesome.rel = 'stylesheet';
    fontAwesome.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';
    document.head.appendChild(fontAwesome);
}

// Initialize the profile functionality when the document is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProfileModal);
} else {
    initProfileModal();
}

 // Enhanced function to update profile images from Firebase
function updateProfileImages() {
    const user = auth.currentUser;
    if (!user) return;
    
    console.log('Updating profile images for user:', user.uid);
    
    // First check if user has photoURL in Auth
    if (user.photoURL) {
        console.log('Using photoURL from Auth:', user.photoURL);
        setProfileImages(user.photoURL);
    } else {
        // If not in Auth, check Firestore
        console.log('No photoURL in Auth, checking Firestore');
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists && doc.data().photoURL) {
                    const photoURL = doc.data().photoURL;
                    console.log('Found photoURL in Firestore:', photoURL);
                    
                    // Update Auth with the Firestore photoURL
                    user.updateProfile({
                        photoURL: photoURL
                    }).then(() => {
                        console.log('Updated Auth with Firestore photoURL');
                        setProfileImages(photoURL);
                    }).catch(error => {
                        console.error('Error updating Auth with Firestore photoURL:', error);
                        // Still set the images even if Auth update fails
                        setProfileImages(photoURL);
                    });
                } else {
                    console.log('No photoURL found in Firestore, using default');
                    setProfileImages(null);
                }
            })
            .catch(error => {
                console.error('Error fetching user data from Firestore:', error);
                setProfileImages(null);
            });
    }
}

// Helper function to set profile images with a given URL
function setProfileImages(imageUrl) {
    // Set the images with the determined URL or fallback to placeholder
    if (profileModalImage) {
        profileModalImage.src = imageUrl || 'https://via.placeholder.com/150';
        profileModalImage.onerror = function() {
            console.log('Error loading profile modal image, using placeholder');
            this.src = 'https://via.placeholder.com/150';
        };
    }
    
    if (userProfileImage) {
        userProfileImage.src = imageUrl || 'https://via.placeholder.com/40';
        userProfileImage.onerror = function() {
            console.log('Error loading user profile image, using placeholder');
            this.src = 'https://via.placeholder.com/40';
        };
    }
    
    console.log('Profile images updated with URL:', imageUrl || 'placeholder');
}

// Enhanced auth state change listener
auth.onAuthStateChanged(function(user) {
    console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
    
    if (user) {
        // Update profile images
        updateProfileImages();
        
        // Update username display
        const usernameDisplay = document.getElementById('usernameDisplay');
        if (usernameDisplay) {
            usernameDisplay.textContent = user.displayName || user.email;
        }
        
        // Ensure user document exists in Firestore
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (!doc.exists) {
                    // Create user document if it doesn't exist
                    console.log('Creating new user document in Firestore');
                    return db.collection('users').doc(user.uid).set({
                        email: user.email,
                        displayName: user.displayName || '',
                        photoURL: user.photoURL || '',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // If document exists but is missing photoURL, update it
                    const userData = doc.data();
                    if (user.photoURL && !userData.photoURL) {
                        console.log('Updating Firestore with Auth photoURL');
                        return db.collection('users').doc(user.uid).update({
                            photoURL: user.photoURL
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Error checking/creating user document:', error);
            });
    }
});

// Modified upload function to ensure images stay consistent
function uploadProfileImage(file) {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to upload a profile image', 'error');
        return;
    }
    
    // Show loading state
    profileImageWrapper.classList.add('uploading');
    showToast('Uploading image...', 'info');
    
    // Create a storage reference
    const storageRef = firebase.storage().ref();
    const profileImageRef = storageRef.child(`profile_images/${user.uid}_${Date.now()}`);
    
    console.log('Starting upload to:', profileImageRef.fullPath);
    
    // Upload file
    const uploadTask = profileImageRef.put(file);
    
    // Monitor upload progress
    uploadTask.on('state_changed', 
        (snapshot) => {
            // Progress function
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
        }, 
        (error) => {
            // Error function
            console.error('Error uploading image:', error);
            showToast('Error uploading image: ' + error.message, 'error');
            profileImageWrapper.classList.remove('uploading');
        }, 
        () => {
            // Complete function - Get the download URL
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                console.log('File available at', downloadURL);
                
                // Create a transaction to update both Auth and Firestore
                Promise.all([
                    // Update Auth profile
                    user.updateProfile({
                        photoURL: downloadURL
                    }),
                    
                    // Update Firestore document
                    db.collection('users').doc(user.uid).update({
                        photoURL: downloadURL,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    })
                ])
                .then(() => {
                    console.log('Profile updated with new photo URL in both Auth and Firestore');
                    showToast('Profile image updated successfully');
                    
                    // Update both images with the new URL
                    setProfileImages(downloadURL);
                    
                    profileImageWrapper.classList.remove('uploading');
                })
                .catch(error => {
                    console.error('Error updating profile with new image:', error);
                    showToast('Error updating profile with new image: ' + error.message, 'error');
                    profileImageWrapper.classList.remove('uploading');
                });
            }).catch(error => {
                console.error('Error getting download URL:', error);
                showToast('Error getting download URL: ' + error.message, 'error');
                profileImageWrapper.classList.remove('uploading');
            });
        }
    );
}

// Call updateProfileImages when the page loads to ensure images are displayed
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(updateProfileImages, 1000); // Slight delay to ensure auth is initialized
});

// Also update images when the profile modal is opened
profileCircle.addEventListener('click', function() {
    profileModal.classList.add('active');
    updateProfileImages(); // Refresh images when opening modal
    loadUserProfileData();
});

// Modified function to load user profile data without changing the current images
function loadUserProfileData() {
    const user = auth.currentUser;
    if (!user) {
        showToast('You must be logged in to view your profile', 'error');
        profileModal.classList.remove('active');
        return;
    }
    
    // Set email (from Auth)
    const profileEmail = document.getElementById('profileEmail');
    if (profileEmail) {
        profileEmail.value = user.email;
    }
    
    // Set name (from Auth)
    const profileFullName = document.getElementById('profileFullName');
    if (profileFullName) {
        profileFullName.value = user.displayName || '';
    }
    
    // Get additional user data from Firestore
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                
                // Set user type
                const profileUserType = document.getElementById('profileUserType');
                if (profileUserType && userData.userType) {
                    profileUserType.value = userData.userType;
                }
                
                // Set bio
                const profileBio = document.getElementById('profileBio');
                if (profileBio && userData.bio) {
                    profileBio.value = userData.bio;
                }
            }
        })
        .catch(error => {
            console.error('Error loading user data:', error);
            showToast('Error loading profile data', 'error');
        });
}
   
// Hamburger Menu & Sidebar Functionality
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements - Main Navigation
    const hamburgerBtn = document.querySelector('.hamburger-menu');
    const sidebarMenu = document.getElementById('sidebarMenu');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    // DOM Elements - Sidebar Menu Items
    const logoutBtn = document.getElementById('logoutBtn');
    const themeCheckbox = document.getElementById('themeCheckbox');
    const termsBtn = document.getElementById('termsBtn');
    const privacyBtn = document.getElementById('privacyBtn');
    const profileMenuBtn = document.getElementById('profileMenuBtn');
    
    // DOM Elements - Modals
    const termsModal = document.getElementById('termsModal');
    const privacyModal = document.getElementById('privacyModal');
    const closeModalBtns = document.querySelectorAll('.close-modal');
    
    // DOM Elements - User Info
    const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
    const sidebarUserName = document.getElementById('sidebarUserName');
    const sidebarUserEmail = document.getElementById('sidebarUserEmail');
    
    // Function to open sidebar
    function openSidebar() {
        sidebarMenu.classList.add('active');
        sidebarOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
        
        // If Firebase is available, log the event
        if (typeof firebase !== 'undefined' && firebase.analytics) {
            firebase.analytics().logEvent('sidebar_opened');
        }
    }
    
    // Function to close sidebar
    function closeSidebar() {
        sidebarMenu.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to open modal
    function openModal(modal) {
        if (!modal) return;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
    
    // Function to close modal
    function closeModal(modal) {
        if (!modal) return;
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Re-enable scrolling
    }
    
    // Function to toggle theme
    function toggleTheme(isDark) {
        if (isDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            localStorage.setItem('theme', 'dark');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'dark'
                });
            }
        } else {
            document.documentElement.removeAttribute('data-theme');
            localStorage.setItem('theme', 'light');
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('theme_changed', {
                    theme: 'light'
                });
            }
        }
    }
    
    // Function to handle logout
    function handleLogout() {
        // If Firebase is available, log the event and sign out
        if (typeof firebase !== 'undefined' && firebase.auth) {
            if (firebase.analytics) {
                firebase.analytics().logEvent('user_logout');
            }
            
            firebase.auth().signOut()
                .then(() => {
                    window.location.href = 'login.html';
                })
                .catch((error) => {
                    console.error('Error signing out:', error);
                    showToast('Error signing out. Please try again.', 'error');
                });
        } else {
            // Fallback for when Firebase is not available
            console.log('Logout clicked - Firebase not available');
            // Redirect to login page
            window.location.href = 'login.html';
        }
    }
    
    // Function to show toast notification
    function showToast(message, type = 'success') {
        // Check if toast container exists, if not create it
        let toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.className = 'toast-container';
            document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Remove toast after 3 seconds
        setTimeout(() => {
            toast.classList.add('hide');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, 3000);
    }
    
    // Function to update user info in sidebar
    function updateUserInfo() {
        // If Firebase is available, get user info
        if (typeof firebase !== 'undefined' && firebase.auth) {
            const user = firebase.auth().currentUser;
            
            if (user) {
                // Set user email
                sidebarUserEmail.textContent = user.email;
                
                // Set user name (display name or email)
                sidebarUserName.textContent = user.displayName || user.email.split('@')[0];
                
                // If Firestore is available, get emoji avatar
                if (firebase.firestore) {
                    firebase.firestore().collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists && doc.data().emojiAvatar) {
                                sidebarUserAvatar.textContent = doc.data().emojiAvatar;
                            }
                        })
                        .catch(error => {
                            console.error('Error getting user data:', error);
                        });
                }
            }
        } else {
            // Fallback for when Firebase is not available
            // You can set default values or get from localStorage
            const savedName = localStorage.getItem('userName') || 'User Name';
            const savedEmail = localStorage.getItem('userEmail') || 'user@example.com';
            const savedEmoji = localStorage.getItem('userEmoji') || '🤖';
            
            sidebarUserName.textContent = savedName;
            sidebarUserEmail.textContent = savedEmail;
            sidebarUserAvatar.textContent = savedEmoji;
        }
    }
    
    // Initialize theme based on localStorage or system preference
    function initTheme() {
        const savedTheme = localStorage.getItem('theme');
        
        if (savedTheme === 'dark') {
            themeCheckbox.checked = true;
            toggleTheme(true);
        } else if (savedTheme === 'light') {
            themeCheckbox.checked = false;
            toggleTheme(false);
        } else {
            // If no saved preference, check system preference
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            themeCheckbox.checked = prefersDark;
            toggleTheme(prefersDark);
        }
    }
    
    // Add CSS for toast notifications
    function addToastStyles() {
        const styleExists = document.getElementById('toastStyles');
        if (styleExists) return;
        
        const toastStyles = document.createElement('style');
        toastStyles.id = 'toastStyles';
        toastStyles.textContent = `
            .toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 9999;
            }
            
            .toast {
                padding: 12px 20px;
                margin-bottom: 10px;
                border-radius: 8px;
                color: white;
                box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
            }
            
            .toast.success {
                background-color: #2ecc71;
            }
            
            .toast.error {
                background-color: #e74c3c;
            }
            
            .toast.info {
                background-color: #3498db;
            }
            
            .toast.hide {
                opacity: 0;
                transform: translateY(20px);
            }
            
            @supports (padding: max(0px)) {
                .toast-container {
                    padding-bottom: max(20px, env(safe-area-inset-bottom));
                    padding-right: max(20px, env(safe-area-inset-right));
                }
            }
        `;
        document.head.appendChild(toastStyles);
    }
    
    // Event Listeners - Only add if elements exist
    if (hamburgerBtn) {
        hamburgerBtn.addEventListener('click', openSidebar);
    }
    
    if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener('click', closeSidebar);
    }
    
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', closeSidebar);
    }
    
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            handleLogout();
        });
    }
    
    if (termsBtn) {
        termsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(termsModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('terms_viewed');
            }
        });
    }
    
    if (privacyBtn) {
        privacyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            openModal(privacyModal);
            
            // If Firebase is available, log the event
            if (typeof firebase !== 'undefined' && firebase.analytics) {
                firebase.analytics().logEvent('privacy_viewed');
            }
        });
    }
    
    if (profileMenuBtn) {
        profileMenuBtn.addEventListener('click', function(e) {
            e.preventDefault();
            closeSidebar();
            
            // Open profile modal if it exists
            const profileModal = document.getElementById('profileModal');
            if (profileModal) {
                openModal(profileModal);
                
                // If Firebase is available, log the event
                if (typeof firebase !== 'undefined' && firebase.analytics) {
                    firebase.analytics().logEvent('profile_viewed');
                }
            }
        });
    }
    
    // Close modals with close button
    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const modal = this.closest('.modal');
            closeModal(modal);
        });
    });
    
    // Close modals when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal(this);
            }
        });
    });
    
    // Theme toggle functionality
    if (themeCheckbox) {
        themeCheckbox.addEventListener('change', function() {
            toggleTheme(this.checked);
        });
    }
    
    // Initialize
    initTheme();
    updateUserInfo();
    addToastStyles();
    
    // Listen for Firebase auth state changes if available
    if (typeof firebase !== 'undefined' && firebase.auth) {
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                updateUserInfo();
                
                // If Firestore is available, update user data
                if (firebase.firestore) {
                    const userRef = firebase.firestore().collection('users').doc(user.uid);
                    userRef.get().then(doc => {
                        if (doc.exists) {
                            // Update last login time
                            userRef.update({
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else {
                            // Create user document if it doesn't exist
                            userRef.set({
                                email: user.email,
                                displayName: user.displayName || '',
                                emojiAvatar: '🤖', // Default emoji
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    });
                }
            }
        });
    }
});

</script>
   </body>
   </html>          
